function t(t,e,n,i){Object.defineProperty(t,e,{get:n,set:i,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},s={},r=n.parcelRequire3607;null==r&&(r=function(t){if(t in i)return i[t].exports;if(t in s){var e=s[t];delete s[t];var n={id:t,exports:{}};return i[t]=n,e.call(n.exports,n,n.exports),n.exports}var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r},r.register=function(t,e){s[t]=e},n.parcelRequire3607=r),r.register("kyEFX",(function(e,n){var i,s;t(e.exports,"register",(function(){return i}),(function(t){return i=t})),t(e.exports,"resolve",(function(){return s}),(function(t){return s=t}));var r={};i=function(t){for(var e=Object.keys(t),n=0;n<e.length;n++)r[e[n]]=t[e[n]]},s=function(t){var e=r[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),r.register("f0cZC",(function(t,e){var n=r("kAaco"),i=r("gHGyu"),s=r("idGQ9"),o=r("nxncW");t.exports=function(t,e){return n(t)||i(t,e)||s(t,e)||o()},t.exports.__esModule=!0,t.exports.default=t.exports})),r.register("kAaco",(function(t,e){t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports})),r.register("gHGyu",(function(t,e){t.exports=function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,s,r=[],o=!0,a=!1;try{for(n=n.call(t);!(o=(i=n.next()).done)&&(r.push(i.value),!e||r.length!==e);o=!0);}catch(t){a=!0,s=t}finally{try{o||null==n.return||n.return()}finally{if(a)throw s}}return r}},t.exports.__esModule=!0,t.exports.default=t.exports})),r.register("idGQ9",(function(t,e){var n=r("70hlF");t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports})),r.register("70hlF",(function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i},t.exports.__esModule=!0,t.exports.default=t.exports})),r.register("nxncW",(function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports})),r.register("bfbtb",(function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports})),r.register("kNrk6",(function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports})),r("kyEFX").register(JSON.parse('{"e5iw0":"index.fc667931.js","7qSf0":"title.6a70130b.svg"}'));var o={};
/*! Tweakpane 3.0.8 (c) 2016 cocopon, licensed under the MIT license. */!function(t){class e{toString(){const t=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[t,this.prerelease].join("-"):t}constructor(t){const[e,n]=t.split("-"),i=e.split(".");this.major=parseInt(i[0],10),this.minor=parseInt(i[1],10),this.patch=parseInt(i[2],10),this.prerelease=null!=n?n:null}}class n{get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(t){this.controller_.viewProps.set("hidden",t)}dispose(){this.controller_.viewProps.set("disposed",!0)}constructor(t){this.controller_=t}}class i{constructor(t){this.target=t}}class s extends i{constructor(t,e,n,i){super(t),this.value=e,this.presetKey=n,this.last=null==i||i}}class r extends i{constructor(t,e,n){super(t),this.value=e,this.presetKey=n}}class o extends i{constructor(t,e){super(t),this.expanded=e}}function a(t){return t}function l(t){return null==t}function c(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}const u={alreadydisposed:()=>"View has been already disposed",invalidparams:t=>`Invalid parameters for '${t.name}'`,nomatchingcontroller:t=>`No matching controller for '${t.key}'`,nomatchingview:t=>`No matching view for '${JSON.stringify(t.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:t=>`Property '${t.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class h{static alreadyDisposed(){return new h({type:"alreadydisposed"})}static notBindable(){return new h({type:"notbindable"})}static propertyNotFound(t){return new h({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new h({type:"shouldneverhappen"})}constructor(t){var e;this.message=null!==(e=u[t.type](a(t.context)))&&void 0!==e?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}}class p{static isBindable(t){return null!==t&&"object"==typeof t}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(t){this.obj_[this.key_]=t}writeProperty(t,e){const n=this.read();if(!p.isBindable(n))throw h.notBindable();if(!(t in n))throw h.propertyNotFound(t);n[t]=e}constructor(t,e,n){this.obj_=t,this.key_=e,this.presetKey_=null!=n?n:e}}class d extends n{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get title(){var t;return null!==(t=this.controller_.valueController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller_.valueController.props.set("title",t)}on(t,e){const n=e.bind(this);return this.controller_.valueController.emitter.on(t,(()=>{n(new i(this))})),this}}class v{on(t,e){let n=this.observers_[t];return n||(n=this.observers_[t]=[]),n.push({handler:e}),this}off(t,e){const n=this.observers_[t];return n&&(this.observers_[t]=n.filter((t=>t.handler!==e))),this}emit(t,e){const n=this.observers_[t];n&&n.forEach((t=>{t.handler(e)}))}constructor(){this.observers_={}}}const m="tp";function f(t){return(e,n)=>[m,"-",t,"v",e?`_${e}`:"",n?`-${n}`:""].join("")}function _(t,e){return n=>e(t(n))}function g(t){return t.rawValue}function b(t,e){t.emitter.on("change",_(g,e)),e(t.rawValue)}function w(t,e,n){b(t.value(e),n)}function x(t,e,n){n?t.classList.add(e):t.classList.remove(e)}function y(t,e){return n=>{x(t,e,n)}}function C(t,e){b(t,(t=>{e.textContent=null!=t?t:""}))}const E=f("btn");class T{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(E()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("button");n.classList.add(E("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=t.createElement("div");i.classList.add(E("t")),C(e.props.value("title"),i),this.buttonElement.appendChild(i)}}class M{onClick_(){this.emitter.emit("click",{sender:this})}constructor(t,e){this.emitter=new v,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new T(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}}class k{get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const n=null!=e?e:{forceEmit:!1,last:!0},i=this.constraint_?this.constraint_.constrain(t):t;(!this.equals_(this.rawValue_,i)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=i,this.emitter.emit("change",{options:n,rawValue:i,sender:this}))}constructor(t,e){var n;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(n=null==e?void 0:e.equals)&&void 0!==n?n:(t,e)=>t===e,this.emitter=new v,this.rawValue_=t}}class P{get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const n=null!=e?e:{forceEmit:!1,last:!0};(this.value_!==t||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:n,rawValue:this.value_,sender:this}))}constructor(t){this.emitter=new v,this.value_=t}}function A(t,e){const n=null==e?void 0:e.constraint,i=null==e?void 0:e.equals;return n||i?new k(t,e):new P(t)}class S{static createCore(t){return Object.keys(t).reduce(((e,n)=>Object.assign(e,{[n]:A(t[n])})),{})}static fromObject(t){const e=this.createCore(t);return new S(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}constructor(t){this.emitter=new v,this.valMap_=t;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",(()=>{this.emitter.emit("change",{key:t,sender:this})}))}}function V(t,e){return a(Object.keys(e).reduce(((n,i)=>{if(void 0===n)return;const s=(0,e[i])(t[i]);return s.succeeded?Object.assign(Object.assign({},n),{[i]:s.value}):void 0}),{}))}function O(t,e){return t.reduce(((t,n)=>{if(void 0===t)return;const i=e(n);return i.succeeded&&void 0!==i.value?[...t,i.value]:void 0}),[])}function D(t){return null!==t&&"object"==typeof t}function R(t){return e=>n=>{if(!e&&void 0===n)return{succeeded:!1,value:void 0};if(e&&void 0===n)return{succeeded:!0,value:void 0};const i=t(n);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function L(t){return{custom:e=>R(e)(t),boolean:R((t=>"boolean"==typeof t?t:void 0))(t),number:R((t=>"number"==typeof t?t:void 0))(t),string:R((t=>"string"==typeof t?t:void 0))(t),function:R((t=>"function"==typeof t?t:void 0))(t),constant:e=>R((t=>t===e?e:void 0))(t),raw:R((t=>t))(t),object:e=>R((t=>{if(D(t))return V(t,e)}))(t),array:e=>R((t=>{if(Array.isArray(t))return O(t,e)}))(t)}}const I={optional:L(!0),required:L(!1)};function N(t,e){const n=I.required.object(e)(t);return n.succeeded?n.value:void 0}function F(t){return t&&t.parentElement&&t.parentElement.removeChild(t),null}function B(){return["veryfirst","first","last","verylast"]}const q=f(""),z={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class j{get parent(){return this.parent_}constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{B().forEach((t=>{e.classList.remove(q(void 0,z[t]))})),this.blade.get("positions").forEach((t=>{e.classList.add(q(void 0,z[t]))}))})),this.viewProps.handleDispose((()=>{F(e)}))}}const U="http://www.w3.org/2000/svg";function W(t){t.offsetHeight}function G(t,e){const n=t.style.transition;t.style.transition="none",e(),t.style.transition=n}function K(t){return void 0!==t.ontouchstart}function H(){return new Function("return this")()}function $(){return a(H()).document}function X(t){const e=t.ownerDocument.defaultView;return e&&"document"in e?t.getContext("2d"):null}const Y={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Z(t,e){const n=t.createElementNS(U,"svg");return n.innerHTML=Y[e],n}function Q(t,e,n){t.insertBefore(e,t.children[n])}function J(t){t.parentElement&&t.parentElement.removeChild(t)}function tt(t){for(;t.children.length>0;)t.removeChild(t.children[0])}function et(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[0])}function nt(t){return t.relatedTarget?a(t.relatedTarget):"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}const it=f("lbl");function st(t,e){const n=t.createDocumentFragment();return e.split("\n").map((e=>t.createTextNode(e))).forEach(((e,i)=>{i>0&&n.appendChild(t.createElement("br")),n.appendChild(e)})),n}class rt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(it()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(it("l")),w(e.props,"label",(e=>{l(e)?this.element.classList.add(it(void 0,"nol")):(this.element.classList.remove(it(void 0,"nol")),et(n),n.appendChild(st(t,e)))})),this.element.appendChild(n),this.labelElement=n;const i=t.createElement("div");i.classList.add(it("v")),this.element.appendChild(i),this.valueElement=i}}class ot extends j{constructor(t,e){const n=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{view:new rt(t,{props:e.props,viewProps:n}),viewProps:n})),this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const at={id:"button",type:"blade",accept(t){const e=I,n=N(t,{title:e.required.string,view:e.required.constant("button"),label:e.optional.string});return n?{params:n}:null},controller:t=>new ot(t.document,{blade:t.blade,props:S.fromObject({label:t.params.label}),valueController:new M(t.document,{props:S.fromObject({title:t.params.title}),viewProps:t.viewProps})}),api:t=>t.controller instanceof ot&&t.controller.valueController instanceof M?new d(t.controller):null};class lt extends j{constructor(t){super(t),this.value=t.value}}function ct(){return new S({positions:A([],{equals:c})})}class ut extends S{static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=S.createCore(e);return new ut(n)}get styleExpanded(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!l(t)?`${t}px`:"auto"}bindExpandedClass(t,e){const n=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};w(this,"expanded",n),w(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}constructor(t){super(t)}}function ht(t,e){let n=0;return G(e,(()=>{t.set("expandedHeight",null),t.set("temporaryExpanded",!0),W(e),n=e.clientHeight,t.set("temporaryExpanded",null),W(e)})),n}function pt(t,e){e.style.height=t.styleHeight}function dt(t,e){t.value("expanded").emitter.on("beforechange",(()=>{t.set("completed",!1),l(t.get("expandedHeight"))&&t.set("expandedHeight",ht(t,e)),t.set("shouldFixHeight",!0),W(e)})),t.emitter.on("change",(()=>{pt(t,e)})),pt(t,e),e.addEventListener("transitionend",(e=>{"height"===e.propertyName&&t.cleanUpTransition()}))}class vt extends n{constructor(t,e){super(t),this.rackApi_=e}}function mt(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function ft(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function _t(t,e){const n=e||{};return t.addBlade(Object.assign(Object.assign({},n),{view:"separator"}))}function gt(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}class bt{get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw h.shouldNeverHappen();const n=void 0!==e?e:this.items_.length;this.items_.splice(n,0,t),this.cache_.add(t);const i=this.extract_(t);i&&(i.emitter.on("add",this.onSubListAdd_),i.emitter.on("remove",this.onSubListRemove_),i.allItems().forEach((t=>{this.cache_.add(t)}))),this.emitter.emit("add",{index:n,item:t,root:this,target:this})}remove(t){const e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);const n=this.extract_(t);n&&(n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}constructor(t){this.emitter=new v,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}}class wt extends n{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}refresh(){this.controller_.binding.read()}onBindingChange_(t){const e=t.sender.target.read();this.emitter_.emit("change",{event:new s(this,a(e),this.controller_.binding.target.presetKey,t.options.last)})}constructor(t){super(t),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new v,this.controller_.binding.emitter.on("change",this.onBindingChange_)}}class xt extends ot{constructor(t,e){super(t,e),this.binding=e.binding}}class yt extends n{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(t){const e=t.sender.target.read();this.emitter_.emit("update",{event:new r(this,a(e),this.controller_.binding.target.presetKey)})}constructor(t){super(t),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new v,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}}class Ct extends ot{constructor(t,e){super(t,e),this.binding=e.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose((()=>{this.binding.dispose()}))}}function Et(t){return t instanceof kt?t.apiSet_:t instanceof vt?t.rackApi_.apiSet_:null}function Tt(t,e){const n=t.find((t=>t.controller_===e));if(!n)throw h.shouldNeverHappen();return n}function Mt(t,e,n){if(!p.isBindable(t))throw h.notBindable();return new p(t,e,n)}class kt extends n{get children(){return this.controller_.rack.children.map((t=>Tt(this.apiSet_,t)))}addInput(t,e,n){const i=n||{},s=this.controller_.view.element.ownerDocument,r=this.pool_.createInput(s,Mt(t,e,i.presetKey),i),o=new wt(r);return this.add(o,i.index)}addMonitor(t,e,n){const i=n||{},s=this.controller_.view.element.ownerDocument,r=this.pool_.createMonitor(s,Mt(t,e),i),o=new yt(r);return a(this.add(o,i.index))}addFolder(t){return ft(this,t)}addButton(t){return mt(this,t)}addSeparator(t){return _t(this,t)}addTab(t){return gt(this,t)}add(t,e){this.controller_.rack.add(t.controller_,e);const n=this.apiSet_.find((e=>e.controller_===t.controller_));return n&&this.apiSet_.remove(n),this.apiSet_.add(t),t}remove(t){this.controller_.rack.remove(t.controller_)}addBlade(t){const e=this.controller_.view.element.ownerDocument,n=this.pool_.createBlade(e,t),i=this.pool_.createBladeApi(n);return this.add(i,t.index)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}setUpApi_(t){this.apiSet_.find((e=>e.controller_===t))||this.apiSet_.add(this.pool_.createBladeApi(t))}onRackAdd_(t){this.setUpApi_(t.bladeController)}onRackRemove_(t){if(t.isRoot){const e=Tt(this.apiSet_,t.bladeController);this.apiSet_.remove(e)}}onRackInputChange_(t){const e=t.bladeController;if(e instanceof xt){const n=Tt(this.apiSet_,e),i=e.binding;this.emitter_.emit("change",{event:new s(n,a(i.target.read()),i.target.presetKey,t.options.last)})}else if(e instanceof lt){const n=Tt(this.apiSet_,e);this.emitter_.emit("change",{event:new s(n,e.value.rawValue,void 0,t.options.last)})}}onRackMonitorUpdate_(t){if(!(t.bladeController instanceof Ct))throw h.shouldNeverHappen();const e=Tt(this.apiSet_,t.bladeController),n=t.bladeController.binding;this.emitter_.emit("update",{event:new r(e,a(n.target.read()),n.target.presetKey)})}constructor(t,e){super(t),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new v,this.apiSet_=new bt(Et),this.pool_=e;const n=this.controller_.rack;n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),n.emitter.on("inputchange",this.onRackInputChange_),n.emitter.on("monitorupdate",this.onRackMonitorUpdate_),n.children.forEach((t=>{this.setUpApi_(t)}))}}class Pt extends vt{get expanded(){return this.controller_.foldable.get("expanded")}set expanded(t){this.controller_.foldable.set("expanded",t)}get title(){return this.controller_.props.get("title")}set title(t){this.controller_.props.set("title",t)}get children(){return this.rackApi_.children}addInput(t,e,n){return this.rackApi_.addInput(t,e,n)}addMonitor(t,e,n){return this.rackApi_.addMonitor(t,e,n)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}constructor(t,e){super(t,new kt(t.rackController,e)),this.emitter_=new v,this.controller_.foldable.value("expanded").emitter.on("change",(t=>{this.emitter_.emit("fold",{event:new o(this,t.sender.rawValue)})})),this.rackApi_.on("change",(t=>{this.emitter_.emit("change",{event:t})})),this.rackApi_.on("update",(t=>{this.emitter_.emit("update",{event:t})}))}}class At extends j{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}}class St{constructor(t,e){const n=f(e.viewName);this.element=t.createElement("div"),this.element.classList.add(n()),e.viewProps.bindClassModifiers(this.element)}}function Vt(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(i instanceof xt&&i.binding===e)return i}return null}function Ot(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(i instanceof Ct&&i.binding===e)return i}return null}function Dt(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(i instanceof lt&&i.value===e)return i}return null}function Rt(t){return t instanceof Nt?t.rack:t instanceof At?t.rackController.rack:null}function Lt(t){const e=Rt(t);return e?e.bcSet_:null}class It{get children(){return this.bcSet_.items}add(t,e){t.parent&&t.parent.remove(t),t.parent_=this,this.bcSet_.add(t,e)}remove(t){t.parent_=null,this.bcSet_.remove(t)}find(t){return a(this.bcSet_.allItems().filter((e=>e instanceof t)))}onSetAdd_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,isRoot:e,sender:this}),!e)return;const n=t.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),n instanceof xt)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof Ct)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof lt)n.value.emitter.on("change",this.onChildValueChange_);else{const t=Rt(n);if(t){const e=t.emitter;e.on("layout",this.onDescendantLayout_),e.on("inputchange",this.onDescendantInputChange_),e.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,isRoot:e,sender:this}),!e)return;const n=t.item;if(n instanceof xt)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof Ct)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof lt)n.value.emitter.off("change",this.onChildValueChange_);else{const t=Rt(n);if(t){const e=t.emitter;e.off("layout",this.onDescendantLayout_),e.off("inputchange",this.onDescendantInputChange_),e.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const t=this.bcSet_.items.filter((t=>!t.viewProps.get("hidden"))),e=t[0],n=t[t.length-1];this.bcSet_.items.forEach((t=>{const i=[];t===e&&(i.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||i.push("veryfirst")),t===n&&(i.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||i.push("verylast")),t.blade.set("positions",i)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((t=>t.viewProps.get("disposed"))).forEach((t=>{this.bcSet_.remove(t)}))}onChildInputChange_(t){const e=Vt(this.find(xt),t.sender);if(!e)throw h.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onChildMonitorUpdate_(t){const e=Ot(this.find(Ct),t.sender);if(!e)throw h.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:e,sender:this})}onChildValueChange_(t){const e=Dt(this.find(lt),t.sender);if(!e)throw h.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onDescendantLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(t){this.emitter.emit("inputchange",{bladeController:t.bladeController,options:t.options,sender:this})}onDescendantMonitorUpdate_(t){this.emitter.emit("monitorupdate",{bladeController:t.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}constructor(t){var e;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new v,this.blade_=null!=t?t:null,null===(e=this.blade_)||void 0===e||e.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new bt(Lt),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}}class Nt extends j{onRackAdd_(t){t.isRoot&&Q(this.view.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.isRoot&&J(t.bladeController.view.element)}constructor(t,e){super(Object.assign(Object.assign({},e),{view:new St(t,{viewName:"brk",viewProps:e.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const n=new It(e.root?void 0:e.blade);n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.rack=n,this.viewProps.handleDispose((()=>{for(let t=this.rack.children.length-1;t>=0;t--)this.rack.children[t].viewProps.set("disposed",!0)}))}}const Ft=f("cnt");class Bt{constructor(t,e){this.className_=f(e.viewName||"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),Ft()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),w(this.foldable_,"completed",y(this.element,this.className_(void 0,"cpl")));const n=t.createElement("button");n.classList.add(this.className_("b")),w(e.props,"title",(t=>{l(t)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=t.createElement("div");i.classList.add(this.className_("t")),C(e.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i;const s=t.createElement("div");s.classList.add(this.className_("m")),this.buttonElement.appendChild(s);const r=e.containerElement;r.classList.add(this.className_("c")),this.element.appendChild(r),this.containerElement=r}}class qt extends At{get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}constructor(t,e){var n;const i=ut.create(null===(n=e.expanded)||void 0===n||n),s=new Nt(t,{blade:e.blade,root:e.root,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:s,view:new Bt(t,{containerElement:s.view.element,foldable:i,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=i,dt(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",(()=>{this.foldable.cleanUpTransition()})),this.rackController.rack.emitter.on("remove",(()=>{this.foldable.cleanUpTransition()})),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}}const zt={id:"folder",type:"blade",accept(t){const e=I,n=N(t,{title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean});return n?{params:n}:null},controller:t=>new qt(t.document,{blade:t.blade,expanded:t.params.expanded,props:S.fromObject({title:t.params.title}),viewProps:t.viewProps}),api:t=>t.controller instanceof qt?new Pt(t.controller,t.pool):null};class jt extends lt{constructor(t,e){const n=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{value:e.valueController.value,view:new rt(t,{props:e.props,viewProps:n}),viewProps:n})),this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Ut extends n{}const Wt=f("spr");class Gt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Wt()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("hr");n.classList.add(Wt("r")),this.element.appendChild(n)}}class Kt extends j{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new Gt(t,{viewProps:e.viewProps})}))}}const Ht={id:"separator",type:"blade",accept(t){const e=N(t,{view:I.required.constant("separator")});return e?{params:e}:null},controller:t=>new Kt(t.document,{blade:t.blade,viewProps:t.viewProps}),api:t=>t.controller instanceof Kt?new Ut(t.controller):null},$t=f("");function Xt(t,e){return y(t,$t(void 0,e))}class Yt extends S{static create(t){var e,n;const i=null!=t?t:{},s={disabled:null!==(e=i.disabled)&&void 0!==e&&e,disposed:!1,hidden:null!==(n=i.hidden)&&void 0!==n&&n},r=S.createCore(s);return new Yt(r)}bindClassModifiers(t){w(this,"disabled",Xt(t,"disabled")),w(this,"hidden",Xt(t,"hidden"))}bindDisabled(t){w(this,"disabled",(e=>{t.disabled=e}))}bindTabIndex(t){w(this,"disabled",(e=>{t.tabIndex=e?-1:0}))}handleDispose(t){this.value("disposed").emitter.on("change",(e=>{e&&t()}))}constructor(t){super(t)}}const Zt=f("tbi");class Qt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Zt()),e.viewProps.bindClassModifiers(this.element),w(e.props,"selected",(t=>{t?this.element.classList.add(Zt(void 0,"sel")):this.element.classList.remove(Zt(void 0,"sel"))}));const n=t.createElement("button");n.classList.add(Zt("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=t.createElement("div");i.classList.add(Zt("t")),C(e.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i}}class Jt{onClick_(){this.emitter.emit("click",{sender:this})}constructor(t,e){this.emitter=new v,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new Qt(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}}class te{get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}constructor(t,e){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Jt(t,{props:e.itemProps,viewProps:Yt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Nt(t,{blade:ct(),viewProps:Yt.create()}),this.props=e.props,w(this.props,"selected",(t=>{this.itemController.props.set("selected",t),this.contentController.viewProps.set("hidden",!t)}))}}class ee{get title(){var t;return null!==(t=this.controller_.itemController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller_.itemController.props.set("title",t)}get selected(){return this.controller_.props.get("selected")}set selected(t){this.controller_.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addInput(t,e,n){return this.rackApi_.addInput(t,e,n)}addMonitor(t,e,n){return this.rackApi_.addMonitor(t,e,n)}addBlade(t){return this.rackApi_.addBlade(t)}constructor(t,e){this.controller_=t,this.rackApi_=e}}class ne extends vt{get pages(){return this.controller_.pageSet.items.map((t=>{const e=this.pageApiMap_.get(t);if(!e)throw h.shouldNeverHappen();return e}))}addPage(t){const e=this.controller_.view.element.ownerDocument,n=new te(e,{itemProps:S.fromObject({selected:!1,title:t.title}),props:S.fromObject({selected:!1})});this.controller_.add(n,t.index);const i=this.pageApiMap_.get(n);if(!i)throw h.shouldNeverHappen();return i}removePage(t){this.controller_.remove(t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}setUpPageApi_(t){const e=this.rackApi_.apiSet_.find((e=>e.controller_===t.contentController));if(!e)throw h.shouldNeverHappen();const n=new ee(t,e);this.pageApiMap_.set(t,n)}onPageAdd_(t){this.setUpPageApi_(t.item)}onPageRemove_(t){if(!this.pageApiMap_.get(t.item))throw h.shouldNeverHappen();this.pageApiMap_.delete(t.item)}constructor(t,e){super(t,new kt(t.rackController,e)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new v,this.pageApiMap_=new Map,this.rackApi_.on("change",(t=>{this.emitter_.emit("change",{event:t})})),this.rackApi_.on("update",(t=>{this.emitter_.emit("update",{event:t})})),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach((t=>{this.setUpPageApi_(t)}))}}const ie=f("tab");class se{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ie(),Ft()),e.viewProps.bindClassModifiers(this.element),b(e.empty,y(this.element,ie(void 0,"nop")));const n=t.createElement("div");n.classList.add(ie("i")),this.element.appendChild(n),this.itemsElement=n;const i=e.contentsElement;i.classList.add(ie("c")),this.element.appendChild(i),this.contentsElement=i}}class re extends At{get pageSet(){return this.pageSet_}add(t,e){this.pageSet_.add(t,null!=e?e:this.pageSet_.items.length)}remove(t){this.pageSet_.remove(this.pageSet_.items[t])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=0===this.pageSet_.items.length}onPageAdd_(t){const e=t.item;Q(this.view.itemsElement,e.itemController.view.element,t.index),this.rackController.rack.add(e.contentController,t.index),e.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(t){const e=t.item;J(e.itemController.view.element),this.rackController.rack.remove(e.contentController),e.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(0===this.pageSet_.items.length)return;const t=this.pageSet_.items.findIndex((t=>t.props.get("selected")));t<0?this.pageSet_.items.forEach(((t,e)=>{t.props.set("selected",0===e)})):this.pageSet_.items.forEach(((e,n)=>{e.props.set("selected",n===t)}))}onPageSelectedChange_(t){if(t.rawValue){const e=this.pageSet_.items.findIndex((e=>e.props.value("selected")===t.sender));this.pageSet_.items.forEach(((t,n)=>{t.props.set("selected",n===e)}))}else this.keepSelection_()}constructor(t,e){const n=new Nt(t,{blade:e.blade,viewProps:e.viewProps}),i=A(!0);super({blade:e.blade,rackController:n,view:new se(t,{contentsElement:n.view.element,empty:i,viewProps:e.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new bt((()=>null)),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=i,this.applyPages_()}}const oe={id:"tab",type:"blade",accept(t){const e=I,n=N(t,{pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")});return n&&0!==n.pages.length?{params:n}:null},controller(t){const e=new re(t.document,{blade:t.blade,viewProps:t.viewProps});return t.params.pages.forEach((n=>{const i=new te(t.document,{itemProps:S.fromObject({selected:!1,title:n.title}),props:S.fromObject({selected:!1})});e.add(i)})),e},api:t=>t.controller instanceof re?new ne(t.controller,t.pool):null};function ae(t,e){const n=t.accept(e.params);if(!n)return null;const i=I.optional.boolean(e.params.disabled).value,s=I.optional.boolean(e.params.hidden).value;return t.controller({blade:ct(),document:e.document,params:a(Object.assign(Object.assign({},n.params),{disabled:i,hidden:s})),viewProps:Yt.create({disabled:i,hidden:s})})}class le{dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}constructor(){this.disabled=!1,this.emitter=new v}}class ce{get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new v,this.interval_=e,this.setTimer_()}}class ue{constrain(t){return this.constraints.reduce(((t,e)=>e.constrain(t)),t)}constructor(t){this.constraints=t}}function he(t,e){if(t instanceof e)return t;if(t instanceof ue){const n=t.constraints.reduce(((t,n)=>t||(n instanceof e?n:null)),null);if(n)return n}return null}class pe{constrain(t){const e=this.options;return 0===e.length||e.filter((e=>e.value===t)).length>0?t:e[0].value}constructor(t){this.options=t}}class de{constrain(t){let e=t;return l(this.minValue)||(e=Math.max(e,this.minValue)),l(this.maxValue)||(e=Math.min(e,this.maxValue)),e}constructor(t){this.maxValue=t.max,this.minValue=t.min}}class ve{constrain(t){return(t<0?-Math.round(-t/this.step):Math.round(t/this.step))*this.step}constructor(t){this.step=t}}const me=f("lst");class fe{update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(me()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("select");n.classList.add(me("s")),w(this.props_,"options",(e=>{tt(n),e.forEach(((e,i)=>{const s=t.createElement("option");s.dataset.index=String(i),s.textContent=e.text,s.value=String(e.value),n.appendChild(s)}))})),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const i=t.createElement("div");i.classList.add(me("m")),i.appendChild(Z(t,"dropdown")),this.element.appendChild(i),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,this.update_()}}class _e{onSelectChange_(t){const e=a(t.currentTarget).selectedOptions.item(0);if(!e)return;const n=Number(e.dataset.index);this.value.rawValue=this.props.get("options")[n].value}constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new fe(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}}const ge=f("pop");class be{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ge()),e.viewProps.bindClassModifiers(this.element),b(e.shows,y(this.element,ge(void 0,"v")))}}class we{constructor(t,e){this.shows=A(!1),this.viewProps=e.viewProps,this.view=new be(t,{shows:this.shows,viewProps:this.viewProps})}}const xe=f("txt");class ye{refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(xe()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);const n=t.createElement("input");n.classList.add(xe("i")),n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}}class Ce{onInputChange_(t){const e=a(t.currentTarget).value,n=this.parser_(e);l(n)||(this.value.rawValue=n),this.view.refresh()}constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new ye(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}}function Ee(t){return String(t)}function Te(t){return"false"!==t&&!!t}function Me(t){return Ee(t)}class ke{evaluate(){return Number(this.text)}toString(){return this.text}constructor(t){this.text=t}}const Pe={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class Ae{evaluate(){const t=Pe[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}constructor(t,e,n){this.left=e,this.operator=t,this.right=n}}const Se={"+":t=>t,"-":t=>-t,"~":t=>~t};class Ve{evaluate(){const t=Se[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}constructor(t,e){this.operator=t,this.expression=e}}function Oe(t){return(e,n)=>{for(let i=0;i<t.length;i++){const s=t[i](e,n);if(""!==s)return s}return""}}function De(t,e){var n;const i=t.substr(e).match(/^\s+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function Re(t,e){const n=t.substr(e,1);return n.match(/^[1-9]$/)?n:""}function Le(t,e){var n;const i=t.substr(e).match(/^[0-9]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function Ie(t,e){const n=Le(t,e);if(""!==n)return n;const i=t.substr(e,1);if("-"!==i&&"+"!==i)return"";const s=Le(t,e+=1);return""===s?"":i+s}function Ne(t,e){const n=t.substr(e,1);if(e+=1,"e"!==n.toLowerCase())return"";const i=Ie(t,e);return""===i?"":n+i}function Fe(t,e){const n=t.substr(e,1);if("0"===n)return n;const i=Re(t,e);return e+=i.length,""===i?"":i+Le(t,e)}function Be(t,e){const n=Fe(t,e);if(e+=n.length,""===n)return"";const i=t.substr(e,1);if(e+=i.length,"."!==i)return"";const s=Le(t,e);return n+i+s+Ne(t,e+=s.length)}function qe(t,e){const n=t.substr(e,1);if(e+=n.length,"."!==n)return"";const i=Le(t,e);return e+=i.length,""===i?"":n+i+Ne(t,e)}function ze(t,e){const n=Fe(t,e);return e+=n.length,""===n?"":n+Ne(t,e)}const je=Oe([Be,qe,ze]);function Ue(t,e){var n;const i=t.substr(e).match(/^[01]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function We(t,e){const n=t.substr(e,2);if(e+=n.length,"0b"!==n.toLowerCase())return"";const i=Ue(t,e);return""===i?"":n+i}function Ge(t,e){var n;const i=t.substr(e).match(/^[0-7]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function Ke(t,e){const n=t.substr(e,2);if(e+=n.length,"0o"!==n.toLowerCase())return"";const i=Ge(t,e);return""===i?"":n+i}function He(t,e){var n;const i=t.substr(e).match(/^[0-9a-f]+/i);return null!==(n=i&&i[0])&&void 0!==n?n:""}function $e(t,e){const n=t.substr(e,2);if(e+=n.length,"0x"!==n.toLowerCase())return"";const i=He(t,e);return""===i?"":n+i}const Xe=Oe([We,Ke,$e]),Ye=Oe([Xe,je]);function Ze(t,e){const n=Ye(t,e);return e+=n.length,""===n?null:{evaluable:new ke(n),cursor:e}}function Qe(t,e){const n=t.substr(e,1);if(e+=n.length,"("!==n)return null;const i=rn(t,e);if(!i)return null;e=i.cursor,e+=De(t,e).length;const s=t.substr(e,1);return e+=s.length,")"!==s?null:{evaluable:i.evaluable,cursor:e}}function Je(t,e){return Ze(t,e)||Qe(t,e)}function tn(t,e){const n=Je(t,e);if(n)return n;const i=t.substr(e,1);if(e+=i.length,"+"!==i&&"-"!==i&&"~"!==i)return null;const s=tn(t,e);return s?{cursor:e=s.cursor,evaluable:new Ve(i,s.evaluable)}:null}function en(t,e,n){n+=De(e,n).length;const i=t.filter((t=>e.startsWith(t,n)))[0];return i?(n+=i.length,{cursor:n+=De(e,n).length,operator:i}):null}function nn(t,e){return(n,i)=>{const s=t(n,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const s=en(e,n,i);if(!s)break;i=s.cursor;const o=t(n,i);if(!o)return null;i=o.cursor,r=new Ae(s.operator,r,o.evaluable)}return r?{cursor:i,evaluable:r}:null}}const sn=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((t,e)=>nn(t,e)),tn);function rn(t,e){return e+=De(t,e).length,sn(t,e)}function on(t){const e=rn(t,0);return e?e.cursor+De(t,e.cursor).length!==t.length?null:e.evaluable:null}function an(t){var e;const n=on(t);return null!==(e=null==n?void 0:n.evaluate())&&void 0!==e?e:null}function ln(t){if("number"==typeof t)return t;if("string"==typeof t){const e=an(t);if(!l(e))return e}return 0}function cn(t){return String(t)}function un(t){return e=>e.toFixed(Math.max(Math.min(t,20),0))}const hn=un(0);function pn(t){return hn(t)+"%"}function dn(t){return String(t)}function vn(t){return t}function mn(t,e){for(;t.length<e;)t.push(void 0)}function fn(t){const e=[];return mn(e,t),A(e)}function _n(t){const e=t.indexOf(void 0);return a(e<0?t:t.slice(0,e))}function gn(t,e){const n=[..._n(t),e];return n.length>t.length?n.splice(0,n.length-t.length):mn(n,t.length),n}function bn({primary:t,secondary:e,forward:n,backward:i}){let s=!1;function r(t){s||(s=!0,t(),s=!1)}t.emitter.on("change",(i=>{r((()=>{e.setRawValue(n(t,e),i.options)}))})),e.emitter.on("change",(s=>{r((()=>{t.setRawValue(i(t,e),s.options)})),r((()=>{e.setRawValue(n(t,e),s.options)}))})),r((()=>{e.setRawValue(n(t,e),{forceEmit:!1,last:!0})}))}function wn(t,e){const n=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+n:e.downKey?-n:0}function xn(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function yn(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function Cn(t){return"ArrowUp"===t||"ArrowDown"===t}function En(t){return Cn(t)||"ArrowLeft"===t||"ArrowRight"===t}function Tn(t,e){const n=e.ownerDocument.defaultView,i=e.getBoundingClientRect();return{x:t.pageX-((n&&n.scrollX||0)+i.left),y:t.pageY-((n&&n.scrollY||0)+i.top)}}class Mn{computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(Tn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(Tn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(Tn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const n=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(n?{x:n.clientX-i.left,y:n.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey})}constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new v,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}}function kn(t,e,n,i,s){return i+(t-e)/(n-e)*(s-i)}function Pn(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function An(t,e,n){return Math.min(Math.max(t,e),n)}function Sn(t,e){return(t%e+e)%e}const Vn=f("txt");class On{onDraggingChange_(t){if(null===t.rawValue)return void this.element.classList.remove(Vn(void 0,"drg"));this.element.classList.add(Vn(void 0,"drg"));const e=t.rawValue/this.props_.get("draggingScale"),n=e+(e>0?-1:e<0?1:0),i=An(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+i},0 L${n},4 L${n+i},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const s=this.props_.get("formatter");this.tooltipElem_.textContent=s(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Vn(),Vn(void 0,"num")),e.arrayPosition&&this.element.classList.add(Vn(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("input");n.classList.add(Vn("i")),n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Vn()),this.inputElement.classList.add(Vn("i"));const i=t.createElement("div");i.classList.add(Vn("k")),this.element.appendChild(i),this.knobElement=i;const s=t.createElementNS(U,"svg");s.classList.add(Vn("g")),this.knobElement.appendChild(s);const r=t.createElementNS(U,"path");r.classList.add(Vn("gb")),s.appendChild(r),this.guideBodyElem_=r;const o=t.createElementNS(U,"path");o.classList.add(Vn("gh")),s.appendChild(o),this.guideHeadElem_=o;const a=t.createElement("div");a.classList.add(f("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}}class Dn{onInputChange_(t){const e=a(t.currentTarget).value,n=this.parser_(e);l(n)||(this.value.rawValue=n),this.view.refresh()}onInputKeyDown_(t){const e=wn(this.baseStep_,xn(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onInputKeyUp_(t){0!==wn(this.baseStep_,xn(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.originRawValue_+e*this.props.get("draggingScale")}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}constructor(t,e){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=A(null),this.view=new On(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const n=new Mn(this.view.knobElement);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}}const Rn=f("sld");class Ln{update_(){const t=An(kn(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Rn()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(Rn("t")),e.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const i=t.createElement("div");i.classList.add(Rn("k")),this.trackElement.appendChild(i),this.knobElement=i,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}}class In{handlePointerEvent_(t,e){t.point&&this.value.setRawValue(kn(An(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=wn(this.baseStep_,yn(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){0!==wn(this.baseStep_,yn(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new Ln(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Mn(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}}const Nn=f("sldtxt");class Fn{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Nn());const n=t.createElement("div");n.classList.add(Nn("s")),this.sliderView_=e.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const i=t.createElement("div");i.classList.add(Nn("t")),this.textView_=e.textView,i.appendChild(this.textView_.element),this.element.appendChild(i)}}class Bn{get sliderController(){return this.sliderC_}get textController(){return this.textC_}constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new In(t,{baseStep:e.baseStep,props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new Dn(t,{baseStep:e.baseStep,parser:e.parser,props:e.textProps,value:e.value,viewProps:e.viewProps}),this.view=new Fn(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}}function qn(t,e){t.write(e)}function zn(t){const e=I;return Array.isArray(t)?e.required.array(e.required.object({text:e.required.string,value:e.required.raw}))(t).value:"object"==typeof t?e.required.raw(t).value:void 0}function jn(t){if("inline"===t||"popup"===t)return t}function Un(t){const e=I;return e.required.object({max:e.optional.number,min:e.optional.number,step:e.optional.number})(t).value}function Wn(t){if(Array.isArray(t))return t;const e=[];return Object.keys(t).forEach((n=>{e.push({text:n,value:t[n]})})),e}function Gn(t){return l(t)?null:new pe(Wn(a(t)))}function Kn(t){const e=t?he(t,pe):null;return e?e.options:null}function Hn(t){const e=t?he(t,ve):null;return e?e.step:null}function $n(t,e){const n=t&&he(t,ve);return n?Pn(n.step):Math.max(Pn(e),2)}function Xn(t){const e=Hn(t);return null!=e?e:1}function Yn(t,e){var n;const i=t&&he(t,ve),s=Math.abs(null!==(n=null==i?void 0:i.step)&&void 0!==n?n:e);return 0===s?.1:Math.pow(10,Math.floor(Math.log10(s))-1)}const Zn=f("ckb");class Qn{update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Zn()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("label");n.classList.add(Zn("l")),this.element.appendChild(n);const i=t.createElement("input");i.classList.add(Zn("i")),i.type="checkbox",n.appendChild(i),this.inputElement=i,e.viewProps.bindDisabled(this.inputElement);const s=t.createElement("div");s.classList.add(Zn("w")),n.appendChild(s);const r=Z(t,"check");s.appendChild(r),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}}class Jn{onInputChange_(t){const e=a(t.currentTarget);this.value.rawValue=e.checked}constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Qn(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}}function ti(t){const e=[],n=Gn(t.options);return n&&e.push(n),new ue(e)}const ei={id:"input-bool",type:"input",accept:(t,e)=>{if("boolean"!=typeof t)return null;const n=N(e,{options:I.optional.custom(zn)});return n?{initialValue:t,params:n}:null},binding:{reader:t=>Te,constraint:t=>ti(t.params),writer:t=>qn},controller:t=>{var e;const n=t.document,i=t.value,s=t.constraint;return s&&he(s,pe)?new _e(n,{props:S.fromObject({options:null!==(e=Kn(s))&&void 0!==e?e:[]}),value:i,viewProps:t.viewProps}):new Jn(n,{value:i,viewProps:t.viewProps})}},ni=f("col");class ii{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ni()),e.foldable.bindExpandedClass(this.element,ni(void 0,"expanded")),w(e.foldable,"completed",y(this.element,ni(void 0,"cpl")));const n=t.createElement("div");n.classList.add(ni("h")),this.element.appendChild(n);const i=t.createElement("div");i.classList.add(ni("s")),n.appendChild(i),this.swatchElement=i;const s=t.createElement("div");if(s.classList.add(ni("t")),n.appendChild(s),this.textElement=s,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(ni("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}function si(t,e,n){const i=An(t/255,0,1),s=An(e/255,0,1),r=An(n/255,0,1),o=Math.max(i,s,r),a=Math.min(i,s,r),l=o-a;let c=0,u=0;const h=(a+o)/2;return 0!==l&&(u=l/(1-Math.abs(o+a-1)),c=i===o?(s-r)/l:s===o?2+(r-i)/l:4+(i-s)/l,c=c/6+(c<0?1:0)),[360*c,100*u,100*h]}function ri(t,e,n){const i=(t%360+360)%360,s=An(e/100,0,1),r=An(n/100,0,1),o=(1-Math.abs(2*r-1))*s,a=o*(1-Math.abs(i/60%2-1)),l=r-o/2;let c,u,h;return[c,u,h]=i>=0&&i<60?[o,a,0]:i>=60&&i<120?[a,o,0]:i>=120&&i<180?[0,o,a]:i>=180&&i<240?[0,a,o]:i>=240&&i<300?[a,0,o]:[o,0,a],[255*(c+l),255*(u+l),255*(h+l)]}function oi(t,e,n){const i=An(t/255,0,1),s=An(e/255,0,1),r=An(n/255,0,1),o=Math.max(i,s,r),a=o-Math.min(i,s,r);let l;return l=0===a?0:o===i?((s-r)/a%6+6)%6*60:o===s?60*((r-i)/a+2):60*((i-s)/a+4),[l,100*(0===o?0:a/o),100*o]}function ai(t,e,n){const i=Sn(t,360),s=An(e/100,0,1),r=An(n/100,0,1),o=r*s,a=o*(1-Math.abs(i/60%2-1)),l=r-o;let c,u,h;return[c,u,h]=i>=0&&i<60?[o,a,0]:i>=60&&i<120?[a,o,0]:i>=120&&i<180?[0,o,a]:i>=180&&i<240?[0,a,o]:i>=240&&i<300?[a,0,o]:[o,0,a],[255*(c+l),255*(u+l),255*(h+l)]}function li(t,e,n){const i=n+e*(100-Math.abs(2*n-100))/200;return[t,0!==i?e*(100-Math.abs(2*n-100))/i:0,n+e*(100-Math.abs(2*n-100))/200]}function ci(t,e,n){const i=100-Math.abs(n*(200-e)/100-100);return[t,0!==i?e*n/i:0,n*(200-e)/200]}function ui(t){return[t[0],t[1],t[2]]}function hi(t,e){return[t[0],t[1],t[2],e]}const pi={hsl:{hsl:(t,e,n)=>[t,e,n],hsv:li,rgb:ri},hsv:{hsl:ci,hsv:(t,e,n)=>[t,e,n],rgb:ai},rgb:{hsl:si,hsv:oi,rgb:(t,e,n)=>[t,e,n]}};function di(t,e,n){return pi[e][n](...t)}const vi={hsl:t=>{var e;return[Sn(t[0],360),An(t[1],0,100),An(t[2],0,100),An(null!==(e=t[3])&&void 0!==e?e:1,0,1)]},hsv:t=>{var e;return[Sn(t[0],360),An(t[1],0,100),An(t[2],0,100),An(null!==(e=t[3])&&void 0!==e?e:1,0,1)]},rgb:t=>{var e;return[An(t[0],0,255),An(t[1],0,255),An(t[2],0,255),An(null!==(e=t[3])&&void 0!==e?e:1,0,1)]}};function mi(t,e){return"object"==typeof t&&!l(t)&&e in t&&"number"==typeof t[e]}class fi{static black(){return new fi([0,0,0],"rgb")}static fromObject(t){const e="a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b];return new fi(e,"rgb")}static toRgbaObject(t){return t.toRgbaObject()}static isRgbColorObject(t){return mi(t,"r")&&mi(t,"g")&&mi(t,"b")}static isRgbaColorObject(t){return this.isRgbColorObject(t)&&mi(t,"a")}static isColorObject(t){return this.isRgbColorObject(t)}static equals(t,e){if(t.mode_!==e.mode_)return!1;const n=t.comps_,i=e.comps_;for(let t=0;t<n.length;t++)if(n[t]!==i[t])return!1;return!0}get mode(){return this.mode_}getComponents(t){return hi(di(ui(this.comps_),this.mode_,t||this.mode_),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}constructor(t,e){this.mode_=e,this.comps_=vi[e](t)}}const _i=f("colp");class gi{get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map((t=>t.inputElement))];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(_i());const n=t.createElement("div");n.classList.add(_i("hsv"));const i=t.createElement("div");i.classList.add(_i("sv")),this.svPaletteView_=e.svPaletteView,i.appendChild(this.svPaletteView_.element),n.appendChild(i);const s=t.createElement("div");s.classList.add(_i("h")),this.hPaletteView_=e.hPaletteView,s.appendChild(this.hPaletteView_.element),n.appendChild(s),this.element.appendChild(n);const r=t.createElement("div");if(r.classList.add(_i("rgb")),this.textView_=e.textView,r.appendChild(this.textView_.element),this.element.appendChild(r),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};const n=t.createElement("div");n.classList.add(_i("a"));const i=t.createElement("div");i.classList.add(_i("ap")),i.appendChild(this.alphaViews_.palette.element),n.appendChild(i);const s=t.createElement("div");s.classList.add(_i("at")),s.appendChild(this.alphaViews_.text.element),n.appendChild(s),this.element.appendChild(n)}}}function bi(t){const e=I;return N(t,{alpha:e.optional.boolean,expanded:e.optional.boolean,picker:e.optional.custom(jn)})}function wi(t){return t?.1:1}function xi(t,e){const n=t.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*e,e):Math.min(parseFloat(t),e)}const yi={deg:t=>t,grad:t=>360*t/400,rad:t=>360*t/(2*Math.PI),turn:t=>360*t};function Ci(t){const e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);const n=parseFloat(e[1]),i=e[2];return yi[i](n)}const Ei={"func.rgb":t=>{const e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[xi(e[1],255),xi(e[2],255),xi(e[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:new fi(n,"rgb")},"func.rgba":t=>{const e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[xi(e[1],255),xi(e[2],255),xi(e[3],255),xi(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:new fi(n,"rgb")},"func.hsl":t=>{const e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[Ci(e[1]),xi(e[2],100),xi(e[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:new fi(n,"hsl")},"func.hsla":t=>{const e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[Ci(e[1]),xi(e[2],100),xi(e[3],100),xi(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:new fi(n,"hsl")},"hex.rgb":t=>{const e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return new fi([parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)],"rgb");const n=t.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?new fi([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)],"rgb"):null},"hex.rgba":t=>{const e=t.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return new fi([parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),kn(parseInt(e[4]+e[4],16),0,255,0,1)],"rgb");const n=t.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?new fi([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),kn(parseInt(n[4],16),0,255,0,1)],"rgb"):null}};function Ti(t){return Object.keys(Ei).reduce(((e,n)=>e||((0,Ei[n])(t)?n:null)),null)}const Mi=t=>{const e=Ti(t);return e?Ei[e](t):null};function ki(t){return"func.hsla"===t||"func.rgba"===t||"hex.rgba"===t}function Pi(t){if("string"==typeof t){const e=Mi(t);if(e)return e}return fi.black()}function Ai(t){const e=An(Math.floor(t),0,255).toString(16);return 1===e.length?`0${e}`:e}function Si(t,e="#"){return`${e}${ui(t.getComponents("rgb")).map(Ai).join("")}`}function Vi(t,e="#"){const n=t.getComponents("rgb");return`${e}${[n[0],n[1],n[2],255*n[3]].map(Ai).join("")}`}function Oi(t){const e=un(0);return`rgb(${ui(t.getComponents("rgb")).map((t=>e(t))).join(", ")})`}function Di(t){const e=un(2),n=un(0);return`rgba(${t.getComponents("rgb").map(((t,i)=>(3===i?e:n)(t))).join(", ")})`}function Ri(t){const e=[un(0),pn,pn];return`hsl(${ui(t.getComponents("hsl")).map(((t,n)=>e[n](t))).join(", ")})`}function Li(t){const e=[un(0),pn,pn,un(2)];return`hsla(${t.getComponents("hsl").map(((t,n)=>e[n](t))).join(", ")})`}const Ii={"func.hsl":Ri,"func.hsla":Li,"func.rgb":Oi,"func.rgba":Di,"hex.rgb":Si,"hex.rgba":Vi};function Ni(t){return Ii[t]}const Fi=f("apl");class Bi{update_(){const t=this.value.rawValue,e=t.getComponents("rgb"),n=new fi([e[0],e[1],e[2],0],"rgb"),i=new fi([e[0],e[1],e[2],255],"rgb"),s=["to right",Di(n),Di(i)];this.colorElem_.style.background=`linear-gradient(${s.join(",")})`,this.previewElem_.style.backgroundColor=Di(t);const r=kn(e[3],0,1,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Fi()),e.viewProps.bindTabIndex(this.element);const n=t.createElement("div");n.classList.add(Fi("b")),this.element.appendChild(n);const i=t.createElement("div");i.classList.add(Fi("c")),n.appendChild(i),this.colorElem_=i;const s=t.createElement("div");s.classList.add(Fi("m")),this.element.appendChild(s),this.markerElem_=s;const r=t.createElement("div");r.classList.add(Fi("p")),this.markerElem_.appendChild(r),this.previewElem_=r,this.update_()}}class qi{handlePointerEvent_(t,e){if(!t.point)return;const n=t.point.x/t.bounds.width,i=this.value.rawValue,[s,r,o]=i.getComponents("hsv");this.value.setRawValue(new fi([s,r,o,n],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=wn(wi(!0),yn(t));if(0===e)return;const n=this.value.rawValue,[i,s,r,o]=n.getComponents("hsv");this.value.setRawValue(new fi([i,s,r,o+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==wn(wi(!0),yn(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Bi(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Mn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}}const zi=f("coltxt");function ji(t){const e=t.createElement("select"),n=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return e.appendChild(n.reduce(((e,n)=>{const i=t.createElement("option");return i.textContent=n.text,i.value=n.value,e.appendChild(i),e}),t.createDocumentFragment())),e}class Ui{get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(t){this.textViews_=t,this.applyTextViews_()}applyTextViews_(){tt(this.textsElem_);const t=this.element.ownerDocument;this.textViews_.forEach((e=>{const n=t.createElement("div");n.classList.add(zi("c")),n.appendChild(e.element),this.textsElem_.appendChild(n)}))}constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(zi());const n=t.createElement("div");n.classList.add(zi("m")),this.modeElem_=ji(t),this.modeElem_.classList.add(zi("ms")),n.appendChild(this.modeSelectElement);const i=t.createElement("div");i.classList.add(zi("mm")),i.appendChild(Z(t,"dropdown")),n.appendChild(i),this.element.appendChild(n);const s=t.createElement("div");s.classList.add(zi("w")),this.element.appendChild(s),this.textsElem_=s,this.textViews_=e.textViews,this.applyTextViews_(),b(e.colorMode,(t=>{this.modeElem_.value=t}))}}const Wi=un(0),Gi={rgb:()=>new de({min:0,max:255}),hsl:t=>new de(0===t?{min:0,max:360}:{min:0,max:100}),hsv:t=>new de(0===t?{min:0,max:360}:{min:0,max:100})};function Ki(t,e,n){return new Dn(t,{arrayPosition:0===n?"fst":2===n?"lst":"mid",baseStep:wi(!1),parser:e.parser,props:S.fromObject({draggingScale:1,formatter:Wi}),value:A(0,{constraint:Gi[e.colorMode](n)}),viewProps:e.viewProps})}class Hi{createComponentControllers_(t){const e={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},n=[Ki(t,e,0),Ki(t,e,1),Ki(t,e,2)];return n.forEach(((t,e)=>{bn({primary:this.value,secondary:t.value,forward:t=>t.rawValue.getComponents(this.colorMode.rawValue)[e],backward:(t,n)=>{const i=this.colorMode.rawValue,s=t.rawValue.getComponents(i);return s[e]=n.rawValue,new fi(hi(ui(s),s[3]),i)}})})),n}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=e.parser,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=A(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new Ui(t,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}}const $i=f("hpl");class Xi{update_(){const t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=Oi(new fi([e,100,100],"hsv"));const n=kn(e,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add($i()),e.viewProps.bindTabIndex(this.element);const n=t.createElement("div");n.classList.add($i("c")),this.element.appendChild(n);const i=t.createElement("div");i.classList.add($i("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}}class Yi{handlePointerEvent_(t,e){if(!t.point)return;const n=kn(An(t.point.x,0,t.bounds.width),0,t.bounds.width,0,359),i=this.value.rawValue,[,s,r,o]=i.getComponents("hsv");this.value.setRawValue(new fi([n,s,r,o],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=wn(wi(!1),yn(t));if(0===e)return;const n=this.value.rawValue,[i,s,r,o]=n.getComponents("hsv");this.value.setRawValue(new fi([i+e,s,r,o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==wn(wi(!1),yn(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Xi(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Mn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}}const Zi=f("svp"),Qi=64;class Ji{update_(){const t=X(this.canvasElement);if(!t)return;const e=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,i=this.canvasElement.height,s=t.getImageData(0,0,n,i),r=s.data;for(let t=0;t<i;t++)for(let s=0;s<n;s++){const o=kn(s,0,n,0,100),a=kn(t,0,i,100,0),l=ai(e[0],o,a),c=4*(t*n+s);r[c]=l[0],r[c+1]=l[1],r[c+2]=l[2],r[c+3]=255}t.putImageData(s,0,0);const o=kn(e[1],0,100,0,100);this.markerElem_.style.left=`${o}%`;const a=kn(e[2],0,100,100,0);this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Zi()),e.viewProps.bindTabIndex(this.element);const n=t.createElement("canvas");n.height=Qi,n.width=Qi,n.classList.add(Zi("c")),this.element.appendChild(n),this.canvasElement=n;const i=t.createElement("div");i.classList.add(Zi("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}}class ts{handlePointerEvent_(t,e){if(!t.point)return;const n=kn(t.point.x,0,t.bounds.width,0,100),i=kn(t.point.y,0,t.bounds.height,100,0),[s,,,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new fi([s,n,i,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){En(t.key)&&t.preventDefault();const[e,n,i,s]=this.value.rawValue.getComponents("hsv"),r=wi(!1),o=wn(r,yn(t)),a=wn(r,xn(t));0===o&&0===a||this.value.setRawValue(new fi([e,n+o,i+a,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const e=wi(!1),n=wn(e,yn(t)),i=wn(e,xn(t));0===n&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Ji(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Mn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}}class es{get textController(){return this.textC_}constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new Yi(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new ts(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new qi(t,{value:this.value,viewProps:this.viewProps}),text:new Dn(t,{parser:an,baseStep:.1,props:S.fromObject({draggingScale:.01,formatter:un(2)}),value:A(0,{constraint:new de({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&bn({primary:this.value,secondary:this.alphaIcs_.text.value,forward:t=>t.rawValue.getComponents()[3],backward:(t,e)=>{const n=t.rawValue.getComponents();return n[3]=e.rawValue,new fi(n,t.rawValue.mode)}}),this.textC_=new Hi(t,{parser:an,value:this.value,viewProps:this.viewProps}),this.view=new gi(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}}const ns=f("colsw");class is{update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=Vi(t)}onValueChange_(){this.update_()}constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(ns()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(ns("sw")),this.element.appendChild(n),this.swatchElem_=n;const i=t.createElement("button");i.classList.add(ns("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i,this.update_()}}class ss{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new is(t,{value:this.value,viewProps:this.viewProps})}}class rs{get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,n=a(t.relatedTarget);n&&e.contains(n)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,n=nt(t);n&&e.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!K(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.swatchC_.view.buttonElement.focus()}constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=ut.create(e.expanded),this.swatchC_=new ss(t,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new Ce(t,{parser:e.parser,props:S.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new ii(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===e.pickerLayout?new we(t,{viewProps:this.viewProps}):null;const i=new es(t,{supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(i.view.element),bn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),dt(this.foldable_,this.view.pickerElement))}}function os(t){return fi.isColorObject(t)?fi.fromObject(t):fi.black()}function as(t){return ui(t.getComponents("rgb")).reduce(((t,e)=>t<<8|255&Math.floor(e)),0)}function ls(t){return t.getComponents("rgb").reduce(((t,e,n)=>t<<8|255&Math.floor(3===n?255*e:e)),0)>>>0}function cs(t){return new fi([t>>16&255,t>>8&255,255&t],"rgb")}function us(t){return new fi([t>>24&255,t>>16&255,t>>8&255,kn(255&t,0,255,0,1)],"rgb")}function hs(t){return"number"!=typeof t?fi.black():cs(t)}function ps(t){return"number"!=typeof t?fi.black():us(t)}function ds(t){const e=Ni(t);return(t,n)=>{qn(t,e(n))}}function vs(t){const e=t?ls:as;return(t,n)=>{qn(t,e(n))}}function ms(t,e){const n=e.toRgbaObject();t.writeProperty("r",n.r),t.writeProperty("g",n.g),t.writeProperty("b",n.b),t.writeProperty("a",n.a)}function fs(t,e){const n=e.toRgbaObject();t.writeProperty("r",n.r),t.writeProperty("g",n.g),t.writeProperty("b",n.b)}function _s(t){return t?ms:fs}function gs(t){return"alpha"in t&&!0===t.alpha}function bs(t){return t?t=>Vi(t,"0x"):t=>Si(t,"0x")}const ws={id:"input-color-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;if(!("view"in e))return null;if("color"!==e.view)return null;const n=bi(e);return n?{initialValue:t,params:n}:null},binding:{reader:t=>gs(t.params)?ps:hs,equals:fi.equals,writer:t=>vs(gs(t.params))},controller:t=>{const e=gs(t.params),n="expanded"in t.params?t.params.expanded:void 0,i="picker"in t.params?t.params.picker:void 0;return new rs(t.document,{expanded:null!=n&&n,formatter:bs(e),parser:Mi,pickerLayout:null!=i?i:"popup",supportsAlpha:e,value:t.value,viewProps:t.viewProps})}};function xs(t){return fi.isRgbaColorObject(t)}const ys={id:"input-color-object",type:"input",accept:(t,e)=>{if(!fi.isColorObject(t))return null;const n=bi(e);return n?{initialValue:t,params:n}:null},binding:{reader:t=>os,equals:fi.equals,writer:t=>_s(xs(t.initialValue))},controller:t=>{const e=fi.isRgbaColorObject(t.initialValue),n="expanded"in t.params?t.params.expanded:void 0,i="picker"in t.params?t.params.picker:void 0,s=e?Vi:Si;return new rs(t.document,{expanded:null!=n&&n,formatter:s,parser:Mi,pickerLayout:null!=i?i:"popup",supportsAlpha:e,value:t.value,viewProps:t.viewProps})}},Cs={id:"input-color-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;if("view"in e&&"text"===e.view)return null;if(!Ti(t))return null;const n=bi(e);return n?{initialValue:t,params:n}:null},binding:{reader:t=>Pi,equals:fi.equals,writer:t=>{const e=Ti(t.initialValue);if(!e)throw h.shouldNeverHappen();return ds(e)}},controller:t=>{const e=Ti(t.initialValue);if(!e)throw h.shouldNeverHappen();const n=Ni(e),i="expanded"in t.params?t.params.expanded:void 0,s="picker"in t.params?t.params.picker:void 0;return new rs(t.document,{expanded:null!=i&&i,formatter:n,parser:Mi,pickerLayout:null!=s?s:"popup",supportsAlpha:ki(e),value:t.value,viewProps:t.viewProps})}};class Es{constrain(t){const e=this.asm_.toComponents(t).map(((t,e)=>{var n,i;return null!==(i=null===(n=this.components[e])||void 0===n?void 0:n.constrain(t))&&void 0!==i?i:t}));return this.asm_.fromComponents(e)}constructor(t){this.components=t.components,this.asm_=t.assembly}}const Ts=f("pndtxt");class Ms{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(Ts()),this.textViews.forEach((e=>{const n=t.createElement("div");n.classList.add(Ts("a")),n.appendChild(e.element),this.element.appendChild(n)}))}}function ks(t,e,n){return new Dn(t,{arrayPosition:0===n?"fst":n===e.axes.length-1?"lst":"mid",baseStep:e.axes[n].baseStep,parser:e.parser,props:e.axes[n].textProps,value:A(0,{constraint:e.axes[n].constraint}),viewProps:e.viewProps})}class Ps{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map(((n,i)=>ks(t,e,i))),this.acs_.forEach(((t,n)=>{bn({primary:this.value,secondary:t.value,forward:t=>e.assembly.toComponents(t.rawValue)[n],backward:(t,i)=>{const s=e.assembly.toComponents(t.rawValue);return s[n]=i.rawValue,e.assembly.fromComponents(s)}})})),this.view=new Ms(t,{textViews:this.acs_.map((t=>t.view))})}}function As(t){return"step"in t&&!l(t.step)?new ve(t.step):null}function Ss(t){return"max"in t&&!l(t.max)||"min"in t&&!l(t.min)?new de({max:t.max,min:t.min}):null}function Vs(t){const e=[],n=As(t);n&&e.push(n);const i=Ss(t);i&&e.push(i);const s=Gn(t.options);return s&&e.push(s),new ue(e)}function Os(t){const e=t?he(t,de):null;return e?[e.minValue,e.maxValue]:[void 0,void 0]}function Ds(t){const[e,n]=Os(t);return[null!=e?e:0,null!=n?n:100]}const Rs={id:"input-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;const n=I,i=N(e,{format:n.optional.function,max:n.optional.number,min:n.optional.number,options:n.optional.custom(zn),step:n.optional.number});return i?{initialValue:t,params:i}:null},binding:{reader:t=>ln,constraint:t=>Vs(t.params),writer:t=>qn},controller:t=>{var e,n;const i=t.value,s=t.constraint;if(s&&he(s,pe))return new _e(t.document,{props:S.fromObject({options:null!==(e=Kn(s))&&void 0!==e?e:[]}),value:i,viewProps:t.viewProps});const r=null!==(n="format"in t.params?t.params.format:void 0)&&void 0!==n?n:un($n(s,i.rawValue));if(s&&he(s,de)){const[e,n]=Ds(s);return new Bn(t.document,{baseStep:Xn(s),parser:an,sliderProps:S.fromObject({maxValue:n,minValue:e}),textProps:S.fromObject({draggingScale:Yn(s,i.rawValue),formatter:r}),value:i,viewProps:t.viewProps})}return new Dn(t.document,{baseStep:Xn(s),parser:an,props:S.fromObject({draggingScale:Yn(s,i.rawValue),formatter:r}),value:i,viewProps:t.viewProps})}};class Ls{getComponents(){return[this.x,this.y]}static isObject(t){if(l(t))return!1;const e=t.x,n=t.y;return"number"==typeof e&&"number"==typeof n}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}constructor(t=0,e=0){this.x=t,this.y=e}}const Is={toComponents:t=>t.getComponents(),fromComponents:t=>new Ls(...t)},Ns=f("p2d");class Fs{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ns()),e.viewProps.bindClassModifiers(this.element),b(e.expanded,y(this.element,Ns(void 0,"expanded")));const n=t.createElement("div");n.classList.add(Ns("h")),this.element.appendChild(n);const i=t.createElement("button");i.classList.add(Ns("b")),i.appendChild(Z(t,"p2dpad")),e.viewProps.bindDisabled(i),n.appendChild(i),this.buttonElement=i;const s=t.createElement("div");if(s.classList.add(Ns("t")),n.appendChild(s),this.textElement=s,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(Ns("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}const Bs=f("p2dp");class qs{get allFocusableElements(){return[this.padElement]}update_(){const[t,e]=this.value.rawValue.getComponents(),n=this.maxValue_,i=kn(t,-n,+n,0,100),s=kn(e,-n,+n,0,100),r=this.invertsY_?100-s:s;this.lineElem_.setAttributeNS(null,"x2",`${i}%`),this.lineElem_.setAttributeNS(null,"y2",`${r}%`),this.markerElem_.style.left=`${i}%`,this.markerElem_.style.top=`${r}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=e.invertsY,this.maxValue_=e.maxValue,this.element=t.createElement("div"),this.element.classList.add(Bs()),"popup"===e.layout&&this.element.classList.add(Bs(void 0,"p"));const n=t.createElement("div");n.classList.add(Bs("p")),e.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const i=t.createElementNS(U,"svg");i.classList.add(Bs("g")),this.padElement.appendChild(i),this.svgElem_=i;const s=t.createElementNS(U,"line");s.classList.add(Bs("ax")),s.setAttributeNS(null,"x1","0"),s.setAttributeNS(null,"y1","50%"),s.setAttributeNS(null,"x2","100%"),s.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(s);const r=t.createElementNS(U,"line");r.classList.add(Bs("ax")),r.setAttributeNS(null,"x1","50%"),r.setAttributeNS(null,"y1","0"),r.setAttributeNS(null,"x2","50%"),r.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(r);const o=t.createElementNS(U,"line");o.classList.add(Bs("l")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(o),this.lineElem_=o;const a=t.createElement("div");a.classList.add(Bs("m")),this.padElement.appendChild(a),this.markerElem_=a,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}}function zs(t,e,n){return[wn(e[0],yn(t)),wn(e[1],xn(t))*(n?1:-1)]}class js{handlePointerEvent_(t,e){if(!t.point)return;const n=this.maxValue_,i=kn(t.point.x,0,t.bounds.width,-n,+n),s=kn(this.invertsY_?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-n,+n);this.value.setRawValue(new Ls(i,s),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){En(t.key)&&t.preventDefault();const[e,n]=zs(t,this.baseSteps_,this.invertsY_);0===e&&0===n||this.value.setRawValue(new Ls(this.value.rawValue.x+e,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[e,n]=zs(t,this.baseSteps_,this.invertsY_);0===e&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.baseSteps_=e.baseSteps,this.maxValue_=e.maxValue,this.invertsY_=e.invertsY,this.view=new qs(t,{invertsY:this.invertsY_,layout:e.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Mn(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}}class Us{onPadButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,n=a(t.relatedTarget);n&&e.contains(n)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,n=nt(t);n&&e.contains(n)||n&&n===this.view.buttonElement&&!K(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.view.buttonElement.focus()}constructor(t,e){var n,i;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=ut.create(e.expanded),this.popC_="popup"===e.pickerLayout?new we(t,{viewProps:this.viewProps}):null;const s=new js(t,{baseSteps:[e.axes[0].baseStep,e.axes[1].baseStep],invertsY:e.invertsY,layout:e.pickerLayout,maxValue:e.maxValue,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=s,this.textC_=new Ps(t,{assembly:Is,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new Fs(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(n=this.view.buttonElement)||void 0===n||n.addEventListener("blur",this.onPadButtonBlur_),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),bn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),dt(this.foldable_,this.view.pickerElement))}}function Ws(t){return Ls.isObject(t)?new Ls(t.x,t.y):new Ls}function Gs(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y)}function Ks(t){if(!t)return;const e=[];return l(t.step)||e.push(new ve(t.step)),l(t.max)&&l(t.min)||e.push(new de({max:t.max,min:t.min})),new ue(e)}function Hs(t){return new Es({assembly:Is,components:[Ks("x"in t?t.x:void 0),Ks("y"in t?t.y:void 0)]})}function $s(t,e){const n=t&&he(t,de);if(n)return Math.max(Math.abs(n.minValue||0),Math.abs(n.maxValue||0));const i=Xn(t);return Math.max(10*Math.abs(i),10*Math.abs(e))}function Xs(t,e){const n=e instanceof Es?e.components[0]:void 0,i=e instanceof Es?e.components[1]:void 0,s=$s(n,t.x),r=$s(i,t.y);return Math.max(s,r)}function Ys(t,e){return{baseStep:Xn(e),constraint:e,textProps:S.fromObject({draggingScale:Yn(e,t),formatter:un($n(e,t))})}}function Zs(t){if(!("y"in t))return!1;const e=t.y;return!!e&&"inverted"in e&&!!e.inverted}const Qs={id:"input-point2d",type:"input",accept:(t,e)=>{if(!Ls.isObject(t))return null;const n=I,i=N(e,{expanded:n.optional.boolean,picker:n.optional.custom(jn),x:n.optional.custom(Un),y:n.optional.object({inverted:n.optional.boolean,max:n.optional.number,min:n.optional.number,step:n.optional.number})});return i?{initialValue:t,params:i}:null},binding:{reader:t=>Ws,constraint:t=>Hs(t.params),equals:Ls.equals,writer:t=>Gs},controller:t=>{const e=t.document,n=t.value,i=t.constraint;if(!(i instanceof Es))throw h.shouldNeverHappen();const s="expanded"in t.params?t.params.expanded:void 0,r="picker"in t.params?t.params.picker:void 0;return new Us(e,{axes:[Ys(n.rawValue.x,i.components[0]),Ys(n.rawValue.y,i.components[1])],expanded:null!=s&&s,invertsY:Zs(t.params),maxValue:Xs(n.rawValue,i),parser:an,pickerLayout:null!=r?r:"popup",value:n,viewProps:t.viewProps})}};class Js{getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(l(t))return!1;const e=t.x,n=t.y,i=t.z;return"number"==typeof e&&"number"==typeof n&&"number"==typeof i}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}}const tr={toComponents:t=>t.getComponents(),fromComponents:t=>new Js(...t)};function er(t){return Js.isObject(t)?new Js(t.x,t.y,t.z):new Js}function nr(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z)}function ir(t){if(!t)return;const e=[];return l(t.step)||e.push(new ve(t.step)),l(t.max)&&l(t.min)||e.push(new de({max:t.max,min:t.min})),new ue(e)}function sr(t){return new Es({assembly:tr,components:[ir("x"in t?t.x:void 0),ir("y"in t?t.y:void 0),ir("z"in t?t.z:void 0)]})}function rr(t,e){return{baseStep:Xn(e),constraint:e,textProps:S.fromObject({draggingScale:Yn(e,t),formatter:un($n(e,t))})}}const or={id:"input-point3d",type:"input",accept:(t,e)=>{if(!Js.isObject(t))return null;const n=I,i=N(e,{x:n.optional.custom(Un),y:n.optional.custom(Un),z:n.optional.custom(Un)});return i?{initialValue:t,params:i}:null},binding:{reader:t=>er,constraint:t=>sr(t.params),equals:Js.equals,writer:t=>nr},controller:t=>{const e=t.value,n=t.constraint;if(!(n instanceof Es))throw h.shouldNeverHappen();return new Ps(t.document,{assembly:tr,axes:[rr(e.rawValue.x,n.components[0]),rr(e.rawValue.y,n.components[1]),rr(e.rawValue.z,n.components[2])],parser:an,value:e,viewProps:t.viewProps})}};class ar{getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(l(t))return!1;const e=t.x,n=t.y,i=t.z,s=t.w;return"number"==typeof e&&"number"==typeof n&&"number"==typeof i&&"number"==typeof s}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}constructor(t=0,e=0,n=0,i=0){this.x=t,this.y=e,this.z=n,this.w=i}}const lr={toComponents:t=>t.getComponents(),fromComponents:t=>new ar(...t)};function cr(t){return ar.isObject(t)?new ar(t.x,t.y,t.z,t.w):new ar}function ur(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}function hr(t){if(!t)return;const e=[];return l(t.step)||e.push(new ve(t.step)),l(t.max)&&l(t.min)||e.push(new de({max:t.max,min:t.min})),new ue(e)}function pr(t){return new Es({assembly:lr,components:[hr("x"in t?t.x:void 0),hr("y"in t?t.y:void 0),hr("z"in t?t.z:void 0),hr("w"in t?t.w:void 0)]})}function dr(t,e){return{baseStep:Xn(e),constraint:e,textProps:S.fromObject({draggingScale:Yn(e,t),formatter:un($n(e,t))})}}const vr={id:"input-point4d",type:"input",accept:(t,e)=>{if(!ar.isObject(t))return null;const n=I,i=N(e,{x:n.optional.custom(Un),y:n.optional.custom(Un),z:n.optional.custom(Un),w:n.optional.custom(Un)});return i?{initialValue:t,params:i}:null},binding:{reader:t=>cr,constraint:t=>pr(t.params),equals:ar.equals,writer:t=>ur},controller:t=>{const e=t.value,n=t.constraint;if(!(n instanceof Es))throw h.shouldNeverHappen();return new Ps(t.document,{assembly:lr,axes:e.rawValue.getComponents().map(((t,e)=>dr(t,n.components[e]))),parser:an,value:e,viewProps:t.viewProps})}};function mr(t){const e=[],n=Gn(t.options);return n&&e.push(n),new ue(e)}const fr={id:"input-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;const n=N(e,{options:I.optional.custom(zn)});return n?{initialValue:t,params:n}:null},binding:{reader:t=>dn,constraint:t=>mr(t.params),writer:t=>qn},controller:t=>{var e;const n=t.document,i=t.value,s=t.constraint;return s&&he(s,pe)?new _e(n,{props:S.fromObject({options:null!==(e=Kn(s))&&void 0!==e?e:[]}),value:i,viewProps:t.viewProps}):new Ce(n,{parser:t=>t,props:S.fromObject({formatter:vn}),value:i,viewProps:t.viewProps})}},_r={monitor:{defaultInterval:200,defaultLineCount:3}},gr=f("mll");class br{update_(){const t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,n=[];this.value.rawValue.forEach((t=>{void 0!==t&&n.push(this.formatter_(t))})),t.textContent=n.join("\n"),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(gr()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("textarea");n.classList.add(gr("i")),n.style.height=`calc(var(--bld-us) * ${e.lineCount})`,n.readOnly=!0,e.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}}class wr{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new br(t,{formatter:e.formatter,lineCount:e.lineCount,value:this.value,viewProps:this.viewProps})}}const xr=f("sgl");class yr{update_(){const t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=void 0!==e?this.formatter_(e):""}onValueUpdate_(){this.update_()}constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(xr()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("input");n.classList.add(xr("i")),n.readOnly=!0,n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}}class Cr{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new yr(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}const Er={id:"monitor-bool",type:"monitor",accept:(t,e)=>{if("boolean"!=typeof t)return null;const n=N(e,{lineCount:I.optional.number});return n?{initialValue:t,params:n}:null},binding:{reader:t=>Te},controller:t=>{var e;return 1===t.value.rawValue.length?new Cr(t.document,{formatter:Me,value:t.value,viewProps:t.viewProps}):new wr(t.document,{formatter:Me,lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:_r.monitor.defaultLineCount,value:t.value,viewProps:t.viewProps})}};class Tr{get index(){return this.index_}set index(t){this.index_!==t&&(this.index_=t,this.emitter.emit("change",{index:t,sender:this}))}constructor(){this.emitter=new v,this.index_=-1}}const Mr=f("grl");class kr{get graphElement(){return this.svgElem_}update_(){const t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,n=this.minValue_,i=this.maxValue_,s=[];this.value.rawValue.forEach(((r,o)=>{if(void 0===r)return;const a=kn(o,0,e,0,t.width),l=kn(r,n,i,t.height,0);s.push([a,l].join(","))})),this.lineElem_.setAttributeNS(null,"points",s.join(" "));const r=this.tooltipElem_,o=this.value.rawValue[this.cursor_.index];if(void 0===o)return void r.classList.remove(Mr("t","a"));const a=kn(this.cursor_.index,0,e,0,t.width),l=kn(o,n,i,t.height,0);r.style.left=`${a}px`,r.style.top=`${l}px`,r.textContent=`${this.formatter_(o)}`,r.classList.contains(Mr("t","a"))||(r.classList.add(Mr("t","a"),Mr("t","in")),W(r),r.classList.remove(Mr("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Mr()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.minValue_=e.minValue,this.maxValue_=e.maxValue,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=t.createElementNS(U,"svg");n.classList.add(Mr("g")),n.style.height=`calc(var(--bld-us) * ${e.lineCount})`,this.element.appendChild(n),this.svgElem_=n;const i=t.createElementNS(U,"polyline");this.svgElem_.appendChild(i),this.lineElem_=i;const s=t.createElement("div");s.classList.add(Mr("t"),f("tt")()),this.element.appendChild(s),this.tooltipElem_=s,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}}class Pr{onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(t){const e=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(kn(t.offsetX,0,e.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){t.data.point?this.cursor_.index=Math.floor(kn(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1}onGraphPointerUp_(){this.cursor_.index=-1}constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.cursor_=new Tr,this.view=new kr(t,{cursor:this.cursor_,formatter:e.formatter,lineCount:e.lineCount,maxValue:e.maxValue,minValue:e.minValue,value:this.value,viewProps:this.viewProps}),K(t)){const t=new Mn(this.view.element);t.emitter.on("down",this.onGraphPointerDown_),t.emitter.on("move",this.onGraphPointerMove_),t.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}}function Ar(t){return"format"in t&&!l(t.format)?t.format:un(2)}function Sr(t){var e;return 1===t.value.rawValue.length?new Cr(t.document,{formatter:Ar(t.params),value:t.value,viewProps:t.viewProps}):new wr(t.document,{formatter:Ar(t.params),lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:_r.monitor.defaultLineCount,value:t.value,viewProps:t.viewProps})}function Vr(t){var e,n,i;return new Pr(t.document,{formatter:Ar(t.params),lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:_r.monitor.defaultLineCount,maxValue:null!==(n="max"in t.params?t.params.max:null)&&void 0!==n?n:100,minValue:null!==(i="min"in t.params?t.params.min:null)&&void 0!==i?i:0,value:t.value,viewProps:t.viewProps})}function Or(t){return"view"in t&&"graph"===t.view}const Dr={id:"monitor-number",type:"monitor",accept:(t,e)=>{if("number"!=typeof t)return null;const n=I,i=N(e,{format:n.optional.function,lineCount:n.optional.number,max:n.optional.number,min:n.optional.number,view:n.optional.string});return i?{initialValue:t,params:i}:null},binding:{defaultBufferSize:t=>Or(t)?64:1,reader:t=>ln},controller:t=>Or(t.params)?Vr(t):Sr(t)},Rr={id:"monitor-string",type:"monitor",accept:(t,e)=>{if("string"!=typeof t)return null;const n=I,i=N(e,{lineCount:n.optional.number,multiline:n.optional.boolean});return i?{initialValue:t,params:i}:null},binding:{reader:t=>dn},controller:t=>{var e;const n=t.value;return n.rawValue.length>1||"multiline"in t.params&&t.params.multiline?new wr(t.document,{formatter:vn,lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:_r.monitor.defaultLineCount,value:n,viewProps:t.viewProps}):new Cr(t.document,{formatter:vn,value:n,viewProps:t.viewProps})}};class Lr{read(){const t=this.target.read();void 0!==t&&(this.value.rawValue=this.reader(t))}write_(t){this.writer(this.target,t)}onValueChange_(t){this.write_(t.rawValue),this.emitter.emit("change",{options:t.options,rawValue:t.rawValue,sender:this})}constructor(t){this.onValueChange_=this.onValueChange_.bind(this),this.reader=t.reader,this.writer=t.writer,this.emitter=new v,this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.target=t.target,this.read()}}function Ir(t,e){const n=t.accept(e.target.read(),e.params);if(l(n))return null;const i=I,s={target:e.target,initialValue:n.initialValue,params:n.params},r=t.binding.reader(s),o=t.binding.constraint?t.binding.constraint(s):void 0,a=A(r(n.initialValue),{constraint:o,equals:t.binding.equals}),c=new Lr({reader:r,target:e.target,value:a,writer:t.binding.writer(s)}),u=i.optional.boolean(e.params.disabled).value,h=i.optional.boolean(e.params.hidden).value,p=t.controller({constraint:o,document:e.document,initialValue:n.initialValue,params:n.params,value:c.value,viewProps:Yt.create({disabled:u,hidden:h})}),d=i.optional.string(e.params.label).value;return new xt(e.document,{binding:c,blade:ct(),props:S.fromObject({label:d||e.target.key}),valueController:p})}class Nr{dispose(){this.ticker.dispose()}read(){const t=this.target.read();if(void 0===t)return;const e=this.value.rawValue,n=this.reader_(t);this.value.rawValue=gn(e,n),this.emitter.emit("update",{rawValue:n,sender:this})}onTick_(t){this.read()}constructor(t){this.onTick_=this.onTick_.bind(this),this.reader_=t.reader,this.target=t.target,this.emitter=new v,this.value=t.value,this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}}function Fr(t,e){return 0===e?new le:new ce(t,null!=e?e:_r.monitor.defaultInterval)}function Br(t,e){var n,i,s;const r=I,o=t.accept(e.target.read(),e.params);if(l(o))return null;const a={target:e.target,initialValue:o.initialValue,params:o.params},c=t.binding.reader(a),u=null!==(i=null!==(n=r.optional.number(e.params.bufferSize).value)&&void 0!==n?n:t.binding.defaultBufferSize&&t.binding.defaultBufferSize(o.params))&&void 0!==i?i:1,h=r.optional.number(e.params.interval).value,p=new Nr({reader:c,target:e.target,ticker:Fr(e.document,h),value:fn(u)}),d=r.optional.boolean(e.params.disabled).value,v=r.optional.boolean(e.params.hidden).value,m=t.controller({document:e.document,params:o.params,value:p.value,viewProps:Yt.create({disabled:d,hidden:v})}),f=null!==(s=r.optional.string(e.params.label).value)&&void 0!==s?s:e.target.key;return new Ct(e.document,{binding:p,blade:ct(),props:S.fromObject({label:f}),valueController:m})}class qr{getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t){"blade"===t.type?this.pluginsMap_.blades.unshift(t):"input"===t.type?this.pluginsMap_.inputs.unshift(t):"monitor"===t.type&&this.pluginsMap_.monitors.unshift(t)}createInput(t,e,n){if(l(e.read()))throw new h({context:{key:e.key},type:"nomatchingcontroller"});const i=this.pluginsMap_.inputs.reduce(((i,s)=>i||Ir(s,{document:t,target:e,params:n})),null);if(i)return i;throw new h({context:{key:e.key},type:"nomatchingcontroller"})}createMonitor(t,e,n){const i=this.pluginsMap_.monitors.reduce(((i,s)=>i||Br(s,{document:t,params:n,target:e})),null);if(i)return i;throw new h({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){const n=this.pluginsMap_.blades.reduce(((n,i)=>n||ae(i,{document:t,params:e})),null);if(!n)throw new h({type:"nomatchingview",context:{params:e}});return n}createBladeApi(t){if(t instanceof xt)return new wt(t);if(t instanceof Ct)return new yt(t);if(t instanceof Nt)return new kt(t,this);const e=this.pluginsMap_.blades.reduce(((e,n)=>e||n.api({controller:t,pool:this})),null);if(!e)throw h.shouldNeverHappen();return e}constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}}function zr(){const t=new qr;return[Qs,or,vr,fr,Rs,Cs,ys,ws,ei,Er,Rr,Dr,at,zt,Ht,oe].forEach((e=>{t.register(e)})),t}class jr extends n{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get options(){return this.controller_.valueController.props.get("options")}set options(t){this.controller_.valueController.props.set("options",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}constructor(t){super(t),this.emitter_=new v,this.controller_.valueController.value.emitter.on("change",(t=>{this.emitter_.emit("change",{event:new s(this,t.rawValue)})}))}}class Ur extends n{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(t){this.controller_.valueController.sliderController.props.set("maxValue",t)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(t){this.controller_.valueController.sliderController.props.set("minValue",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}constructor(t){super(t),this.emitter_=new v,this.controller_.valueController.value.emitter.on("change",(t=>{this.emitter_.emit("change",{event:new s(this,t.rawValue)})}))}}class Wr extends n{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(t){this.controller_.valueController.props.set("formatter",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}constructor(t){super(t),this.emitter_=new v,this.controller_.valueController.value.emitter.on("change",(t=>{this.emitter_.emit("change",{event:new s(this,t.rawValue)})}))}}const Gr={id:"list",type:"blade",accept(t){const e=I,n=N(t,{options:e.required.custom(zn),value:e.required.raw,view:e.required.constant("list"),label:e.optional.string});return n?{params:n}:null},controller(t){const e=new _e(t.document,{props:S.fromObject({options:Wn(t.params.options)}),value:A(t.params.value),viewProps:t.viewProps});return new jt(t.document,{blade:t.blade,props:S.fromObject({label:t.params.label}),valueController:e})},api:t=>t.controller instanceof jt&&t.controller.valueController instanceof _e?new jr(t.controller):null};function Kr(t){return t.reduce(((t,e)=>Object.assign(t,{[e.presetKey]:e.read()})),{})}function Hr(t,e){t.forEach((t=>{const n=e[t.presetKey];void 0!==n&&t.write(n)}))}class $r extends Pt{get element(){return this.controller_.view.element}importPreset(t){Hr(this.controller_.rackController.rack.find(xt).map((t=>t.binding.target)),t),this.refresh()}exportPreset(){return Kr(this.controller_.rackController.rack.find(xt).map((t=>t.binding.target)))}refresh(){this.controller_.rackController.rack.find(xt).forEach((t=>{t.binding.read()})),this.controller_.rackController.rack.find(Ct).forEach((t=>{t.binding.read()}))}constructor(t,e){super(t,e)}}class Xr extends qt{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}}const Yr={id:"slider",type:"blade",accept(t){const e=I,n=N(t,{max:e.required.number,min:e.required.number,view:e.required.constant("slider"),format:e.optional.function,label:e.optional.string,value:e.optional.number});return n?{params:n}:null},controller(t){var e,n;const i=null!==(e=t.params.value)&&void 0!==e?e:0,s=new Bn(t.document,{baseStep:1,parser:an,sliderProps:S.fromObject({maxValue:t.params.max,minValue:t.params.min}),textProps:S.fromObject({draggingScale:Yn(void 0,i),formatter:null!==(n=t.params.format)&&void 0!==n?n:cn}),value:A(i),viewProps:t.viewProps});return new jt(t.document,{blade:t.blade,props:S.fromObject({label:t.params.label}),valueController:s})},api:t=>t.controller instanceof jt&&t.controller.valueController instanceof Bn?new Ur(t.controller):null},Zr={id:"text",type:"blade",accept(t){const e=I,n=N(t,{parse:e.required.function,value:e.required.raw,view:e.required.constant("text"),format:e.optional.function,label:e.optional.string});return n?{params:n}:null},controller(t){var e;const n=new Ce(t.document,{parser:t.params.parse,props:S.fromObject({formatter:null!==(e=t.params.format)&&void 0!==e?e:t=>String(t)}),value:A(t.params.value),viewProps:t.viewProps});return new jt(t.document,{blade:t.blade,props:S.fromObject({label:t.params.label}),valueController:n})},api:t=>t.controller instanceof jt&&t.controller.valueController instanceof Ce?new Wr(t.controller):null};function Qr(t){const e=t.createElement("div");return e.classList.add(f("dfw")()),t.body&&t.body.appendChild(e),e}function Jr(t,e,n){if(t.querySelector(`style[data-tp-style=${e}]`))return;const i=t.createElement("style");i.dataset.tpStyle=e,i.textContent=n,t.head.appendChild(i)}class to extends $r{get document(){if(!this.doc_)throw h.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw h.alreadyDisposed();if(this.usesDefaultWrapper_){const e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach((t=>{this.pool_.register(t),this.embedPluginStyle_(t)}))}embedPluginStyle_(t){t.css&&Jr(this.document,`plugin-${t.id}`,t.css)}setUpDefaultPlugins_(){Jr(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach((t=>{this.embedPluginStyle_(t)})),this.registerPlugin({plugins:[Yr,Gr,oe,Zr]})}constructor(t){var e;const n=t||{},i=null!==(e=n.document)&&void 0!==e?e:$(),s=zr();super(new Xr(i,{expanded:n.expanded,blade:ct(),props:S.fromObject({title:n.title}),viewProps:Yt.create()}),s),this.pool_=s,this.containerElem_=n.container||Qr(i),this.containerElem_.appendChild(this.element),this.doc_=i,this.usesDefaultWrapper_=!n.container,this.setUpDefaultPlugins_()}}const eo=new e("3.0.8");t.BladeApi=n,t.ButtonApi=d,t.FolderApi=Pt,t.InputBindingApi=wt,t.ListApi=jr,t.MonitorBindingApi=yt,t.Pane=to,t.SeparatorApi=Ut,t.SliderApi=Ur,t.TabApi=ne,t.TabPageApi=ee,t.TextApi=Wr,t.TpChangeEvent=s,t.VERSION=eo,Object.defineProperty(t,"__esModule",{value:!0})}(o);var a={};function l(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function c(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,l(t,e,"get"))}function u(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function h(t,e,n){u(t,e),e.set(t,n)}function p(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,l(t,e,"set"),n),n}function d(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}function v(t,e){u(t,e),e.add(t)}function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){class e{get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(t){this.controller_.viewProps.set("hidden",t)}dispose(){this.controller_.viewProps.set("disposed",!0)}constructor(t){this.controller_=t}}class n{constructor(t){this.target=t}}class i extends n{constructor(t,e,n,i){super(t),this.value=e,this.presetKey=n,this.last=null==i||i}}function s(t){return t}function r(t){return null==t}const o={alreadydisposed:()=>"View has been already disposed",invalidparams:t=>`Invalid parameters for '${t.name}'`,nomatchingcontroller:t=>`No matching controller for '${t.key}'`,nomatchingview:t=>`No matching view for '${JSON.stringify(t.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:t=>`Property '${t.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class a{static alreadyDisposed(){return new a({type:"alreadydisposed"})}static notBindable(){return new a({type:"notbindable"})}static propertyNotFound(t){return new a({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new a({type:"shouldneverhappen"})}constructor(t){var e;this.message=null!==(e=o[t.type](s(t.context)))&&void 0!==e?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}}class l{on(t,e){let n=this.observers_[t];return n||(n=this.observers_[t]=[]),n.push({handler:e}),this}off(t,e){const n=this.observers_[t];return n&&(this.observers_[t]=n.filter((t=>t.handler!==e))),this}emit(t,e){const n=this.observers_[t];n&&n.forEach((t=>{t.handler(e)}))}constructor(){this.observers_={}}}const c="tp";function u(t){return(e,n)=>[c,"-",t,"v",e?`_${e}`:"",n?`-${n}`:""].join("")}function h(t,e){return n=>e(t(n))}function p(t){return t.rawValue}function d(t,e){t.emitter.on("change",h(p,e)),e(t.rawValue)}function v(t,e,n){d(t.value(e),n)}function m(t,e,n){n?t.classList.add(e):t.classList.remove(e)}function f(t,e){return n=>{m(t,e,n)}}function _(t,e){d(t,(t=>{e.textContent=null!=t?t:""}))}const g=u("btn");class b{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(g()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("button");n.classList.add(g("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=t.createElement("div");i.classList.add(g("t")),_(e.props.value("title"),i),this.buttonElement.appendChild(i)}}class w{onClick_(){this.emitter.emit("click",{sender:this})}constructor(t,e){this.emitter=new l,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new b(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}}class x{get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const n=null!=e?e:{forceEmit:!1,last:!0},i=this.constraint_?this.constraint_.constrain(t):t;(!this.equals_(this.rawValue_,i)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=i,this.emitter.emit("change",{options:n,rawValue:i,sender:this}))}constructor(t,e){var n;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(n=null==e?void 0:e.equals)&&void 0!==n?n:(t,e)=>t===e,this.emitter=new l,this.rawValue_=t}}class y{get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const n=null!=e?e:{forceEmit:!1,last:!0};(this.value_!==t||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:n,rawValue:this.value_,sender:this}))}constructor(t){this.emitter=new l,this.value_=t}}function C(t,e){const n=null==e?void 0:e.constraint,i=null==e?void 0:e.equals;return n||i?new x(t,e):new y(t)}class E{static createCore(t){return Object.keys(t).reduce(((e,n)=>Object.assign(e,{[n]:C(t[n])})),{})}static fromObject(t){const e=this.createCore(t);return new E(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}constructor(t){this.emitter=new l,this.valMap_=t;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",(()=>{this.emitter.emit("change",{key:t,sender:this})}))}}function T(t,e){return s(Object.keys(e).reduce(((n,i)=>{if(void 0===n)return;const s=(0,e[i])(t[i]);return s.succeeded?Object.assign(Object.assign({},n),{[i]:s.value}):void 0}),{}))}function M(t,e){return t.reduce(((t,n)=>{if(void 0===t)return;const i=e(n);return i.succeeded&&void 0!==i.value?[...t,i.value]:void 0}),[])}function k(t){return null!==t&&"object"==typeof t}function P(t){return e=>n=>{if(!e&&void 0===n)return{succeeded:!1,value:void 0};if(e&&void 0===n)return{succeeded:!0,value:void 0};const i=t(n);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function A(t){return{custom:e=>P(e)(t),boolean:P((t=>"boolean"==typeof t?t:void 0))(t),number:P((t=>"number"==typeof t?t:void 0))(t),string:P((t=>"string"==typeof t?t:void 0))(t),function:P((t=>"function"==typeof t?t:void 0))(t),constant:e=>P((t=>t===e?e:void 0))(t),raw:P((t=>t))(t),object:e=>P((t=>{if(k(t))return T(t,e)}))(t),array:e=>P((t=>{if(Array.isArray(t))return M(t,e)}))(t)}}const S={optional:A(!0),required:A(!1)};function V(t,e){const n=S.required.object(e)(t);return n.succeeded?n.value:void 0}function O(t){return t&&t.parentElement&&t.parentElement.removeChild(t),null}function D(){return["veryfirst","first","last","verylast"]}const R=u(""),L={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class I{get parent(){return this.parent_}constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{D().forEach((t=>{e.classList.remove(R(void 0,L[t]))})),this.blade.get("positions").forEach((t=>{e.classList.add(R(void 0,L[t]))}))})),this.viewProps.handleDispose((()=>{O(e)}))}}const N="http://www.w3.org/2000/svg";function F(t){t.offsetHeight}function B(t,e){const n=t.style.transition;t.style.transition="none",e(),t.style.transition=n}function q(t){return void 0!==t.ontouchstart}function z(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[0])}function j(t){return t.relatedTarget?s(t.relatedTarget):"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}const U=u("lbl");function W(t,e){const n=t.createDocumentFragment();return e.split("\n").map((e=>t.createTextNode(e))).forEach(((e,i)=>{i>0&&n.appendChild(t.createElement("br")),n.appendChild(e)})),n}class G{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(U()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(U("l")),v(e.props,"label",(e=>{r(e)?this.element.classList.add(U(void 0,"nol")):(this.element.classList.remove(U(void 0,"nol")),z(n),n.appendChild(W(t,e)))})),this.element.appendChild(n),this.labelElement=n;const i=t.createElement("div");i.classList.add(U("v")),this.element.appendChild(i),this.valueElement=i}}class K extends I{constructor(t,e){const n=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{view:new G(t,{props:e.props,viewProps:n}),viewProps:n})),this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class H extends I{constructor(t){super(t),this.value=t.value}}class $ extends E{static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=E.createCore(e);return new $(n)}get styleExpanded(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!r(t)?`${t}px`:"auto"}bindExpandedClass(t,e){v(this,"expanded",(()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)}))}constructor(t){super(t)}}function X(t){return $.create(t)}function Y(t,e){let n=0;return B(e,(()=>{t.set("expandedHeight",null),t.set("temporaryExpanded",!0),F(e),n=e.clientHeight,t.set("temporaryExpanded",null),F(e)})),n}function Z(t,e){e.style.height=t.styleHeight}function Q(t,e){t.value("expanded").emitter.on("beforechange",(()=>{t.set("completed",!1),r(t.get("expandedHeight"))&&t.set("expandedHeight",Y(t,e)),t.set("shouldFixHeight",!0),F(e)})),t.emitter.on("change",(()=>{Z(t,e)})),Z(t,e),e.addEventListener("transitionend",(e=>{"height"===e.propertyName&&(t.set("shouldFixHeight",!1),t.set("expandedHeight",null),t.set("completed",!0))}))}class J{constructor(t,e){const n=u(e.viewName);this.element=t.createElement("div"),this.element.classList.add(n()),e.viewProps.bindClassModifiers(this.element)}}class tt extends H{constructor(t,e){const n=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{value:e.valueController.value,view:new G(t,{props:e.props,viewProps:n}),viewProps:n})),this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const et=u("");function nt(t,e){return f(t,et(void 0,e))}class it extends E{static create(t){var e,n;const i=null!=t?t:{},s={disabled:null!==(e=i.disabled)&&void 0!==e&&e,disposed:!1,hidden:null!==(n=i.hidden)&&void 0!==n&&n},r=E.createCore(s);return new it(r)}bindClassModifiers(t){v(this,"disabled",nt(t,"disabled")),v(this,"hidden",nt(t,"hidden"))}bindDisabled(t){v(this,"disabled",(e=>{t.disabled=e}))}bindTabIndex(t){v(this,"disabled",(e=>{t.tabIndex=e?-1:0}))}handleDispose(t){this.value("disposed").emitter.on("change",(e=>{e&&t()}))}constructor(t){super(t)}}class st{dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}constructor(){this.disabled=!1,this.emitter=new l}}class rt{get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new l,this.interval_=e,this.setTimer_()}}class ot{constrain(t){return this.constraints.reduce(((t,e)=>e.constrain(t)),t)}constructor(t){this.constraints=t}}function at(t,e){if(t instanceof e)return t;if(t instanceof ot){const n=t.constraints.reduce(((t,n)=>t||(n instanceof e?n:null)),null);if(n)return n}return null}class lt{constrain(t){let e=t;return r(this.minValue)||(e=Math.max(e,this.minValue)),r(this.maxValue)||(e=Math.min(e,this.maxValue)),e}constructor(t){this.maxValue=t.max,this.minValue=t.min}}class ct{constrain(t){return(t<0?-Math.round(-t/this.step):Math.round(t/this.step))*this.step}constructor(t){this.step=t}}const ut=u("pop");class ht{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ut()),e.viewProps.bindClassModifiers(this.element),d(e.shows,f(this.element,ut(void 0,"v")))}}class pt{constructor(t,e){this.shows=C(!1),this.viewProps=e.viewProps,this.view=new ht(t,{shows:this.shows,viewProps:this.viewProps})}}const dt=u("txt");class vt{refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(dt()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);const n=t.createElement("input");n.classList.add(dt("i")),n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}}class mt{onInputChange_(t){const e=s(t.currentTarget).value,n=this.parser_(e);r(n)||(this.value.rawValue=n),this.view.refresh()}constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new vt(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}}class ft{evaluate(){return Number(this.text)}toString(){return this.text}constructor(t){this.text=t}}const _t={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class gt{evaluate(){const t=_t[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}constructor(t,e,n){this.left=e,this.operator=t,this.right=n}}const bt={"+":t=>t,"-":t=>-t,"~":t=>~t};class wt{evaluate(){const t=bt[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}constructor(t,e){this.operator=t,this.expression=e}}function xt(t){return(e,n)=>{for(let i=0;i<t.length;i++){const s=t[i](e,n);if(""!==s)return s}return""}}function yt(t,e){var n;const i=t.substr(e).match(/^\s+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function Ct(t,e){const n=t.substr(e,1);return n.match(/^[1-9]$/)?n:""}function Et(t,e){var n;const i=t.substr(e).match(/^[0-9]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function Tt(t,e){const n=Et(t,e);if(""!==n)return n;const i=t.substr(e,1);if("-"!==i&&"+"!==i)return"";const s=Et(t,e+=1);return""===s?"":i+s}function Mt(t,e){const n=t.substr(e,1);if(e+=1,"e"!==n.toLowerCase())return"";const i=Tt(t,e);return""===i?"":n+i}function kt(t,e){const n=t.substr(e,1);if("0"===n)return n;const i=Ct(t,e);return e+=i.length,""===i?"":i+Et(t,e)}function Pt(t,e){const n=kt(t,e);if(e+=n.length,""===n)return"";const i=t.substr(e,1);if(e+=i.length,"."!==i)return"";const s=Et(t,e);return n+i+s+Mt(t,e+=s.length)}function At(t,e){const n=t.substr(e,1);if(e+=n.length,"."!==n)return"";const i=Et(t,e);return e+=i.length,""===i?"":n+i+Mt(t,e)}function St(t,e){const n=kt(t,e);return e+=n.length,""===n?"":n+Mt(t,e)}const Vt=xt([Pt,At,St]);function Ot(t,e){var n;const i=t.substr(e).match(/^[01]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function Dt(t,e){const n=t.substr(e,2);if(e+=n.length,"0b"!==n.toLowerCase())return"";const i=Ot(t,e);return""===i?"":n+i}function Rt(t,e){var n;const i=t.substr(e).match(/^[0-7]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function Lt(t,e){const n=t.substr(e,2);if(e+=n.length,"0o"!==n.toLowerCase())return"";const i=Rt(t,e);return""===i?"":n+i}function It(t,e){var n;const i=t.substr(e).match(/^[0-9a-f]+/i);return null!==(n=i&&i[0])&&void 0!==n?n:""}function Nt(t,e){const n=t.substr(e,2);if(e+=n.length,"0x"!==n.toLowerCase())return"";const i=It(t,e);return""===i?"":n+i}const Ft=xt([Dt,Lt,Nt]),Bt=xt([Ft,Vt]);function qt(t,e){const n=Bt(t,e);return e+=n.length,""===n?null:{evaluable:new ft(n),cursor:e}}function zt(t,e){const n=t.substr(e,1);if(e+=n.length,"("!==n)return null;const i=Ht(t,e);if(!i)return null;e=i.cursor,e+=yt(t,e).length;const s=t.substr(e,1);return e+=s.length,")"!==s?null:{evaluable:i.evaluable,cursor:e}}function jt(t,e){return qt(t,e)||zt(t,e)}function Ut(t,e){const n=jt(t,e);if(n)return n;const i=t.substr(e,1);if(e+=i.length,"+"!==i&&"-"!==i&&"~"!==i)return null;const s=Ut(t,e);return s?{cursor:e=s.cursor,evaluable:new wt(i,s.evaluable)}:null}function Wt(t,e,n){n+=yt(e,n).length;const i=t.filter((t=>e.startsWith(t,n)))[0];return i?(n+=i.length,{cursor:n+=yt(e,n).length,operator:i}):null}function Gt(t,e){return(n,i)=>{const s=t(n,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const s=Wt(e,n,i);if(!s)break;i=s.cursor;const o=t(n,i);if(!o)return null;i=o.cursor,r=new gt(s.operator,r,o.evaluable)}return r?{cursor:i,evaluable:r}:null}}const Kt=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((t,e)=>Gt(t,e)),Ut);function Ht(t,e){return e+=yt(t,e).length,Kt(t,e)}function $t(t){const e=Ht(t,0);return e?e.cursor+yt(t,e.cursor).length!==t.length?null:e.evaluable:null}function Xt(t){var e;const n=$t(t);return null!==(e=null==n?void 0:n.evaluate())&&void 0!==e?e:null}function Yt(t){if("number"==typeof t)return t;if("string"==typeof t){const e=Xt(t);if(!r(e))return e}return 0}function Zt(t){return e=>e.toFixed(Math.max(Math.min(t,20),0))}function Qt(t,e){for(;t.length<e;)t.push(void 0)}function Jt(t){const e=[];return Qt(e,t),C(e)}function te(t){const e=t.indexOf(void 0);return s(e<0?t:t.slice(0,e))}function ee(t,e){const n=[...te(t),e];return n.length>t.length?n.splice(0,n.length-t.length):Qt(n,t.length),n}function ne({primary:t,secondary:e,forward:n,backward:i}){let s=!1;function r(t){s||(s=!0,t(),s=!1)}t.emitter.on("change",(i=>{r((()=>{e.setRawValue(n(t,e),i.options)}))})),e.emitter.on("change",(s=>{r((()=>{t.setRawValue(i(t,e),s.options)})),r((()=>{e.setRawValue(n(t,e),s.options)}))})),r((()=>{e.setRawValue(n(t,e),{forceEmit:!1,last:!0})}))}function ie(t,e){const n=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+n:e.downKey?-n:0}function se(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function re(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function oe(t){return"ArrowUp"===t||"ArrowDown"===t}function ae(t){return oe(t)||"ArrowLeft"===t||"ArrowRight"===t}function le(t,e){const n=e.ownerDocument.defaultView,i=e.getBoundingClientRect();return{x:t.pageX-((n&&n.scrollX||0)+i.left),y:t.pageY-((n&&n.scrollY||0)+i.top)}}class ce{computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(le(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(le(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(le(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const n=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(n?{x:n.clientX-i.left,y:n.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey})}constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new l,t.addEventListener("touchstart",this.onTouchStart_),t.addEventListener("touchmove",this.onTouchMove_),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}}function ue(t,e,n,i,s){return i+(t-e)/(n-e)*(s-i)}function he(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function pe(t,e,n){return Math.min(Math.max(t,e),n)}const de=u("txt");class ve{onDraggingChange_(t){if(null===t.rawValue)return void this.element.classList.remove(de(void 0,"drg"));this.element.classList.add(de(void 0,"drg"));const e=t.rawValue/this.props_.get("draggingScale"),n=e+(e>0?-1:e<0?1:0),i=pe(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+i},0 L${n},4 L${n+i},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const s=this.props_.get("formatter");this.tooltipElem_.textContent=s(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(de(),de(void 0,"num")),e.arrayPosition&&this.element.classList.add(de(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("input");n.classList.add(de("i")),n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(de()),this.inputElement.classList.add(de("i"));const i=t.createElement("div");i.classList.add(de("k")),this.element.appendChild(i),this.knobElement=i;const s=t.createElementNS(N,"svg");s.classList.add(de("g")),this.knobElement.appendChild(s);const r=t.createElementNS(N,"path");r.classList.add(de("gb")),s.appendChild(r),this.guideBodyElem_=r;const o=t.createElementNS(N,"path");o.classList.add(de("gh")),s.appendChild(o),this.guideHeadElem_=o;const a=t.createElement("div");a.classList.add(u("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}}class me{onInputChange_(t){const e=s(t.currentTarget).value,n=this.parser_(e);r(n)||(this.value.rawValue=n),this.view.refresh()}onInputKeyDown_(t){const e=ie(this.baseStep_,se(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onInputKeyUp_(t){0!==ie(this.baseStep_,se(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.originRawValue_+e*this.props.get("draggingScale")}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}constructor(t,e){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=C(null),this.view=new ve(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const n=new ce(this.view.knobElement);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}}function fe(t,e){t.write(e)}function _e(t){const e=t?at(t,ct):null;return e?e.step:null}function ge(t,e){const n=t&&at(t,ct);return n?he(n.step):Math.max(he(e),2)}function be(t){const e=_e(t);return null!=e?e:1}function we(t,e){var n;const i=t&&at(t,ct),s=Math.abs(null!==(n=null==i?void 0:i.step)&&void 0!==n?n:e);return 0===s?.1:Math.pow(10,Math.floor(Math.log10(s))-1)}class xe{constrain(t){const e=this.asm_.toComponents(t).map(((t,e)=>{var n,i;return null!==(i=null===(n=this.components[e])||void 0===n?void 0:n.constrain(t))&&void 0!==i?i:t}));return this.asm_.fromComponents(e)}constructor(t){this.components=t.components,this.asm_=t.assembly}}const ye=u("pndtxt");class Ce{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(ye()),this.textViews.forEach((e=>{const n=t.createElement("div");n.classList.add(ye("a")),n.appendChild(e.element),this.element.appendChild(n)}))}}function Ee(t,e,n){return new me(t,{arrayPosition:0===n?"fst":n===e.axes.length-1?"lst":"mid",baseStep:e.axes[n].baseStep,parser:e.parser,props:e.axes[n].textProps,value:C(0,{constraint:e.axes[n].constraint}),viewProps:e.viewProps})}class Te{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map(((n,i)=>Ee(t,e,i))),this.acs_.forEach(((t,n)=>{ne({primary:this.value,secondary:t.value,forward:t=>e.assembly.toComponents(t.rawValue)[n],backward:(t,i)=>{const s=e.assembly.toComponents(t.rawValue);return s[n]=i.rawValue,e.assembly.fromComponents(s)}})})),this.view=new Ce(t,{textViews:this.acs_.map((t=>t.view))})}}function Me(t){return"step"in t&&!r(t.step)?new ct(t.step):null}function ke(t){return"max"in t&&!r(t.max)||"min"in t&&!r(t.min)?new lt({max:t.max,min:t.min}):null}const Pe={monitor:{defaultInterval:200,defaultLineCount:3}};class Ae{get index(){return this.index_}set index(t){this.index_!==t&&(this.index_=t,this.emitter.emit("change",{index:t,sender:this}))}constructor(){this.emitter=new l,this.index_=-1}}const Se=u("grl");class Ve{get graphElement(){return this.svgElem_}update_(){const t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,n=this.minValue_,i=this.maxValue_,s=[];this.value.rawValue.forEach(((r,o)=>{if(void 0===r)return;const a=ue(o,0,e,0,t.width),l=ue(r,n,i,t.height,0);s.push([a,l].join(","))})),this.lineElem_.setAttributeNS(null,"points",s.join(" "));const r=this.tooltipElem_,o=this.value.rawValue[this.cursor_.index];if(void 0===o)return void r.classList.remove(Se("t","a"));const a=ue(this.cursor_.index,0,e,0,t.width),l=ue(o,n,i,t.height,0);r.style.left=`${a}px`,r.style.top=`${l}px`,r.textContent=`${this.formatter_(o)}`,r.classList.contains(Se("t","a"))||(r.classList.add(Se("t","a"),Se("t","in")),F(r),r.classList.remove(Se("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Se()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.minValue_=e.minValue,this.maxValue_=e.maxValue,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=t.createElementNS(N,"svg");n.classList.add(Se("g")),n.style.height=`calc(var(--bld-us) * ${e.lineCount})`,this.element.appendChild(n),this.svgElem_=n;const i=t.createElementNS(N,"polyline");this.svgElem_.appendChild(i),this.lineElem_=i;const s=t.createElement("div");s.classList.add(Se("t"),u("tt")()),this.element.appendChild(s),this.tooltipElem_=s,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}}class Oe{onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(t){const e=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(ue(t.offsetX,0,e.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){t.data.point?this.cursor_.index=Math.floor(ue(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1}onGraphPointerUp_(){this.cursor_.index=-1}constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.cursor_=new Ae,this.view=new Ve(t,{cursor:this.cursor_,formatter:e.formatter,lineCount:e.lineCount,maxValue:e.maxValue,minValue:e.minValue,value:this.value,viewProps:this.viewProps}),q(t)){const t=new ce(this.view.element);t.emitter.on("down",this.onGraphPointerDown_),t.emitter.on("move",this.onGraphPointerMove_),t.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}}class De{get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get title(){var t;return null!==(t=this.controller_.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller_.props.set("title",t)}on(t,e){const i=e.bind(this);return this.controller_.emitter.on(t,(()=>{i(new n(this))})),this}constructor(t){this.controller_=t}}class Re extends n{constructor(t,e,n){super(t),this.cell=e,this.index=n}}class Le extends e{cell(t,e){const n=this.controller_.valueController,i=n.cellControllers[e*n.size[0]+t];return this.cellToApiMap_.get(i)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}constructor(t){super(t),this.cellToApiMap_=new Map,this.emitter_=new l;const e=this.controller_.valueController;e.cellControllers.forEach(((t,n)=>{const i=new De(t);this.cellToApiMap_.set(t,i),t.emitter.on("click",(()=>{const t=n%e.size[0],s=Math.floor(n/e.size[0]);this.emitter_.emit("click",{event:new Re(this,i,[t,s])})}))}))}}class Ie{get cellControllers(){return this.cellCs_}constructor(t,e){this.size=e.size;const[n,i]=this.size,s=[];for(let r=0;r<i;r++)for(let i=0;i<n;i++){const n=new w(t,{props:E.fromObject(Object.assign({},e.cellConfig(i,r))),viewProps:it.create()});s.push(n)}this.cellCs_=s,this.viewProps=it.create(),this.viewProps.handleDispose((()=>{this.cellCs_.forEach((t=>{t.viewProps.set("disposed",!0)}))})),this.view=new J(t,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${n}, 1fr)`,this.cellCs_.forEach((t=>{this.view.element.appendChild(t.view.element)}))}}const Ne={id:"buttongrid",type:"blade",css:".tp-cbzv_b,.tp-rslv_k,.tp-radv_b,.tp-cbzgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-cbzv_b,.tp-rslv_k,.tp-radv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-cbzv_b:hover,.tp-rslv_k:hover,.tp-radv_b:hover{background-color:var(--btn-bg-h)}.tp-cbzv_b:focus,.tp-rslv_k:focus,.tp-radv_b:focus{background-color:var(--btn-bg-f)}.tp-cbzv_b:active,.tp-rslv_k:active,.tp-radv_b:active{background-color:var(--btn-bg-a)}.tp-cbzv_b:disabled,.tp-rslv_k:disabled,.tp-radv_b:disabled{opacity:0.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:0.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:0.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:0.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1 * var(--cnt-h-p));position:absolute;right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:0.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us) * 5);width:100%}.tp-cbzgv_u{opacity:0.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:transparent;stroke:var(--in-fg)}.tp-cbzgv_v{opacity:0.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:0.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity 0.2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:0.2em;opacity:0.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:0.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:'';height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:'';height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px) / -2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:0.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:0.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:0.5}.tp-radgridv .tp-radv_b{border-radius:0}",accept(t){const e=S,n=V(t,{cells:e.required.function,size:e.required.array(e.required.number),view:e.required.constant("buttongrid"),label:e.optional.string});return n?{params:n}:null},controller:t=>new K(t.document,{blade:t.blade,props:E.fromObject({label:t.params.label}),valueController:new Ie(t.document,{cellConfig:t.params.cells,size:t.params.size})}),api:t=>t.controller instanceof K&&t.controller.valueController instanceof Ie?new Le(t.controller):null};class Fe extends e{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);return this.controller_.valueController.value.emitter.on(t,(t=>{n(new i(this,t.rawValue,void 0,t.options.last))})),this}}function Be(t,e,n){return t*(1-n)+e*n}const qe=20,ze=.001,je=100;function Ue(t,e){let n=.25,i=.5,s=-1;for(let r=0;r<qe;r++){const[r,o]=t.curve(i);if(i+=n*(r<e?1:-1),s=o,n*=.5,Math.abs(e-r)<ze)break}return s}class We{get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(t){return!r(t)&&!!Array.isArray(t)&&"number"==typeof t[0]&&"number"==typeof t[1]&&"number"==typeof t[2]&&"number"==typeof t[3]}static equals(t,e){return t.x1===e.x1&&t.y1===e.y1&&t.x2===e.x2&&t.y2===e.y2}curve(t){const e=Be(0,this.x1,t),n=Be(0,this.y1,t),i=Be(this.x1,this.x2,t),s=Be(this.y1,this.y2,t),r=Be(this.x2,1,t),o=Be(this.y2,1,t),a=Be(e,i,t),l=Be(n,s,t),c=Be(i,r,t),u=Be(s,o,t);return[Be(a,c,t),Be(l,u,t)]}y(t){if(0===this.cache_.length){const t=[];for(let e=0;e<je;e++)t.push(Ue(this,ue(e,0,je-1,0,1)));this.cache_=t}return this.cache_[Math.round(ue(pe(t,0,1),0,1,0,je-1))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}constructor(t=0,e=0,n=1,i=1){this.cache_=[],this.comps_=[t,e,n,i]}}const Ge={toComponents:t=>t.toObject(),fromComponents:t=>new We(...t)};function Ke(t){const e=Zt(2);return`cubic-bezier(${t.toObject().map((t=>e(t))).join(", ")})`}const He=[0,.5,.5,1];function $e(t){const e=t.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!e)return new We(...He);const n=[e[1],e[2],e[3],e[4]].reduce(((t,e)=>{if(!t)return null;const n=Number(e);return isNaN(n)?null:[...t,n]}),[]);return new We(...null!=n?n:He)}const Xe=u("cbz");class Ye{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Xe()),e.viewProps.bindClassModifiers(this.element),e.foldable.bindExpandedClass(this.element,Xe(void 0,"expanded")),v(e.foldable,"completed",f(this.element,Xe(void 0,"cpl")));const n=t.createElement("div");n.classList.add(Xe("h")),this.element.appendChild(n);const i=t.createElement("button");i.classList.add(Xe("b")),e.viewProps.bindDisabled(i);const s=t.createElementNS(N,"svg");s.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',i.appendChild(s),n.appendChild(i),this.buttonElement=i;const r=t.createElement("div");if(r.classList.add(Xe("t")),n.appendChild(r),this.textElement=r,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(Xe("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}const Ze=u("cbzp");class Qe{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ze()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(Ze("g")),this.element.appendChild(n),this.graphElement=n;const i=t.createElement("div");i.classList.add(Ze("t")),this.element.appendChild(i),this.textElement=i}}function Je(t,e){const n=new MutationObserver((t=>{for(const i of t)"childList"===i.type&&i.addedNodes.forEach((t=>{t.contains(t)&&(e(),n.disconnect())}))})),i=t.ownerDocument;n.observe(i.body,{attributes:!0,childList:!0,subtree:!0})}const tn=u("cbzg");function en(t,e){return n=>e(t(n))}class nn{getVertMargin_(t){return.25*t}valueToPosition(t,e){const n=this.element.getBoundingClientRect(),i=n.width,s=n.height,r=this.getVertMargin_(s);return{x:ue(t,0,1,0,i),y:ue(e,0,1,s-r,r)}}positionToValue(t,e){const n=this.element.getBoundingClientRect(),i=n.width,s=n.height,r=this.getVertMargin_(s);return{x:pe(ue(t,0,i,0,1),0,1),y:ue(e,s-r,r,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map((t=>{const e=this.valueToPosition(0,t),n=this.valueToPosition(1,t);return[`M ${e.x},${e.y}`,`L ${n.x},${n.y}`].join(" ")})).join(" "));const t=this.value_.rawValue,e=[];let n=0;for(;;){const i=this.valueToPosition(...t.curve(n));if(e.push([i.x,i.y].join(",")),n>=1)break;n=Math.min(n+.05,1)}this.lineElem_.setAttributeNS(null,"points",e.join(" "));const i=t.toObject();[0,1].forEach((t=>{const e=this.valueToPosition(t,t),n=this.valueToPosition(i[2*t],i[2*t+1]),s=this.vectorElems_[t];s.setAttributeNS(null,"x1",String(e.x)),s.setAttributeNS(null,"y1",String(e.y)),s.setAttributeNS(null,"x2",String(n.x)),s.setAttributeNS(null,"y2",String(n.y));const r=this.handleElems_[t];r.style.left=`${n.x}px`,r.style.top=`${n.y}px`}))}onValueChange_(){this.refresh()}constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(tn()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const n=t.createElement("div");n.classList.add(tn("p")),this.element.appendChild(n),this.previewElement=n;const i=t.createElementNS(N,"svg");i.classList.add(tn("g")),this.element.appendChild(i),this.svgElem_=i;const s=t.createElementNS(N,"path");s.classList.add(tn("u")),this.svgElem_.appendChild(s),this.guideElem_=s;const r=t.createElementNS(N,"polyline");r.classList.add(tn("l")),this.svgElem_.appendChild(r),this.lineElem_=r,this.handleElems_=[t.createElement("div"),t.createElement("div")],this.handleElems_.forEach((t=>{t.classList.add(tn("h")),this.element.appendChild(t)})),this.vectorElems_=[t.createElementNS(N,"line"),t.createElementNS(N,"line")],this.vectorElems_.forEach((t=>{t.classList.add(tn("v")),this.svgElem_.appendChild(t)})),this.value_=e.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=e.selection,this.handleElems_.forEach(((t,e)=>{d(this.sel_,en((t=>t===e),f(t,tn("h","sel"))))})),Je(this.element,(()=>{this.refresh()}))}}const sn=24,rn=400,on=1e3,an=u("cbzprv");class ln{play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(an("m","a")),this.startTime_=(new Date).getTime()+rn,this.stopped_=!1,requestAnimationFrame(this.onTimer_)}stop(){this.stopped_=!0,this.markerElem_.classList.remove(an("m","a"))}onDispose_(){this.stop()}updateMarker_(t){const e=this.value_.rawValue.y(pe(t,0,1));this.markerElem_.style.left=100*e+"%"}refresh(){const t=this.svgElem_.getBoundingClientRect(),e=t.width,n=t.height,i=[],s=this.value_.rawValue;for(let t=0;t<sn;t++){const r=ue(t,0,sn-1,0,1),o=ue(s.y(r),0,1,0,e);i.push(`M ${o},0 v${n}`)}this.ticksElem_.setAttributeNS(null,"d",i.join(" "))}onTimer_(){if(null===this.startTime_)return;const t=(new Date).getTime()-this.startTime_,e=t/on;this.updateMarker_(e),t>on+rn&&this.stop(),this.stopped_||requestAnimationFrame(this.onTimer_)}onValueChange_(){this.refresh(),this.play()}constructor(t,e){this.stopped_=!0,this.startTime_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(an()),e.viewProps.bindClassModifiers(this.element);const n=t.createElementNS(N,"svg");n.classList.add(an("g")),this.element.appendChild(n),this.svgElem_=n;const i=t.createElementNS(N,"path");i.classList.add(an("t")),this.svgElem_.appendChild(i),this.ticksElem_=i;const s=t.createElement("div");s.classList.add(an("m")),this.element.appendChild(s),this.markerElem_=s,this.value_=e.value,this.value_.emitter.on("change",this.onValueChange_),e.viewProps.handleDispose(this.onDispose_),Je(this.element,(()=>{this.refresh()}))}}function cn(t,e,n,i){const s=n-t,r=i-e;return Math.sqrt(s*s+r*r)}function un(t,e,n,i){const s=cn(t,e,n,i),r=Math.atan2(i-e,n-t),o=Math.round(r/(Math.PI/4))*Math.PI/4;return{x:t+Math.cos(o)*s,y:e+Math.sin(o)*s}}class hn{refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(t,e,n){const i=this.sel_.rawValue,s=this.value.rawValue.toObject(),r=this.view.positionToValue(t.x,t.y),o=e?un(i,i,r.x,r.y):r;s[2*i]=o.x,s[2*i+1]=o.y,this.value.setRawValue(new We(...s),n)}onPointerDown_(t){const e=t.data;if(!e.point)return;const n=this.value.rawValue,i=this.view.valueToPosition(n.x1,n.y1),s=cn(e.point.x,e.point.y,i.x,i.y),r=this.view.valueToPosition(n.x2,n.y2),o=cn(e.point.x,e.point.y,r.x,r.y);this.sel_.rawValue=s<=o?0:1,this.updateValue_(e.point,t.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(t){const e=t.data;e.point&&this.updateValue_(e.point,t.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(t){const e=t.data;e.point&&this.updateValue_(e.point,t.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(t){ae(t.key)&&t.preventDefault();const e=this.sel_.rawValue,n=this.value.rawValue.toObject();n[2*e]+=ie(this.baseStep_,re(t)),n[2*e+1]+=ie(this.baseStep_,se(t)),this.value.setRawValue(new We(...n),{forceEmit:!1,last:!1})}onKeyUp_(t){ae(t.key)&&t.preventDefault();const e=ie(this.baseStep_,re(t)),n=ie(this.baseStep_,se(t));0===e&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.value=e.value,this.sel_=C(0),this.viewProps=e.viewProps,this.view=new nn(t,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new ln(t,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",(t=>{t.stopImmediatePropagation(),t.preventDefault(),this.prevView_.play()})),this.view.previewElement.appendChild(this.prevView_.element);const n=new ce(this.view.element);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}}class pn{get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map((t=>t.inputElement))]}refresh(){this.gc_.refresh()}constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Qe(t,{viewProps:this.viewProps}),this.gc_=new hn(t,{baseStep:e.axis.baseStep,value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);const n=Object.assign(Object.assign({},e.axis),{constraint:new lt({max:1,min:0})}),i=Object.assign(Object.assign({},e.axis),{constraint:void 0});this.tc_=new Te(t,{assembly:Ge,axes:[n,i,n,i],parser:Xt,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}}class dn{onButtonBlur_(t){if(!this.popC_)return;const e=s(t.relatedTarget);e&&this.popC_.view.element.contains(e)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,n=j(t);n&&e.contains(n)||n&&n===this.view.buttonElement&&!q(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_&&"Escape"===t.key&&(this.popC_.shows.rawValue=!1)}constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=X(e.expanded),this.view=new Ye(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new mt(t,{parser:$e,props:E.fromObject({formatter:Ke}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_="popup"===e.pickerLayout?new pt(t,{viewProps:this.viewProps}):null;const n=new pn(t,{axis:e.axis,value:this.value,viewProps:this.viewProps});n.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=n,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),d(this.popC_.shows,(t=>{t&&n.refresh()})),ne({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Q(this.foldable_,this.view.pickerElement))}}function vn(){return new xe({assembly:Ge,components:[0,1,2,3].map((t=>t%2==0?new lt({min:0,max:1}):void 0))})}const mn={id:"cubic-bezier",type:"blade",css:".tp-cbzv_b,.tp-rslv_k,.tp-radv_b,.tp-cbzgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-cbzv_b,.tp-rslv_k,.tp-radv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-cbzv_b:hover,.tp-rslv_k:hover,.tp-radv_b:hover{background-color:var(--btn-bg-h)}.tp-cbzv_b:focus,.tp-rslv_k:focus,.tp-radv_b:focus{background-color:var(--btn-bg-f)}.tp-cbzv_b:active,.tp-rslv_k:active,.tp-radv_b:active{background-color:var(--btn-bg-a)}.tp-cbzv_b:disabled,.tp-rslv_k:disabled,.tp-radv_b:disabled{opacity:0.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:0.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:0.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:0.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1 * var(--cnt-h-p));position:absolute;right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:0.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us) * 5);width:100%}.tp-cbzgv_u{opacity:0.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:transparent;stroke:var(--in-fg)}.tp-cbzgv_v{opacity:0.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:0.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity 0.2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:0.2em;opacity:0.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:0.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:'';height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:'';height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px) / -2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:0.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:0.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:0.5}.tp-radgridv .tp-radv_b{border-radius:0}",accept(t){const e=S,n=V(t,{value:e.required.array(e.required.number),view:e.required.constant("cubicbezier"),expanded:e.optional.boolean,label:e.optional.string,picker:e.optional.custom((t=>"inline"===t||"popup"===t?t:void 0))});return n?{params:n}:null},controller(t){var e,n;const i=C(new We(...t.params.value),{constraint:vn(),equals:We.equals}),s=new dn(t.document,{axis:{baseStep:.1,textProps:E.fromObject({draggingScale:.01,formatter:Zt(2)})},expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,pickerLayout:null!==(n=t.params.picker)&&void 0!==n?n:"popup",value:i,viewProps:t.viewProps});return new tt(t.document,{blade:t.blade,props:E.fromObject({label:t.params.label}),valueController:s})},api:t=>t.controller instanceof tt&&t.controller.valueController instanceof dn?new Fe(t.controller):null};class fn extends e{begin(){this.controller_.valueController.begin()}end(){this.controller_.valueController.end()}}const _n=20;class gn{get duration(){return this.duration_}get fps(){return this.fps_}begin(t){this.start_=t.getTime()}calculateFps_(t){if(0===this.timestamps_.length)return null;const e=this.timestamps_[0];return 1e3*(this.frameCount_-e.frameCount)/(t-e.time)}compactTimestamps_(){if(this.timestamps_.length<=_n)return;const t=this.timestamps_.length-_n;this.timestamps_.splice(0,t);const e=this.timestamps_[0].frameCount;this.timestamps_.forEach((t=>{t.frameCount-=e})),this.frameCount_-=e}end(t){if(null===this.start_)return;const e=t.getTime();this.duration_=e-this.start_,this.start_=null,this.fps_=this.calculateFps_(e),this.timestamps_.push({frameCount:this.frameCount_,time:e}),++this.frameCount_,this.compactTimestamps_()}constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}}const bn=u("fps");class wn{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(bn()),e.viewProps.bindClassModifiers(this.element),this.graphElement=t.createElement("div"),this.graphElement.classList.add(bn("g")),this.element.appendChild(this.graphElement);const n=t.createElement("div");n.classList.add(bn("l")),this.element.appendChild(n);const i=t.createElement("span");i.classList.add(bn("v")),i.textContent="--",n.appendChild(i),this.valueElement=i;const s=t.createElement("span");s.classList.add(bn("u")),s.textContent="FPS",n.appendChild(s)}}class xn{begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){const t=this.stopwatch_.fps;if(null!==t){const e=this.value_.rawValue;this.value_.rawValue=ee(e,t),this.view.valueElement.textContent=t.toFixed(0)}}constructor(t,e){this.stopwatch_=new gn,this.onTick_=this.onTick_.bind(this),this.ticker_=e.ticker,this.ticker_.emitter.on("tick",this.onTick_),this.value_=e.value,this.viewProps=e.viewProps,this.view=new wn(t,{viewProps:this.viewProps}),this.graphC_=new Oe(t,{formatter:Zt(0),lineCount:e.lineCount,maxValue:e.maxValue,minValue:e.minValue,value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose((()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker_.dispose()}))}}function yn(t,e){return 0===e?new st:new rt(t,null!=e?e:Pe.monitor.defaultInterval)}const Cn={id:"fpsgraph",type:"blade",accept(t){const e=S,n=V(t,{view:e.required.constant("fpsgraph"),interval:e.optional.number,label:e.optional.string,lineCount:e.optional.number,max:e.optional.number,min:e.optional.number});return n?{params:n}:null},controller(t){var e,n,i,s;const r=null!==(e=t.params.interval)&&void 0!==e?e:500;return new K(t.document,{blade:t.blade,props:E.fromObject({label:t.params.label}),valueController:new xn(t.document,{lineCount:null!==(n=t.params.lineCount)&&void 0!==n?n:2,maxValue:null!==(i=t.params.max)&&void 0!==i?i:90,minValue:null!==(s=t.params.min)&&void 0!==s?s:0,ticker:yn(t.document,r),value:Jt(80),viewProps:t.viewProps})})},api:t=>t.controller instanceof K&&t.controller.valueController instanceof xn?new fn(t.controller):null};class En{static isObject(t){if("object"!=typeof t||null===t)return!1;const e=t.min,n=t.max;return"number"==typeof e&&"number"==typeof n}static equals(t,e){return t.min===e.min&&t.max===e.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}constructor(t,e){this.min=t,this.max=e}}const Tn={fromComponents:t=>new En(t[0],t[1]),toComponents:t=>[t.min,t.max]};class Mn{constrain(t){var e,n,i,s,r,o,a,l;if(t.min<=t.max)return new En(null!==(n=null===(e=this.edge)||void 0===e?void 0:e.constrain(t.min))&&void 0!==n?n:t.min,null!==(s=null===(i=this.edge)||void 0===i?void 0:i.constrain(t.max))&&void 0!==s?s:t.max);const c=(t.min+t.max)/2;return new En(null!==(o=null===(r=this.edge)||void 0===r?void 0:r.constrain(c))&&void 0!==o?o:c,null!==(l=null===(a=this.edge)||void 0===a?void 0:a.constrain(c))&&void 0!==l?l:c)}constructor(t){this.edge=t}}const kn=u("rsltxt");class Pn{constructor(t,e){this.sliderView_=e.sliderView,this.textView_=e.textView,this.element=t.createElement("div"),this.element.classList.add(kn());const n=t.createElement("div");n.classList.add(kn("s")),n.appendChild(this.sliderView_.element),this.element.appendChild(n);const i=t.createElement("div");i.classList.add(kn("t")),i.appendChild(this.textView_.element),this.element.appendChild(i)}}const An=u("rsl");class Sn{valueToX_(t){return 100*pe(ue(t,this.minValue_,this.maxValue_,0,1),0,1)}update(){const t=this.value_.rawValue;0===t.length?this.element.classList.add(An(void 0,"zero")):this.element.classList.remove(An(void 0,"zero"));const e=[this.valueToX_(t.min),this.valueToX_(t.max)];this.barElement.style.left=`${e[0]}%`,this.barElement.style.right=100-e[1]+"%",this.knobElements.forEach(((t,n)=>{t.style.left=`${e[n]}%`}))}onValueChange_(){this.update()}constructor(t,e){this.maxValue_=e.maxValue,this.minValue_=e.minValue,this.element=t.createElement("div"),this.element.classList.add(An()),e.viewProps.bindClassModifiers(this.element),this.value_=e.value,this.value_.emitter.on("change",this.onValueChange_.bind(this));const n=t.createElement("div");n.classList.add(An("t")),this.element.appendChild(n),this.trackElement=n;const i=t.createElement("div");i.classList.add(An("b")),n.appendChild(i),this.barElement=i;const s=["min","max"].map((e=>{const i=t.createElement("div");return i.classList.add(An("k"),An("k",e)),n.appendChild(i),i}));this.knobElements=[s[0],s[1]],this.update()}}class Vn{ofs_(){return"min"===this.grabbing_?this.view.knobElements[0].getBoundingClientRect().width/2:"max"===this.grabbing_?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(t){return t.point?ue((t.point.x+this.ofs_())/t.bounds.width,0,1,this.minValue_,this.maxValue_):null}onPointerDown_(t){if(!t.data.point)return;const e=t.data.point.x/t.data.bounds.width,n=this.value.rawValue,i=ue(n.min,this.minValue_,this.maxValue_,0,1),s=ue(n.max,this.minValue_,this.maxValue_,0,1);Math.abs(s-e)<=.025?this.grabbing_="max":Math.abs(i-e)<=.025?this.grabbing_="min":e>=i&&e<=s?(this.grabbing_="length",this.grabOffset_=ue(e-i,0,1,0,this.maxValue_-this.minValue_)):e<i?(this.grabbing_="min",this.onPointerMove_(t)):e>s&&(this.grabbing_="max",this.onPointerMove_(t))}applyPointToValue_(t,e){const n=this.valueFromData_(t);if(null!==n)if("min"===this.grabbing_)this.value.setRawValue(new En(n,this.value.rawValue.max),e);else if("max"===this.grabbing_)this.value.setRawValue(new En(this.value.rawValue.min,n),e);else if("length"===this.grabbing_){const t=this.value.rawValue.length;let i=n-this.grabOffset_,s=i+t;i<this.minValue_?(i=this.minValue_,s=this.minValue_+t):s>this.maxValue_&&(i=this.maxValue_-t,s=this.maxValue_),this.value.setRawValue(new En(i,s),e)}}onPointerMove_(t){this.applyPointToValue_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.applyPointToValue_(t.data,{forceEmit:!0,last:!0}),this.grabbing_=null}constructor(t,e){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.maxValue_=e.maxValue,this.minValue_=e.minValue,this.viewProps=e.viewProps,this.value=e.value,this.view=new Sn(t,{maxValue:e.maxValue,minValue:e.minValue,value:this.value,viewProps:e.viewProps});const n=new ce(this.view.trackElement);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}}class On{get textController(){return this.tc_}constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sc_=new Vn(t,e);const n={baseStep:e.baseStep,constraint:e.constraint,textProps:E.fromObject({draggingScale:e.draggingScale,formatter:e.formatter})};this.tc_=new Te(t,{assembly:Tn,axes:[n,n],parser:e.parser,value:this.value,viewProps:e.viewProps}),this.view=new Pn(t,{sliderView:this.sc_.view,textView:this.tc_.view})}}function Dn(t){return En.isObject(t)?new En(t.min,t.max):new En(0,0)}function Rn(t,e){t.writeProperty("max",e.max),t.writeProperty("min",e.min)}function Ln(t){const e=[],n=ke(t);n&&e.push(n);const i=Me(t);return i&&e.push(i),new Mn(new ot(e))}const In={id:"input-interval",type:"input",css:".tp-cbzv_b,.tp-rslv_k,.tp-radv_b,.tp-cbzgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-cbzv_b,.tp-rslv_k,.tp-radv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-cbzv_b:hover,.tp-rslv_k:hover,.tp-radv_b:hover{background-color:var(--btn-bg-h)}.tp-cbzv_b:focus,.tp-rslv_k:focus,.tp-radv_b:focus{background-color:var(--btn-bg-f)}.tp-cbzv_b:active,.tp-rslv_k:active,.tp-radv_b:active{background-color:var(--btn-bg-a)}.tp-cbzv_b:disabled,.tp-rslv_k:disabled,.tp-radv_b:disabled{opacity:0.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:0.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:0.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:0.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1 * var(--cnt-h-p));position:absolute;right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:0.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us) * 5);width:100%}.tp-cbzgv_u{opacity:0.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:transparent;stroke:var(--in-fg)}.tp-cbzgv_v{opacity:0.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:0.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity 0.2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:0.2em;opacity:0.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:0.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:'';height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:'';height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px) / -2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:0.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:0.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:0.5}.tp-radgridv .tp-radv_b{border-radius:0}",accept:(t,e)=>{if(!En.isObject(t))return null;const n=S,i=V(e,{format:n.optional.function,max:n.optional.number,min:n.optional.number,step:n.optional.number});return i?{initialValue:new En(t.min,t.max),params:i}:null},binding:{reader:t=>Dn,constraint:t=>Ln(t.params),equals:En.equals,writer:t=>Rn},controller(t){var e;const n=t.value,i=t.constraint;if(!(i instanceof Mn))throw a.shouldNeverHappen();const s=(n.rawValue.min+n.rawValue.max)/2,r=null!==(e=t.params.format)&&void 0!==e?e:Zt(ge(i.edge,s)),o=i.edge&&at(i.edge,lt);if(void 0!==(null==o?void 0:o.minValue)&&void 0!==(null==o?void 0:o.maxValue))return new On(t.document,{baseStep:be(i.edge),constraint:i.edge,draggingScale:we(o,s),formatter:r,maxValue:o.maxValue,minValue:o.minValue,parser:Xt,value:n,viewProps:t.viewProps});const l={baseStep:be(i.edge),constraint:i.edge,textProps:E.fromObject({draggingScale:s,formatter:r})};return new Te(t.document,{assembly:Tn,axes:[l,l],parser:Xt,value:n,viewProps:t.viewProps})}};class Nn{get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get title(){var t;return null!==(t=this.controller_.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller_.props.set("title",t)}constructor(t){this.controller_=t}}class Fn extends i{constructor(t,e,n,i,s){super(t,i,s),this.cell=e,this.index=n}}class Bn extends e{get value(){return this.controller_.value}cell(t,e){const n=this.controller_.valueController,i=n.cellControllers[e*n.size[0]+t];return this.cellToApiMap_.get(i)}on(t,e){const n=e.bind(this);this.controller_.value.emitter.on(t,(t=>{const e=this.controller_.valueController,i=e.findCellByValue(t.rawValue);if(!i)return;const s=this.cellToApiMap_.get(i);if(!s)return;const r=e.cellControllers.indexOf(i);n(new Fn(this,s,[r%e.size[0],Math.floor(r/e.size[0])],t.rawValue,void 0))}))}constructor(t){super(t),this.cellToApiMap_=new Map,this.controller_.valueController.cellControllers.forEach((t=>{const e=new Nn(t);this.cellToApiMap_.set(t,e)}))}}const qn=u("rad");class zn{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(qn()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("label");n.classList.add(qn("l")),this.element.appendChild(n);const i=t.createElement("input");i.classList.add(qn("i")),i.name=e.name,i.type="radio",e.viewProps.bindDisabled(i),n.appendChild(i),this.inputElement=i;const s=t.createElement("div");s.classList.add(qn("b")),n.appendChild(s);const r=t.createElement("div");r.classList.add(qn("t")),s.appendChild(r),v(e.props,"title",(t=>{r.textContent=t}))}}class jn{constructor(t,e){this.props=e.props,this.viewProps=e.viewProps,this.view=new zn(t,{name:e.name,props:this.props,viewProps:this.viewProps})}}class Un{get cellControllers(){return this.cellCs_}findCellByValue(t){const e=this.cellValues_.findIndex((e=>e===t));return e<0?null:this.cellCs_[e]}onCellInputChange_(t){const e=t.currentTarget,n=this.cellCs_.findIndex((t=>t.view.inputElement===e));n<0||(this.value.rawValue=this.cellValues_[n])}constructor(t,e){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=e.size;const[n,i]=this.size;for(let s=0;s<i;s++)for(let i=0;i<n;i++){const n=new jn(t,{name:e.groupName,props:E.fromObject(Object.assign({},e.cellConfig(i,s))),viewProps:it.create()});this.cellCs_.push(n),this.cellValues_.push(e.cellConfig(i,s).value)}this.value=e.value,d(this.value,(t=>{const e=this.findCellByValue(t);e&&(e.view.inputElement.checked=!0)})),this.viewProps=it.create(),this.view=new J(t,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${n}, 1fr)`,this.cellCs_.forEach((t=>{t.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(t.view.element)}))}}const Wn={id:"radiogrid",type:"blade",accept(t){const e=S,n=V(t,{cells:e.required.function,groupName:e.required.string,size:e.required.array(e.required.number),value:e.required.raw,view:e.required.constant("radiogrid"),label:e.optional.string});return n?{params:n}:null},controller:t=>new tt(t.document,{blade:t.blade,props:E.fromObject({label:t.params.label}),valueController:new Un(t.document,{groupName:t.params.groupName,cellConfig:t.params.cells,size:t.params.size,value:C(t.params.value)})}),api:t=>t.controller instanceof tt&&t.controller.valueController instanceof Un?new Bn(t.controller):null},Gn=[Ne,mn,Cn,In,Wn,{id:"input-radiogrid",type:"input",accept(t,e){if("number"!=typeof t)return null;const n=S,i=V(e,{cells:n.required.function,groupName:n.required.string,size:n.required.array(n.required.number),view:n.required.constant("radiogrid")});return i?{initialValue:t,params:i}:null},binding:{reader:t=>Yt,writer:t=>fe},controller:t=>new Un(t.document,{cellConfig:t.params.cells,groupName:t.params.groupName,size:t.params.size,value:t.value})}];t.CubicBezier=We,t.plugins=Gn,Object.defineProperty(t,"__esModule",{value:!0})}(a);var f={};t(f,"create",(function(){return b})),t(f,"clone",(function(){return w})),t(f,"copy",(function(){return x})),t(f,"fromValues",(function(){return y})),t(f,"set",(function(){return C})),t(f,"identity",(function(){return E})),t(f,"transpose",(function(){return T})),t(f,"invert",(function(){return M})),t(f,"adjoint",(function(){return k})),t(f,"determinant",(function(){return P})),t(f,"multiply",(function(){return A})),t(f,"translate",(function(){return S})),t(f,"scale",(function(){return V})),t(f,"rotate",(function(){return O})),t(f,"rotateX",(function(){return D})),t(f,"rotateY",(function(){return R})),t(f,"rotateZ",(function(){return L})),t(f,"fromTranslation",(function(){return I})),t(f,"fromScaling",(function(){return N})),t(f,"fromRotation",(function(){return F})),t(f,"fromXRotation",(function(){return B})),t(f,"fromYRotation",(function(){return q})),t(f,"fromZRotation",(function(){return z})),t(f,"fromRotationTranslation",(function(){return j})),t(f,"fromQuat2",(function(){return U})),t(f,"getTranslation",(function(){return W})),t(f,"getScaling",(function(){return G})),t(f,"getRotation",(function(){return K})),t(f,"fromRotationTranslationScale",(function(){return H})),t(f,"fromRotationTranslationScaleOrigin",(function(){return $})),t(f,"fromQuat",(function(){return X})),t(f,"frustum",(function(){return Y})),t(f,"perspectiveNO",(function(){return Z})),t(f,"perspective",(function(){return Q})),t(f,"perspectiveZO",(function(){return J})),t(f,"perspectiveFromFieldOfView",(function(){return tt})),t(f,"orthoNO",(function(){return et})),t(f,"ortho",(function(){return nt})),t(f,"orthoZO",(function(){return it})),t(f,"lookAt",(function(){return st})),t(f,"targetTo",(function(){return rt})),t(f,"str",(function(){return ot})),t(f,"frob",(function(){return at})),t(f,"add",(function(){return lt})),t(f,"subtract",(function(){return ct})),t(f,"multiplyScalar",(function(){return ut})),t(f,"multiplyScalarAndAdd",(function(){return ht})),t(f,"exactEquals",(function(){return pt})),t(f,"equals",(function(){return dt})),t(f,"mul",(function(){return vt})),t(f,"sub",(function(){return mt}));var _="undefined"!=typeof Float32Array?Float32Array:Array,g=Math.random;Math.PI;function b(){var t=new _(16);return _!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function w(t){var e=new _(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function x(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function y(t,e,n,i,s,r,o,a,l,c,u,h,p,d,v,m){var f=new _(16);return f[0]=t,f[1]=e,f[2]=n,f[3]=i,f[4]=s,f[5]=r,f[6]=o,f[7]=a,f[8]=l,f[9]=c,f[10]=u,f[11]=h,f[12]=p,f[13]=d,f[14]=v,f[15]=m,f}function C(t,e,n,i,s,r,o,a,l,c,u,h,p,d,v,m,f){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t[4]=r,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=h,t[11]=p,t[12]=d,t[13]=v,t[14]=m,t[15]=f,t}function E(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function T(t,e){if(t===e){var n=e[1],i=e[2],s=e[3],r=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=r,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function M(t,e){var n=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],f=e[14],_=e[15],g=n*a-i*o,b=n*l-s*o,w=n*c-r*o,x=i*l-s*a,y=i*c-r*a,C=s*c-r*l,E=u*m-h*v,T=u*f-p*v,M=u*_-d*v,k=h*f-p*m,P=h*_-d*m,A=p*_-d*f,S=g*A-b*P+w*k+x*M-y*T+C*E;return S?(S=1/S,t[0]=(a*A-l*P+c*k)*S,t[1]=(s*P-i*A-r*k)*S,t[2]=(m*C-f*y+_*x)*S,t[3]=(p*y-h*C-d*x)*S,t[4]=(l*M-o*A-c*T)*S,t[5]=(n*A-s*M+r*T)*S,t[6]=(f*w-v*C-_*b)*S,t[7]=(u*C-p*w+d*b)*S,t[8]=(o*P-a*M+c*E)*S,t[9]=(i*M-n*P-r*E)*S,t[10]=(v*y-m*w+_*g)*S,t[11]=(h*w-u*y-d*g)*S,t[12]=(a*T-o*k-l*E)*S,t[13]=(n*k-i*T+s*E)*S,t[14]=(m*b-v*x-f*g)*S,t[15]=(u*x-h*b+p*g)*S,t):null}function k(t,e){var n=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],f=e[14],_=e[15];return t[0]=a*(p*_-d*f)-h*(l*_-c*f)+m*(l*d-c*p),t[1]=-(i*(p*_-d*f)-h*(s*_-r*f)+m*(s*d-r*p)),t[2]=i*(l*_-c*f)-a*(s*_-r*f)+m*(s*c-r*l),t[3]=-(i*(l*d-c*p)-a*(s*d-r*p)+h*(s*c-r*l)),t[4]=-(o*(p*_-d*f)-u*(l*_-c*f)+v*(l*d-c*p)),t[5]=n*(p*_-d*f)-u*(s*_-r*f)+v*(s*d-r*p),t[6]=-(n*(l*_-c*f)-o*(s*_-r*f)+v*(s*c-r*l)),t[7]=n*(l*d-c*p)-o*(s*d-r*p)+u*(s*c-r*l),t[8]=o*(h*_-d*m)-u*(a*_-c*m)+v*(a*d-c*h),t[9]=-(n*(h*_-d*m)-u*(i*_-r*m)+v*(i*d-r*h)),t[10]=n*(a*_-c*m)-o*(i*_-r*m)+v*(i*c-r*a),t[11]=-(n*(a*d-c*h)-o*(i*d-r*h)+u*(i*c-r*a)),t[12]=-(o*(h*f-p*m)-u*(a*f-l*m)+v*(a*p-l*h)),t[13]=n*(h*f-p*m)-u*(i*f-s*m)+v*(i*p-s*h),t[14]=-(n*(a*f-l*m)-o*(i*f-s*m)+v*(i*l-s*a)),t[15]=n*(a*p-l*h)-o*(i*p-s*h)+u*(i*l-s*a),t}function P(t){var e=t[0],n=t[1],i=t[2],s=t[3],r=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],f=t[15];return(e*o-n*r)*(h*f-p*m)-(e*a-i*r)*(u*f-p*v)+(e*l-s*r)*(u*m-h*v)+(n*a-i*o)*(c*f-p*d)-(n*l-s*o)*(c*m-h*d)+(i*l-s*a)*(c*v-u*d)}function A(t,e,n){var i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],v=e[11],m=e[12],f=e[13],_=e[14],g=e[15],b=n[0],w=n[1],x=n[2],y=n[3];return t[0]=b*i+w*a+x*h+y*m,t[1]=b*s+w*l+x*p+y*f,t[2]=b*r+w*c+x*d+y*_,t[3]=b*o+w*u+x*v+y*g,b=n[4],w=n[5],x=n[6],y=n[7],t[4]=b*i+w*a+x*h+y*m,t[5]=b*s+w*l+x*p+y*f,t[6]=b*r+w*c+x*d+y*_,t[7]=b*o+w*u+x*v+y*g,b=n[8],w=n[9],x=n[10],y=n[11],t[8]=b*i+w*a+x*h+y*m,t[9]=b*s+w*l+x*p+y*f,t[10]=b*r+w*c+x*d+y*_,t[11]=b*o+w*u+x*v+y*g,b=n[12],w=n[13],x=n[14],y=n[15],t[12]=b*i+w*a+x*h+y*m,t[13]=b*s+w*l+x*p+y*f,t[14]=b*r+w*c+x*d+y*_,t[15]=b*o+w*u+x*v+y*g,t}function S(t,e,n){var i,s,r,o,a,l,c,u,h,p,d,v,m=n[0],f=n[1],_=n[2];return e===t?(t[12]=e[0]*m+e[4]*f+e[8]*_+e[12],t[13]=e[1]*m+e[5]*f+e[9]*_+e[13],t[14]=e[2]*m+e[6]*f+e[10]*_+e[14],t[15]=e[3]*m+e[7]*f+e[11]*_+e[15]):(i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],v=e[11],t[0]=i,t[1]=s,t[2]=r,t[3]=o,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=p,t[10]=d,t[11]=v,t[12]=i*m+a*f+h*_+e[12],t[13]=s*m+l*f+p*_+e[13],t[14]=r*m+c*f+d*_+e[14],t[15]=o*m+u*f+v*_+e[15]),t}function V(t,e,n){var i=n[0],s=n[1],r=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function O(t,e,n,i){var s,r,o,a,l,c,u,h,p,d,v,m,f,_,g,b,w,x,y,C,E,T,M,k,P=i[0],A=i[1],S=i[2],V=Math.hypot(P,A,S);return V<1e-6?null:(P*=V=1/V,A*=V,S*=V,s=Math.sin(n),o=1-(r=Math.cos(n)),a=e[0],l=e[1],c=e[2],u=e[3],h=e[4],p=e[5],d=e[6],v=e[7],m=e[8],f=e[9],_=e[10],g=e[11],b=P*P*o+r,w=A*P*o+S*s,x=S*P*o-A*s,y=P*A*o-S*s,C=A*A*o+r,E=S*A*o+P*s,T=P*S*o+A*s,M=A*S*o-P*s,k=S*S*o+r,t[0]=a*b+h*w+m*x,t[1]=l*b+p*w+f*x,t[2]=c*b+d*w+_*x,t[3]=u*b+v*w+g*x,t[4]=a*y+h*C+m*E,t[5]=l*y+p*C+f*E,t[6]=c*y+d*C+_*E,t[7]=u*y+v*C+g*E,t[8]=a*T+h*M+m*k,t[9]=l*T+p*M+f*k,t[10]=c*T+d*M+_*k,t[11]=u*T+v*M+g*k,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function D(t,e,n){var i=Math.sin(n),s=Math.cos(n),r=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=r*s+c*i,t[5]=o*s+u*i,t[6]=a*s+h*i,t[7]=l*s+p*i,t[8]=c*s-r*i,t[9]=u*s-o*i,t[10]=h*s-a*i,t[11]=p*s-l*i,t}function R(t,e,n){var i=Math.sin(n),s=Math.cos(n),r=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*s-c*i,t[1]=o*s-u*i,t[2]=a*s-h*i,t[3]=l*s-p*i,t[8]=r*i+c*s,t[9]=o*i+u*s,t[10]=a*i+h*s,t[11]=l*i+p*s,t}function L(t,e,n){var i=Math.sin(n),s=Math.cos(n),r=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*s+c*i,t[1]=o*s+u*i,t[2]=a*s+h*i,t[3]=l*s+p*i,t[4]=c*s-r*i,t[5]=u*s-o*i,t[6]=h*s-a*i,t[7]=p*s-l*i,t}function I(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function N(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function F(t,e,n){var i,s,r,o=n[0],a=n[1],l=n[2],c=Math.hypot(o,a,l);return c<1e-6?null:(o*=c=1/c,a*=c,l*=c,i=Math.sin(e),r=1-(s=Math.cos(e)),t[0]=o*o*r+s,t[1]=a*o*r+l*i,t[2]=l*o*r-a*i,t[3]=0,t[4]=o*a*r-l*i,t[5]=a*a*r+s,t[6]=l*a*r+o*i,t[7]=0,t[8]=o*l*r+a*i,t[9]=a*l*r-o*i,t[10]=l*l*r+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function B(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function q(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function z(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function j(t,e,n){var i=e[0],s=e[1],r=e[2],o=e[3],a=i+i,l=s+s,c=r+r,u=i*a,h=i*l,p=i*c,d=s*l,v=s*c,m=r*c,f=o*a,_=o*l,g=o*c;return t[0]=1-(d+m),t[1]=h+g,t[2]=p-_,t[3]=0,t[4]=h-g,t[5]=1-(u+m),t[6]=v+f,t[7]=0,t[8]=p+_,t[9]=v-f,t[10]=1-(u+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function U(t,e){var n=new _(3),i=-e[0],s=-e[1],r=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=i*i+s*s+r*r+o*o;return h>0?(n[0]=2*(a*o+u*i+l*r-c*s)/h,n[1]=2*(l*o+u*s+c*i-a*r)/h,n[2]=2*(c*o+u*r+a*s-l*i)/h):(n[0]=2*(a*o+u*i+l*r-c*s),n[1]=2*(l*o+u*s+c*i-a*r),n[2]=2*(c*o+u*r+a*s-l*i)),j(t,e,n),t}function W(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function G(t,e){var n=e[0],i=e[1],s=e[2],r=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.hypot(n,i,s),t[1]=Math.hypot(r,o,a),t[2]=Math.hypot(l,c,u),t}function K(t,e){var n=new _(3);G(n,e);var i=1/n[0],s=1/n[1],r=1/n[2],o=e[0]*i,a=e[1]*s,l=e[2]*r,c=e[4]*i,u=e[5]*s,h=e[6]*r,p=e[8]*i,d=e[9]*s,v=e[10]*r,m=o+u+v,f=0;return m>0?(f=2*Math.sqrt(m+1),t[3]=.25*f,t[0]=(h-d)/f,t[1]=(p-l)/f,t[2]=(a-c)/f):o>u&&o>v?(f=2*Math.sqrt(1+o-u-v),t[3]=(h-d)/f,t[0]=.25*f,t[1]=(a+c)/f,t[2]=(p+l)/f):u>v?(f=2*Math.sqrt(1+u-o-v),t[3]=(p-l)/f,t[0]=(a+c)/f,t[1]=.25*f,t[2]=(h+d)/f):(f=2*Math.sqrt(1+v-o-u),t[3]=(a-c)/f,t[0]=(p+l)/f,t[1]=(h+d)/f,t[2]=.25*f),t}function H(t,e,n,i){var s=e[0],r=e[1],o=e[2],a=e[3],l=s+s,c=r+r,u=o+o,h=s*l,p=s*c,d=s*u,v=r*c,m=r*u,f=o*u,_=a*l,g=a*c,b=a*u,w=i[0],x=i[1],y=i[2];return t[0]=(1-(v+f))*w,t[1]=(p+b)*w,t[2]=(d-g)*w,t[3]=0,t[4]=(p-b)*x,t[5]=(1-(h+f))*x,t[6]=(m+_)*x,t[7]=0,t[8]=(d+g)*y,t[9]=(m-_)*y,t[10]=(1-(h+v))*y,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function $(t,e,n,i,s){var r=e[0],o=e[1],a=e[2],l=e[3],c=r+r,u=o+o,h=a+a,p=r*c,d=r*u,v=r*h,m=o*u,f=o*h,_=a*h,g=l*c,b=l*u,w=l*h,x=i[0],y=i[1],C=i[2],E=s[0],T=s[1],M=s[2],k=(1-(m+_))*x,P=(d+w)*x,A=(v-b)*x,S=(d-w)*y,V=(1-(p+_))*y,O=(f+g)*y,D=(v+b)*C,R=(f-g)*C,L=(1-(p+m))*C;return t[0]=k,t[1]=P,t[2]=A,t[3]=0,t[4]=S,t[5]=V,t[6]=O,t[7]=0,t[8]=D,t[9]=R,t[10]=L,t[11]=0,t[12]=n[0]+E-(k*E+S*T+D*M),t[13]=n[1]+T-(P*E+V*T+R*M),t[14]=n[2]+M-(A*E+O*T+L*M),t[15]=1,t}function X(t,e){var n=e[0],i=e[1],s=e[2],r=e[3],o=n+n,a=i+i,l=s+s,c=n*o,u=i*o,h=i*a,p=s*o,d=s*a,v=s*l,m=r*o,f=r*a,_=r*l;return t[0]=1-h-v,t[1]=u+_,t[2]=p-f,t[3]=0,t[4]=u-_,t[5]=1-c-v,t[6]=d+m,t[7]=0,t[8]=p+f,t[9]=d-m,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Y(t,e,n,i,s,r,o){var a=1/(n-e),l=1/(s-i),c=1/(r-o);return t[0]=2*r*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*r*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(s+i)*l,t[10]=(o+r)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*r*2*c,t[15]=0,t}function Z(t,e,n,i,s){var r,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(r=1/(i-s),t[10]=(s+i)*r,t[14]=2*s*i*r):(t[10]=-1,t[14]=-2*i),t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Q=Z;function J(t,e,n,i,s){var r,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(r=1/(i-s),t[10]=s*r,t[14]=s*i*r):(t[10]=-1,t[14]=-i),t}function tt(t,e,n,i){var s=Math.tan(e.upDegrees*Math.PI/180),r=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+r);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-r)*c*.5,t[10]=i/(n-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*n/(n-i),t[15]=0,t}function et(t,e,n,i,s,r,o){var a=1/(e-n),l=1/(i-s),c=1/(r-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(s+i)*l,t[14]=(o+r)*c,t[15]=1,t}var nt=et;function it(t,e,n,i,s,r,o){var a=1/(e-n),l=1/(i-s),c=1/(r-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+n)*a,t[13]=(s+i)*l,t[14]=r*c,t[15]=1,t}function st(t,e,n,i){var s,r,o,a,l,c,u,h,p,d,v=e[0],m=e[1],f=e[2],_=i[0],g=i[1],b=i[2],w=n[0],x=n[1],y=n[2];return Math.abs(v-w)<1e-6&&Math.abs(m-x)<1e-6&&Math.abs(f-y)<1e-6?E(t):(u=v-w,h=m-x,p=f-y,s=g*(p*=d=1/Math.hypot(u,h,p))-b*(h*=d),r=b*(u*=d)-_*p,o=_*h-g*u,(d=Math.hypot(s,r,o))?(s*=d=1/d,r*=d,o*=d):(s=0,r=0,o=0),a=h*o-p*r,l=p*s-u*o,c=u*r-h*s,(d=Math.hypot(a,l,c))?(a*=d=1/d,l*=d,c*=d):(a=0,l=0,c=0),t[0]=s,t[1]=a,t[2]=u,t[3]=0,t[4]=r,t[5]=l,t[6]=h,t[7]=0,t[8]=o,t[9]=c,t[10]=p,t[11]=0,t[12]=-(s*v+r*m+o*f),t[13]=-(a*v+l*m+c*f),t[14]=-(u*v+h*m+p*f),t[15]=1,t)}function rt(t,e,n,i){var s=e[0],r=e[1],o=e[2],a=i[0],l=i[1],c=i[2],u=s-n[0],h=r-n[1],p=o-n[2],d=u*u+h*h+p*p;d>0&&(u*=d=1/Math.sqrt(d),h*=d,p*=d);var v=l*p-c*h,m=c*u-a*p,f=a*h-l*u;return(d=v*v+m*m+f*f)>0&&(v*=d=1/Math.sqrt(d),m*=d,f*=d),t[0]=v,t[1]=m,t[2]=f,t[3]=0,t[4]=h*f-p*m,t[5]=p*v-u*f,t[6]=u*m-h*v,t[7]=0,t[8]=u,t[9]=h,t[10]=p,t[11]=0,t[12]=s,t[13]=r,t[14]=o,t[15]=1,t}function ot(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function at(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function lt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function ct(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function ut(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function ht(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t[9]=e[9]+n[9]*i,t[10]=e[10]+n[10]*i,t[11]=e[11]+n[11]*i,t[12]=e[12]+n[12]*i,t[13]=e[13]+n[13]*i,t[14]=e[14]+n[14]*i,t[15]=e[15]+n[15]*i,t}function pt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function dt(t,e){var n=t[0],i=t[1],s=t[2],r=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],f=t[14],_=t[15],g=e[0],b=e[1],w=e[2],x=e[3],y=e[4],C=e[5],E=e[6],T=e[7],M=e[8],k=e[9],P=e[10],A=e[11],S=e[12],V=e[13],O=e[14],D=e[15];return Math.abs(n-g)<=1e-6*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(i-b)<=1e-6*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(s-w)<=1e-6*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(r-x)<=1e-6*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(o-y)<=1e-6*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(a-C)<=1e-6*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(l-E)<=1e-6*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(c-T)<=1e-6*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-M)<=1e-6*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(h-k)<=1e-6*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(p-P)<=1e-6*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(d-A)<=1e-6*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(v-S)<=1e-6*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(m-V)<=1e-6*Math.max(1,Math.abs(m),Math.abs(V))&&Math.abs(f-O)<=1e-6*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(_-D)<=1e-6*Math.max(1,Math.abs(_),Math.abs(D))}var vt=A,mt=ct,ft={};t(ft,"create",(function(){return me})),t(ft,"identity",(function(){return fe})),t(ft,"setAxisAngle",(function(){return _e})),t(ft,"getAxisAngle",(function(){return ge})),t(ft,"getAngle",(function(){return be})),t(ft,"dot",(function(){return Xe})),t(ft,"multiply",(function(){return we})),t(ft,"rotateX",(function(){return xe})),t(ft,"rotateY",(function(){return ye})),t(ft,"rotateZ",(function(){return Ce})),t(ft,"calculateW",(function(){return Ee})),t(ft,"exp",(function(){return Te})),t(ft,"ln",(function(){return Me})),t(ft,"pow",(function(){return ke})),t(ft,"scale",(function(){return $e})),t(ft,"slerp",(function(){return Pe})),t(ft,"random",(function(){return Ae})),t(ft,"invert",(function(){return Se})),t(ft,"conjugate",(function(){return Ve})),t(ft,"fromMat3",(function(){return Oe})),t(ft,"fromEuler",(function(){return De})),t(ft,"str",(function(){return Re})),t(ft,"clone",(function(){return je})),t(ft,"fromValues",(function(){return Ue})),t(ft,"copy",(function(){return We})),t(ft,"set",(function(){return Ge})),t(ft,"add",(function(){return Ke})),t(ft,"mul",(function(){return He})),t(ft,"lerp",(function(){return Ye})),t(ft,"length",(function(){return Ze})),t(ft,"len",(function(){return Qe})),t(ft,"squaredLength",(function(){return Je})),t(ft,"sqrLen",(function(){return tn})),t(ft,"normalize",(function(){return en})),t(ft,"exactEquals",(function(){return nn})),t(ft,"equals",(function(){return sn})),t(ft,"rotationTo",(function(){return rn})),t(ft,"sqlerp",(function(){return on})),t(ft,"setAxes",(function(){return an}));var _t={};function gt(){var t=new _(3);return _!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function bt(t){var e=new _(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function wt(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function xt(t,e,n){var i=new _(3);return i[0]=t,i[1]=e,i[2]=n,i}function yt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ct(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function Et(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Tt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Mt(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function kt(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Pt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function At(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function St(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function Vt(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function Ot(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Dt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Rt(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t}function Lt(t,e){var n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return Math.hypot(n,i,s)}function It(t,e){var n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return n*n+i*i+s*s}function Nt(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function Ft(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Bt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function qt(t,e){var n=e[0],i=e[1],s=e[2],r=n*n+i*i+s*s;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function zt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function jt(t,e,n){var i=e[0],s=e[1],r=e[2],o=n[0],a=n[1],l=n[2];return t[0]=s*l-r*a,t[1]=r*o-i*l,t[2]=i*a-s*o,t}function Ut(t,e,n,i){var s=e[0],r=e[1],o=e[2];return t[0]=s+i*(n[0]-s),t[1]=r+i*(n[1]-r),t[2]=o+i*(n[2]-o),t}function Wt(t,e,n,i,s,r){var o=r*r,a=o*(2*r-3)+1,l=o*(r-2)+r,c=o*(r-1),u=o*(3-2*r);return t[0]=e[0]*a+n[0]*l+i[0]*c+s[0]*u,t[1]=e[1]*a+n[1]*l+i[1]*c+s[1]*u,t[2]=e[2]*a+n[2]*l+i[2]*c+s[2]*u,t}function Gt(t,e,n,i,s,r){var o=1-r,a=o*o,l=r*r,c=a*o,u=3*r*a,h=3*l*o,p=l*r;return t[0]=e[0]*c+n[0]*u+i[0]*h+s[0]*p,t[1]=e[1]*c+n[1]*u+i[1]*h+s[1]*p,t[2]=e[2]*c+n[2]*u+i[2]*h+s[2]*p,t}function Kt(t,e){e=e||1;var n=2*g()*Math.PI,i=2*g()-1,s=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*s,t[1]=Math.sin(n)*s,t[2]=i*e,t}function Ht(t,e,n){var i=e[0],s=e[1],r=e[2],o=n[3]*i+n[7]*s+n[11]*r+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*s+n[8]*r+n[12])/o,t[1]=(n[1]*i+n[5]*s+n[9]*r+n[13])/o,t[2]=(n[2]*i+n[6]*s+n[10]*r+n[14])/o,t}function $t(t,e,n){var i=e[0],s=e[1],r=e[2];return t[0]=i*n[0]+s*n[3]+r*n[6],t[1]=i*n[1]+s*n[4]+r*n[7],t[2]=i*n[2]+s*n[5]+r*n[8],t}function Xt(t,e,n){var i=n[0],s=n[1],r=n[2],o=n[3],a=e[0],l=e[1],c=e[2],u=s*c-r*l,h=r*a-i*c,p=i*l-s*a,d=s*p-r*h,v=r*u-i*p,m=i*h-s*u,f=2*o;return u*=f,h*=f,p*=f,d*=2,v*=2,m*=2,t[0]=a+u+d,t[1]=l+h+v,t[2]=c+p+m,t}function Yt(t,e,n,i){var s=[],r=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],r[0]=s[0],r[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),r[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t}function Zt(t,e,n,i){var s=[],r=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],r[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),r[1]=s[1],r[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t}function Qt(t,e,n,i){var s=[],r=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],r[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),r[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),r[2]=s[2],t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t}function Jt(t,e){var n=t[0],i=t[1],s=t[2],r=e[0],o=e[1],a=e[2],l=Math.sqrt(n*n+i*i+s*s)*Math.sqrt(r*r+o*o+a*a),c=l&&zt(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}function te(t){return t[0]=0,t[1]=0,t[2]=0,t}function ee(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function ne(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function ie(t,e){var n=t[0],i=t[1],s=t[2],r=e[0],o=e[1],a=e[2];return Math.abs(n-r)<=1e-6*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-o)<=1e-6*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-a)<=1e-6*Math.max(1,Math.abs(s),Math.abs(a))}t(_t,"create",(function(){return gt})),t(_t,"clone",(function(){return bt})),t(_t,"length",(function(){return wt})),t(_t,"fromValues",(function(){return xt})),t(_t,"copy",(function(){return yt})),t(_t,"set",(function(){return Ct})),t(_t,"add",(function(){return Et})),t(_t,"subtract",(function(){return Tt})),t(_t,"multiply",(function(){return Mt})),t(_t,"divide",(function(){return kt})),t(_t,"ceil",(function(){return Pt})),t(_t,"floor",(function(){return At})),t(_t,"min",(function(){return St})),t(_t,"max",(function(){return Vt})),t(_t,"round",(function(){return Ot})),t(_t,"scale",(function(){return Dt})),t(_t,"scaleAndAdd",(function(){return Rt})),t(_t,"distance",(function(){return Lt})),t(_t,"squaredDistance",(function(){return It})),t(_t,"squaredLength",(function(){return Nt})),t(_t,"negate",(function(){return Ft})),t(_t,"inverse",(function(){return Bt})),t(_t,"normalize",(function(){return qt})),t(_t,"len",(function(){return ue})),t(_t,"dot",(function(){return zt})),t(_t,"cross",(function(){return jt})),t(_t,"lerp",(function(){return Ut})),t(_t,"hermite",(function(){return Wt})),t(_t,"bezier",(function(){return Gt})),t(_t,"random",(function(){return Kt})),t(_t,"transformMat4",(function(){return Ht})),t(_t,"transformMat3",(function(){return $t})),t(_t,"transformQuat",(function(){return Xt})),t(_t,"rotateX",(function(){return Yt})),t(_t,"rotateY",(function(){return Zt})),t(_t,"rotateZ",(function(){return Qt})),t(_t,"angle",(function(){return Jt})),t(_t,"zero",(function(){return te})),t(_t,"str",(function(){return ee})),t(_t,"exactEquals",(function(){return ne})),t(_t,"equals",(function(){return ie})),t(_t,"sub",(function(){return re})),t(_t,"mul",(function(){return oe})),t(_t,"div",(function(){return ae})),t(_t,"dist",(function(){return le})),t(_t,"sqrDist",(function(){return ce})),t(_t,"sqrLen",(function(){return he})),t(_t,"forEach",(function(){return pe}));var se,re=Tt,oe=Mt,ae=kt,le=Lt,ce=It,ue=wt,he=Nt,pe=(se=gt(),function(t,e,n,i,s,r){var o,a;for(e||(e=3),n||(n=0),a=i?Math.min(i*e+n,t.length):t.length,o=n;o<a;o+=e)se[0]=t[o],se[1]=t[o+1],se[2]=t[o+2],s(se,se,r),t[o]=se[0],t[o+1]=se[1],t[o+2]=se[2];return t});function de(t){var e=t[0],n=t[1],i=t[2],s=t[3];return Math.hypot(e,n,i,s)}function ve(t){var e=t[0],n=t[1],i=t[2],s=t[3];return e*e+n*n+i*i+s*s}!function(){var t,e=(t=new _(4),_!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function me(){var t=new _(4);return _!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function fe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function _e(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function ge(t,e){var n=2*Math.acos(e[3]),i=Math.sin(n/2);return i>1e-6?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),n}function be(t,e){var n=Xe(t,e);return Math.acos(2*n*n-1)}function we(t,e,n){var i=e[0],s=e[1],r=e[2],o=e[3],a=n[0],l=n[1],c=n[2],u=n[3];return t[0]=i*u+o*a+s*c-r*l,t[1]=s*u+o*l+r*a-i*c,t[2]=r*u+o*c+i*l-s*a,t[3]=o*u-i*a-s*l-r*c,t}function xe(t,e,n){n*=.5;var i=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+o*a,t[1]=s*l+r*a,t[2]=r*l-s*a,t[3]=o*l-i*a,t}function ye(t,e,n){n*=.5;var i=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l-r*a,t[1]=s*l+o*a,t[2]=r*l+i*a,t[3]=o*l-s*a,t}function Ce(t,e,n){n*=.5;var i=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+s*a,t[1]=s*l-i*a,t[2]=r*l+o*a,t[3]=o*l-r*a,t}function Ee(t,e){var n=e[0],i=e[1],s=e[2];return t[0]=n,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-s*s)),t}function Te(t,e){var n=e[0],i=e[1],s=e[2],r=e[3],o=Math.sqrt(n*n+i*i+s*s),a=Math.exp(r),l=o>0?a*Math.sin(o)/o:0;return t[0]=n*l,t[1]=i*l,t[2]=s*l,t[3]=a*Math.cos(o),t}function Me(t,e){var n=e[0],i=e[1],s=e[2],r=e[3],o=Math.sqrt(n*n+i*i+s*s),a=o>0?Math.atan2(o,r)/o:0;return t[0]=n*a,t[1]=i*a,t[2]=s*a,t[3]=.5*Math.log(n*n+i*i+s*s+r*r),t}function ke(t,e,n){return Me(t,e),$e(t,t,n),Te(t,t),t}function Pe(t,e,n,i){var s,r,o,a,l,c=e[0],u=e[1],h=e[2],p=e[3],d=n[0],v=n[1],m=n[2],f=n[3];return(r=c*d+u*v+h*m+p*f)<0&&(r=-r,d=-d,v=-v,m=-m,f=-f),1-r>1e-6?(s=Math.acos(r),o=Math.sin(s),a=Math.sin((1-i)*s)/o,l=Math.sin(i*s)/o):(a=1-i,l=i),t[0]=a*c+l*d,t[1]=a*u+l*v,t[2]=a*h+l*m,t[3]=a*p+l*f,t}function Ae(t){var e=g(),n=g(),i=g(),s=Math.sqrt(1-e),r=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*n),t[1]=s*Math.cos(2*Math.PI*n),t[2]=r*Math.sin(2*Math.PI*i),t[3]=r*Math.cos(2*Math.PI*i),t}function Se(t,e){var n=e[0],i=e[1],s=e[2],r=e[3],o=n*n+i*i+s*s+r*r,a=o?1/o:0;return t[0]=-n*a,t[1]=-i*a,t[2]=-s*a,t[3]=r*a,t}function Ve(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Oe(t,e){var n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);var r=(s+1)%3,o=(s+2)%3;n=Math.sqrt(e[3*s+s]-e[3*r+r]-e[3*o+o]+1),t[s]=.5*n,n=.5/n,t[3]=(e[3*r+o]-e[3*o+r])*n,t[r]=(e[3*r+s]+e[3*s+r])*n,t[o]=(e[3*o+s]+e[3*s+o])*n}return t}function De(t,e,n,i){var s=.5*Math.PI/180;e*=s,n*=s,i*=s;var r=Math.sin(e),o=Math.cos(e),a=Math.sin(n),l=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return t[0]=r*l*u-o*a*c,t[1]=o*a*u+r*l*c,t[2]=o*l*c-r*a*u,t[3]=o*l*u+r*a*c,t}function Re(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Le,Ie,Ne,Fe,Be,qe,ze,je=function(t){var e=new _(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ue=function(t,e,n,i){var s=new _(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=i,s},We=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ge=function(t,e,n,i,s){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t},Ke=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},He=we,$e=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Xe=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Ye=function(t,e,n,i){var s=e[0],r=e[1],o=e[2],a=e[3];return t[0]=s+i*(n[0]-s),t[1]=r+i*(n[1]-r),t[2]=o+i*(n[2]-o),t[3]=a+i*(n[3]-a),t},Ze=de,Qe=Ze,Je=ve,tn=Je,en=function(t,e){var n=e[0],i=e[1],s=e[2],r=e[3],o=n*n+i*i+s*s+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=i*o,t[2]=s*o,t[3]=r*o,t},nn=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},sn=function(t,e){var n=t[0],i=t[1],s=t[2],r=t[3],o=e[0],a=e[1],l=e[2],c=e[3];return Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=1e-6*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(r-c)<=1e-6*Math.max(1,Math.abs(r),Math.abs(c))},rn=(Le=gt(),Ie=xt(1,0,0),Ne=xt(0,1,0),function(t,e,n){var i=zt(e,n);return i<-.999999?(jt(Le,Ie,e),ue(Le)<1e-6&&jt(Le,Ne,e),qt(Le,Le),_e(t,Le,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(jt(Le,e,n),t[0]=Le[0],t[1]=Le[1],t[2]=Le[2],t[3]=1+i,en(t,t))}),on=(Fe=me(),Be=me(),function(t,e,n,i,s,r){return Pe(Fe,e,s,r),Pe(Be,n,i,r),Pe(t,Fe,Be,2*r*(1-r)),t}),an=(qe=new _(9),_!=Float32Array&&(qe[1]=0,qe[2]=0,qe[3]=0,qe[5]=0,qe[6]=0,qe[7]=0),qe[0]=1,qe[4]=1,qe[8]=1,ze=qe,function(t,e,n,i){return ze[0]=n[0],ze[3]=n[1],ze[6]=n[2],ze[1]=i[0],ze[4]=i[1],ze[7]=i[2],ze[2]=-e[0],ze[5]=-e[1],ze[8]=-e[2],en(t,Oe(t,ze))}),ln={};function cn(){var t=new _(2);return _!=Float32Array&&(t[0]=0,t[1]=0),t}function un(t){var e=new _(2);return e[0]=t[0],e[1]=t[1],e}function hn(t,e){var n=new _(2);return n[0]=t,n[1]=e,n}function pn(t,e){return t[0]=e[0],t[1]=e[1],t}function dn(t,e,n){return t[0]=e,t[1]=n,t}function vn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function mn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function fn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function _n(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function gn(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function bn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function wn(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function xn(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function yn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Cn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function En(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t}function Tn(t,e){var n=e[0]-t[0],i=e[1]-t[1];return Math.hypot(n,i)}function Mn(t,e){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}function kn(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function Pn(t){var e=t[0],n=t[1];return e*e+n*n}function An(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Sn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Vn(t,e){var n=e[0],i=e[1],s=n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t}function On(t,e){return t[0]*e[0]+t[1]*e[1]}function Dn(t,e,n){var i=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=i,t}function Rn(t,e,n,i){var s=e[0],r=e[1];return t[0]=s+i*(n[0]-s),t[1]=r+i*(n[1]-r),t}function Ln(t,e){e=e||1;var n=2*g()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function In(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[2]*s,t[1]=n[1]*i+n[3]*s,t}function Nn(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[2]*s+n[4],t[1]=n[1]*i+n[3]*s+n[5],t}function Fn(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[3]*s+n[6],t[1]=n[1]*i+n[4]*s+n[7],t}function Bn(t,e,n){var i=e[0],s=e[1];return t[0]=n[0]*i+n[4]*s+n[12],t[1]=n[1]*i+n[5]*s+n[13],t}function qn(t,e,n,i){var s=e[0]-n[0],r=e[1]-n[1],o=Math.sin(i),a=Math.cos(i);return t[0]=s*a-r*o+n[0],t[1]=s*o+r*a+n[1],t}function zn(t,e){var n=t[0],i=t[1],s=e[0],r=e[1],o=Math.sqrt(n*n+i*i)*Math.sqrt(s*s+r*r),a=o&&(n*s+i*r)/o;return Math.acos(Math.min(Math.max(a,-1),1))}function jn(t){return t[0]=0,t[1]=0,t}function Un(t){return"vec2("+t[0]+", "+t[1]+")"}function Wn(t,e){return t[0]===e[0]&&t[1]===e[1]}function Gn(t,e){var n=t[0],i=t[1],s=e[0],r=e[1];return Math.abs(n-s)<=1e-6*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-r)<=1e-6*Math.max(1,Math.abs(i),Math.abs(r))}t(ln,"create",(function(){return cn})),t(ln,"clone",(function(){return un})),t(ln,"fromValues",(function(){return hn})),t(ln,"copy",(function(){return pn})),t(ln,"set",(function(){return dn})),t(ln,"add",(function(){return vn})),t(ln,"subtract",(function(){return mn})),t(ln,"multiply",(function(){return fn})),t(ln,"divide",(function(){return _n})),t(ln,"ceil",(function(){return gn})),t(ln,"floor",(function(){return bn})),t(ln,"min",(function(){return wn})),t(ln,"max",(function(){return xn})),t(ln,"round",(function(){return yn})),t(ln,"scale",(function(){return Cn})),t(ln,"scaleAndAdd",(function(){return En})),t(ln,"distance",(function(){return Tn})),t(ln,"squaredDistance",(function(){return Mn})),t(ln,"length",(function(){return kn})),t(ln,"squaredLength",(function(){return Pn})),t(ln,"negate",(function(){return An})),t(ln,"inverse",(function(){return Sn})),t(ln,"normalize",(function(){return Vn})),t(ln,"len",(function(){return Kn})),t(ln,"dot",(function(){return On})),t(ln,"cross",(function(){return Dn})),t(ln,"lerp",(function(){return Rn})),t(ln,"random",(function(){return Ln})),t(ln,"transformMat2",(function(){return In})),t(ln,"transformMat2d",(function(){return Nn})),t(ln,"transformMat3",(function(){return Fn})),t(ln,"transformMat4",(function(){return Bn})),t(ln,"rotate",(function(){return qn})),t(ln,"angle",(function(){return zn})),t(ln,"zero",(function(){return jn})),t(ln,"str",(function(){return Un})),t(ln,"exactEquals",(function(){return Wn})),t(ln,"equals",(function(){return Gn})),t(ln,"sub",(function(){return Hn})),t(ln,"mul",(function(){return $n})),t(ln,"div",(function(){return Xn})),t(ln,"dist",(function(){return Yn})),t(ln,"sqrDist",(function(){return Zn})),t(ln,"sqrLen",(function(){return Qn})),t(ln,"forEach",(function(){return Jn}));var Kn=kn,Hn=mn,$n=fn,Xn=_n,Yn=Tn,Zn=Mn,Qn=Pn,Jn=function(){var t=cn();return function(e,n,i,s,r,o){var a,l;for(n||(n=2),i||(i=0),l=s?Math.min(s*n+i,e.length):e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],r(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}}();function ti(t,e,n,i){const s=t.createProgram();if([t.VERTEX_SHADER,t.FRAGMENT_SHADER].forEach(((n,i)=>{const r=function(t,e,n){const i=t.createShader(e);if(t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;console.error(t.getShaderInfoLog(i)),t.deleteShader(i)}(t,n,e[i]);t.attachShader(s,r)})),n&&t.transformFeedbackVaryings(s,n,t.SEPARATE_ATTRIBS),i)for(const e in i)t.bindAttribLocation(s,i[e],e);t.linkProgram(s);if(t.getProgramParameter(s,t.LINK_STATUS))return s;console.error(t.getProgramInfoLog(s)),t.deleteProgram(s)}function ei(t,e,n){const i=t.createVertexArray();t.bindVertexArray(i);for(const[n,i,s]of e)-1!=i&&(t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,s,t.FLOAT,!1,0,0));if(n){const e=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),t.STATIC_DRAW)}return t.bindVertexArray(null),i}function ni(t,e,n){const i=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e,n),t.bindBuffer(t.ARRAY_BUFFER,null),i}function ii(t,e,n){const i=t.createFramebuffer(),s=[];return t.bindFramebuffer(t.FRAMEBUFFER,i),e.forEach(((e,n)=>{const i=t[`COLOR_ATTACHMENT${n}`];t.framebufferTexture2D(t.FRAMEBUFFER,i,t.TEXTURE_2D,e,0),s.push(i)})),n&&t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,n,0),t.drawBuffers(s),t.checkFramebufferStatus(t.FRAMEBUFFER)!=t.FRAMEBUFFER_COMPLETE&&console.error("could not complete render framebuffer setup",t.checkFramebufferStatus(t.FRAMEBUFFER)),t.bindFramebuffer(t.FRAMEBUFFER,null),i}function si(t,e,n,i){t.bindFramebuffer(t.FRAMEBUFFER,e),t.viewport(0,0,n,i)}function ri(t,e,n,i,s){const r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n),r}var oi=new WeakSet;class ai{update(t){const e=16/(t+.01),n=10*e;let i;if(this.followPos[0]+=(this.pointerPos[0]-this.followPos[0])/n,this.followPos[1]+=(this.pointerPos[1]-this.followPos[1])/n,this.pointerDown){const t=d(this,oi,li).call(this,this.followPos),n=d(this,oi,li).call(this,this.prevFollowPos),s=_t.normalize(_t.create(),t),r=_t.normalize(_t.create(),n),o=_t.cross(_t.create(),t,n);_t.normalize(o,o);const a=Math.max(-1,Math.min(1,_t.dot(s,r))),l=Math.acos(a)*e*5;this.velocity=l,this.rotationAxis=_t.clone(o),i=ft.setAxisAngle(ft.create(),o,l)}else this.velocity*=this.velocity>.0075?.99:1,i=ft.setAxisAngle(ft.create(),this.rotationAxis,this.velocity);ft.multiply(this.rotationQuat,i,this.rotationQuat),ft.normalize(this.rotationQuat,this.rotationQuat),this.prevFollowPos=_t.clone(this.followPos),this.updateCallback()}constructor(t,e){v(this,oi),m(this,"rotationQuat",ft.create()),this.canvas=t,this.updateCallback=e||(()=>null),this.pointerDown=!1,this.pointerDownPos=ln.create(),this.pointerPos=ln.create(),this.followPos=_t.create(),this.prevFollowPos=_t.create(),this.autoRotationSpeed=0,this.velocity=.0025,this.rotationAxis=_t.fromValues(0,1,0),t.style.touchAction="none",t.addEventListener("pointerdown",(t=>{this.pointerDownPos=ln.fromValues(t.clientX,t.clientY),this.followPos=_t.fromValues(t.clientX,t.clientY,0),this.pointerPos=ln.fromValues(t.clientX,t.clientY),this.prevFollowPos=_t.fromValues(t.clientX,t.clientY,0),this.pointerDown=!0,this.autoRotationSpeed=0})),t.addEventListener("pointerup",(t=>{this.pointerDown=!1})),t.addEventListener("pointerleave",(t=>{this.pointerDown=!1})),t.addEventListener("pointermove",(t=>{this.pointerDown&&(this.pointerPos[0]=t.clientX,this.pointerPos[1]=t.clientY)}))}}function li(t){const e=this.canvas.clientWidth,n=this.canvas.clientHeight,i=Math.max(e,n)-1,s=(2*t[0]-e-1)/i,r=(2*t[1]-n-1)/i;let o=0;const a=s*s+r*r;return o=a<=.5?Math.sqrt(1-a):.5/Math.sqrt(a),_t.fromValues(-s,r,o)}var ci=new WeakMap,ui=new WeakMap,hi=new WeakMap,pi=new WeakMap,di=new WeakMap,vi=new WeakMap,mi=new WeakMap,fi=new WeakMap,_i=new WeakMap,gi=new WeakSet,bi=new WeakSet,wi=new WeakSet;class xi{constructor(t=50,e=20,n=13,i=32,s=8,r=1.5){v(this,gi),v(this,bi),v(this,wi),m(this,"height",50),m(this,"radius",20),m(this,"bevelRadius",13),m(this,"radiusSegments",32),m(this,"bevelSegments",8),h(this,ci,{writable:!0,value:void 0}),h(this,ui,{writable:!0,value:void 0}),h(this,hi,{writable:!0,value:void 0}),h(this,pi,{writable:!0,value:void 0}),h(this,di,{writable:!0,value:void 0}),h(this,vi,{writable:!0,value:void 0}),h(this,mi,{writable:!0,value:[]}),h(this,fi,{writable:!0,value:[]}),h(this,_i,{writable:!0,value:[]}),this.height=t,this.radius=e,this.bevelRadius=n,history.radiusSegments=i,this.bevelSegments=s,this.normalBendFactor=r,p(this,ci,this.height/2),p(this,ui,this.radius-this.bevelRadius),p(this,hi,2*Math.PI/this.radiusSegments),p(this,pi,.5*Math.PI/(this.bevelSegments+1)),p(this,di,c(this,pi)*this.normalBendFactor),p(this,vi,(.5*Math.PI-2*c(this,di))/(this.bevelSegments+1)),d(this,gi,yi).call(this,!0),d(this,bi,Ci).call(this,!0),d(this,gi,yi).call(this,!1),d(this,bi,Ci).call(this,!1),d(this,wi,Ei).call(this),this.vertices=new Float32Array(c(this,mi)),this.normals=new Float32Array(c(this,_i)),this.indices=new Uint16Array(c(this,fi))}}function yi(t=!0){const e=t?c(this,ci):-c(this,ci),n=_t.fromValues(0,Math.sign(e),0),i=_t.fromValues(0,e,0),s=c(this,mi).push(...i)/3-1;c(this,_i).push(...n);for(let e=0;e<this.radiusSegments;++e){const n=e*c(this,hi),r=c(this,ui)*Math.cos(n),o=c(this,ui)*Math.sin(n);c(this,mi).push(..._t.fromValues(r,i[1],o));const a=.5*Math.PI-c(this,di),l=Math.sin(a),u=Math.cos(a)*Math.cos(n),h=Math.cos(a)*Math.sin(n),p=_t.fromValues(u,t?l:-l,h),d=_t.normalize(_t.create(),p);c(this,_i).push(...d),t?c(this,fi).push(s,s+(e+1)%this.radiusSegments+1,s+e+1):c(this,fi).push(s,s+e+1,s+(e+1)%this.radiusSegments+1)}}function Ci(t=!0){const e=c(this,mi).length/3,n=(this.bevelSegments+2)*this.radiusSegments,i=t?c(this,ci)-this.bevelRadius:this.bevelRadius-c(this,ci);let s=0;for(let r=0;r<this.radiusSegments;++r){const o=r*c(this,hi),a=c(this,ui)*Math.cos(o),l=c(this,ui)*Math.sin(o),u=_t.fromValues(a,i,l);for(let i=0;i<=this.bevelSegments+1;++i){const r=.5*Math.PI-i*c(this,pi),a=this.bevelRadius*Math.sin(r),l=this.bevelRadius*Math.cos(r)*Math.cos(o),h=this.bevelRadius*Math.cos(r)*Math.sin(o),p=_t.fromValues(l,t?a:-a,h),d=_t.add(_t.create(),u,p);c(this,mi).push(...d);const v=.5*Math.PI-c(this,di)-i*c(this,vi),m=this.bevelRadius*Math.sin(v),f=this.bevelRadius*Math.cos(v)*Math.cos(o),_=this.bevelRadius*Math.cos(v)*Math.sin(o),g=_t.fromValues(f,t?m:-m,_),b=_t.normalize(_t.create(),g);if(c(this,_i).push(...b),i<=this.bevelSegments){const i=(s+(this.bevelSegments+2))%n;t?(c(this,fi).push(e+s,e+i,e+i+1),c(this,fi).push(e+s,e+i+1,e+s+1)):(c(this,fi).push(e+s,e+i+1,e+i),c(this,fi).push(e+s,e+s+1,e+i+1))}s++}}}function Ei(){const t=c(this,mi).length/3;let e=0;for(let n=0;n<this.radiusSegments;++n){const i=n*c(this,hi),s=this.radius*Math.cos(i),r=this.radius*Math.sin(i),o=_t.fromValues(s,c(this,ci)-this.bevelRadius,r),a=_t.fromValues(s,this.bevelRadius-c(this,ci),r),l=c(this,di),u=Math.sin(l),h=Math.cos(l)*Math.cos(i),p=Math.cos(l)*Math.sin(i),d=_t.fromValues(h,u,p),v=_t.fromValues(h,-u,p),m=_t.normalize(_t.create(),d),f=_t.normalize(_t.create(),v);_t.normalize(_t.create(),_t.fromValues(s,0,r));c(this,mi).push(...o),c(this,mi).push(...a),c(this,_i).push(...m),c(this,_i).push(...f);const _=(e+2)%(2*this.radiusSegments);c(this,fi).push(t+e,t+_,t+_+1),c(this,fi).push(t+e,t+_+1,t+e+1),e+=2}}var Ti=new WeakMap,Mi=new WeakMap,ki=new WeakMap;class Pi{pointAt(t){const e=t*t,n=e*t,i=3*e-n-3*t+1,s=3*n-6*e+3*t,r=-3*n+3*e,o=n,a=_t.scale(_t.create(),this.a0,i),l=_t.scale(_t.create(),this.c0,s),c=_t.scale(_t.create(),this.c1,r),u=_t.scale(_t.create(),this.a1,o),h=_t.add(_t.create(),a,l),p=_t.add(_t.create(),c,u);return _t.add(_t.create(),h,p)}velocityAt(t){const e=t*t,n=-3*e+6*t-3,i=9*e-12*t+3,s=-9*e+6*t,r=3*e,o=_t.scale(_t.create(),this.a0,n),a=_t.scale(_t.create(),this.c0,i),l=_t.scale(_t.create(),this.c1,s),c=_t.scale(_t.create(),this.a1,r),u=_t.add(_t.create(),o,a),h=_t.add(_t.create(),l,c);return _t.add(_t.create(),u,h)}map(t){const e=t*c(this,Mi);let n=c(this,Ti),i=0,s=0;for(;i<n;)s=i+((n-i)/2|0),c(this,ki)[s]<e?i=s+1:n=s;c(this,ki)[s]>e&&s--;const r=c(this,ki)[s];return r===e?s/c(this,Ti):(s+(e-r)/(c(this,ki)[s+1]-r))/c(this,Ti)}constructor(t,e,n,i){h(this,Ti,{writable:!0,value:100}),h(this,Mi,{writable:!0,value:0}),h(this,ki,{writable:!0,value:[]}),this.a0=t,this.c0=e,this.c1=n,this.a1=i;let s=this.pointAt(0);c(this,ki).push(0);for(let t=1;t<=c(this,Ti);++t){const e=t/c(this,Ti),n=this.pointAt(e);c(this,ki)[t]=c(this,ki)[t-1]+_t.distance(s,n),s=n}p(this,Mi,c(this,ki)[c(this,Ti)])}}mi=new WeakMap,fi=new WeakMap,_i=new WeakMap;var Ai=new WeakMap,Si=new WeakMap,Vi=new WeakMap,Oi=new WeakMap,Di=new WeakSet;class Ri{get extent(){const t=[...this.contourBezierPoints.a1];return t[1]*=c(this,Si),t[2]*=c(this,Oi),t}constructor(){v(this,Di),h(this,mi,{writable:!0,value:[]}),h(this,fi,{writable:!0,value:[]}),h(this,_i,{writable:!0,value:[]}),h(this,Ai,{writable:!0,value:[]}),h(this,Si,{writable:!0,value:10}),h(this,Vi,{writable:!0,value:7.5}),h(this,Oi,{writable:!0,value:20}),m(this,"contourBezierPoints",{a0:[0,0,0],c0:[0,.4,0],a1:[0,1,-1],c1:[0,.4,.1]});for(let t=0;t<=12;++t){const e=t/12;for(let t=0;t<=8;++t){const n=4,i=(n-t)/n,s=d(this,Di,Li).call(this,i),r=s.map(e),o=s.pointAt(r),a=_t.normalize(_t.create(),s.velocityAt(r)),l=Math.sqrt(2-i*i),u=-o[0],h=o[1],p=o[2]+1.5*(1-e*e*e)*(1-l);c(this,mi).push(..._t.fromValues(u,h,p));const v=_t.normalize(_t.create(),_t.fromValues(-u,0,-p)),m=a[2]/a[1],f=_t.rotateX(_t.create(),v,_t.fromValues(0,0,0),Math.atan(m));c(this,_i).push(...f),c(this,Ai).push(i,e)}}for(let t=0;t<12;++t)for(let e=0;e<8;++e)c(this,fi).push(9*t+e,9*t+e+1,9*(t+1)+e+1),c(this,fi).push(9*(t+1)+e+1,9*(t+1)+e,9*t+e);this.vertices=new Float32Array(c(this,mi)),this.normals=new Float32Array(c(this,_i)),this.uvs=new Float32Array(c(this,Ai)),this.indices=new Uint16Array(c(this,fi))}}function Li(t){const e=.02*c(this,Vi),n=[...this.contourBezierPoints.a0],i=[...this.contourBezierPoints.c0],s=[...this.contourBezierPoints.a1],r=[...this.contourBezierPoints.c1];n[0]=e*t,i[0]=n[0],r[0]=c(this,Vi)*t,i[1]=i[1]*c(this,Si),r[1]=r[1]*c(this,Si),s[1]=s[1]*c(this,Si),s[2]*=c(this,Oi),r[2]*=c(this,Oi);return new Pi(n,i,r,s)}class Ii{render(t,e,n,i,s){const r=this.gl;r.useProgram(this.program),r.enable(r.CULL_FACE),r.enable(r.DEPTH_TEST),r.uniformMatrix4fv(this.locations.u_worldMatrix,!1,t),r.uniformMatrix4fv(this.locations.u_viewMatrix,!1,e),r.uniformMatrix4fv(this.locations.u_projectionMatrix,!1,n),r.bindVertexArray(i),r.drawArrays(r.LINE_STRIP,0,s)}constructor(t){this.gl=t,this.program=ti(t,[e("#version 300 es\n#define GLSLIFY 1\n\nuniform mat4 u_worldMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_projectionMatrix;\n\nin vec3 a_position;\n\nvoid main() {\n    vec4 worldPosition = u_worldMatrix * vec4(a_position, 1.);\n    vec4 viewPosition = u_viewMatrix * worldPosition;\n    gl_Position = u_projectionMatrix * viewPosition;\n}"),e("#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\nout vec4 outColor;\n\nvoid main() {\n    outColor = vec4(1., 0., 0., 1.);\n}\n")],null,{a_position:0}),this.locations={a_position:t.getAttribLocation(this.program,"a_position"),u_worldMatrix:t.getUniformLocation(this.program,"u_worldMatrix"),u_viewMatrix:t.getUniformLocation(this.program,"u_viewMatrix"),u_projectionMatrix:t.getUniformLocation(this.program,"u_projectionMatrix")}}}const Ni={rand_vect:function(){let t=2*Math.random()*Math.PI;return{x:Math.cos(t),y:Math.sin(t)}},dot_prod_grid:function(t,e,n,i){let s,r=t-n,o=e-i;return this.gradients[[n,i]]?s=this.gradients[[n,i]]:(s=this.rand_vect(),this.gradients[[n,i]]=s),r*s.x+o*s.y},smootherstep:function(t){return 6*t**5-15*t**4+10*t**3},interp:function(t,e,n){return e+this.smootherstep(t)*(n-e)},seed:function(){this.gradients={},this.memory={}},get:function(t,e){if(this.memory.hasOwnProperty([t,e]))return this.memory[[t,e]];let n=Math.floor(t),i=Math.floor(e),s=this.dot_prod_grid(t,e,n,i),r=this.dot_prod_grid(t,e,n+1,i),o=this.dot_prod_grid(t,e,n,i+1),a=this.dot_prod_grid(t,e,n+1,i+1),l=this.interp(t-n,s,r),c=this.interp(t-n,o,a),u=this.interp(e-i,l,c);return this.memory[[t,e]]=u,u}};Ni.seed();const Fi=t=>--t*t*t+1;var Bi=new WeakMap,qi=new WeakMap,zi=new WeakMap,ji=new WeakSet,Ui=new WeakSet,Wi=new WeakSet,Gi=new WeakSet,Ki=new WeakSet,Hi=new WeakSet,$i=new WeakSet;class Xi{generate(t){d(this,Ui,Zi).call(this),d(this,Wi,Qi).call(this,t),this.onPlantGrow&&this.onPlantGrow()}update(t){d(this,Gi,Ji).call(this,t)}render(t,e=!1){const n=f.multiply(f.create(),t.worldMatrix,this.modelMatrix);e&&this.geometryHelper.render(n,t.viewMatrix,t.projectionMatrix,this.stemVAO,this.stemBuffers.numElem),d(this,Ki,ts).call(this,t,n)}constructor(t,n,i,s,r=null){v(this,ji),v(this,Ui),v(this,Wi),v(this,Gi),v(this,Ki),v(this,Hi),v(this,$i),h(this,Bi,{writable:!0,value:18}),h(this,qi,{writable:!0,value:2}),h(this,zi,{writable:!0,value:c(this,Bi)*c(this,qi)}),m(this,"leafInstances",void 0),m(this,"onLeafGrow",void 0),m(this,"onLeafWither",void 0),m(this,"onPlantGrow",void 0),this.context=t,this.vesselHeight=n,this.vesselRadius=i,this.vesselBevelRadius=s,this.animationDoneCallback=r,this.modelMatrix=f.translate(f.create(),f.create(),_t.fromValues(0,-this.vesselHeight/2,0));const o=this.context;this.leafProgram=ti(o,[e("#version 300 es\n#define GLSLIFY 1\n\nuniform mat4 u_worldMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_worldInverseTransposeMatrix;\nuniform vec3 u_cameraPosition;\n\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_uv;\nin mat4 a_instanceMatrix;\n\nout vec3 v_position;\nout vec3 v_viewPosition;\nout vec3 v_normal;\nout vec3 v_viewNormal;\nout vec2 v_uv;\nout vec3 v_surfaceToView;\n\nvoid main() {\n    v_uv = a_uv;\n    v_normal = (u_worldInverseTransposeMatrix * a_instanceMatrix * vec4(a_normal, 0.)).xyz;\n    vec4 worldPosition = u_worldMatrix * a_instanceMatrix * vec4(a_position, 1.);\n    vec4 viewPosition = u_viewMatrix * worldPosition;\n    gl_Position = u_projectionMatrix * viewPosition;\n    v_surfaceToView = u_cameraPosition - worldPosition.xyz;\n    v_position = a_position.xyz;\n    v_viewPosition = viewPosition.xyz;\n    v_viewNormal = (u_viewMatrix * vec4(v_normal, 0.)).xyz;\n\n    gl_PointSize = 2.;\n}\n"),e("#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\nuniform mat4 u_inversProjectionMatrix;\nuniform float u_frames;\nuniform sampler2D u_gradientTexture;\n\nin vec3 v_position;\nin vec3 v_normal;\nin vec3 v_viewNormal;\nin vec2 v_uv;\nin vec3 v_surfaceToView;\nin vec3 v_viewPosition;\n\nout vec4 outColor;\n\n#define PI 3.1415926535\n\nvoid main() {\n    vec3 pos = v_position;\n    vec3 N = normalize(v_normal);\n    vec3 VN = normalize(v_viewNormal);\n    vec3 V = normalize(v_surfaceToView);\n    vec3 L = normalize(vec3(0., .5, 4.));\n    float NdL = max(0., dot(N, L));\n\n    // the albedo term from the leaf gradient with some distortion\n    vec2 uv = vec2(v_uv.y, v_uv.x);\n    // apply line texture\n    uv.x += sin(v_uv.x * PI * 5.) * 0.1;\n    vec4 albedo = texture(u_gradientTexture, uv);\n    // darken the edges\n    albedo *= min(1., 1. - pow(uv.y, 2.) * 0.1 + uv.x * 0.1);\n\n    // the diffuse term\n    float diffuse = (NdL * NdL * NdL) * 0.1 + .95;\n\n    outColor = albedo * diffuse;\n}\n")],null,{a_position:0,a_normal:1,a_uv:2}),this.leafLocations={a_position:o.getAttribLocation(this.leafProgram,"a_position"),a_normal:o.getAttribLocation(this.leafProgram,"a_normal"),a_uv:o.getAttribLocation(this.leafProgram,"a_uv"),a_instanceMatrix:o.getAttribLocation(this.leafProgram,"a_instanceMatrix"),u_worldMatrix:o.getUniformLocation(this.leafProgram,"u_worldMatrix"),u_viewMatrix:o.getUniformLocation(this.leafProgram,"u_viewMatrix"),u_projectionMatrix:o.getUniformLocation(this.leafProgram,"u_projectionMatrix"),u_inversProjectionMatrix:o.getUniformLocation(this.leafProgram,"u_inversProjectionMatrix"),u_worldInverseTransposeMatrix:o.getUniformLocation(this.leafProgram,"u_worldInverseTransposeMatrix"),u_cameraPosition:o.getUniformLocation(this.leafProgram,"u_cameraPosition"),u_gradientTexture:o.getUniformLocation(this.leafProgram,"u_gradientTexture")},this.leafGeometry=new Ri,this.leafBuffers={position:ni(o,this.leafGeometry.vertices,o.STATIC_DRAW),normal:ni(o,this.leafGeometry.normals,o.STATIC_DRAW),uv:ni(o,this.leafGeometry.uvs,o.STATIC_DRAW),numElem:this.leafGeometry.indices.length},this.leafVAO=ei(o,[[this.leafBuffers.position,this.leafLocations.a_position,3],[this.leafBuffers.normal,this.leafLocations.a_normal,3],[this.leafBuffers.uv,this.leafLocations.a_uv,2]],this.leafGeometry.indices),this.leafGradientTexture=ri(o,o.LINEAR,o.LINEAR,o.MIRRORED_REPEAT,o.MIRRORED_REPEAT);const a=new Uint8Array([221,255,185,134,224,69,114,214,80,134,224,69,134,224,69,211,245,144,225,255,174]);o.bindTexture(o.TEXTURE_2D,this.leafGradientTexture),o.texImage2D(o.TEXTURE_2D,0,o.RGB,7,1,0,o.RGB,o.UNSIGNED_BYTE,a),d(this,ji,Yi).call(this)}}function Yi(){const t=this.context;this.leafInstances={matricesArray:new Float32Array(16*c(this,zi)),matrices:[],bindMatrices:[],buffer:t.createBuffer(),animationParams:[]};const e=c(this,zi);for(let t=0;t<e;++t){const e=new Float32Array(this.leafInstances.matricesArray.buffer,64*t,16);e.set(f.create()),this.leafInstances.matrices.push(e),this.leafInstances.bindMatrices.push(f.create())}t.bindVertexArray(this.leafVAO),t.bindBuffer(t.ARRAY_BUFFER,this.leafInstances.buffer),t.bufferData(t.ARRAY_BUFFER,this.leafInstances.matricesArray.byteLength,t.DYNAMIC_DRAW);for(let e=0;e<4;++e){const n=this.leafLocations.a_instanceMatrix+e;t.enableVertexAttribArray(n),t.vertexAttribPointer(n,4,t.FLOAT,!1,64,16*e),t.vertexAttribDivisor(n,1)}t.bindBuffer(t.ARRAY_BUFFER,null),t.bindVertexArray(null)}function Zi(){const t=this.vesselHeight/2;let e=2*Math.random()*Math.PI;const n=Math.random()*(this.vesselRadius-this.vesselBevelRadius),i=_t.fromValues(n*Math.cos(e),0,n*Math.sin(e));e=2*Math.random()*Math.PI;const s=_t.fromValues(n*Math.cos(e),this.vesselHeight,n*Math.sin(e)),r=.1*this.vesselBevelRadius;e=2*Math.random()*Math.PI;let o=Math.random()*(t-r)+r;const a=Math.random()*this.vesselRadius,l=_t.fromValues(a*Math.cos(e),o,a*Math.sin(e));e=2*Math.random()*Math.PI,o=Math.random()*(t-r)+t;const u=Math.random()*this.vesselRadius,h=_t.fromValues(u*Math.cos(e),o,u*Math.sin(e)),p=this.context;this.stemVertices=[],this.stemCurve=new Pi(i,l,h,s);for(let t=0;t<=c(this,Bi);++t){const e=t/c(this,Bi);this.stemVertices.push(...this.stemCurve.pointAt(this.stemCurve.map(e)))}this.stemVerticesData=new Float32Array(this.stemVertices),this.stemVAO?(p.bindBuffer(p.ARRAY_BUFFER,this.stemBuffers.position),p.bufferSubData(p.ARRAY_BUFFER,0,this.stemVerticesData),p.bindBuffer(p.ARRAY_BUFFER,null)):(this.stemBuffers={position:ni(p,this.stemVerticesData,p.DYNAMIC_DRAW),numElem:this.stemVertices.length/3},this.geometryHelper=new Ii(p),this.stemVAO=ei(p,[[this.stemBuffers.position,this.geometryHelper.locations.a_position,3]]))}function Qi(t){this.context;this.averageLeafDuration=300,this.leafStaggerDelay=2.5,this.totalDuration=0;const e=f.rotateX(f.create(),f.create(),-Math.PI/2),n=c(this,zi),i=this.vesselHeight/n*.015,s=_t.fromValues(0,0,1),r=this.leafGeometry.extent,o=_t.length(r);for(let t=0;t<n;++t){const a=t/(1.2*n)+.03,l=f.create(),c=f.create(),u=Math.random()*i-i/2,h=this.stemCurve.map(a+u),p=this.stemCurve.pointAt(h);f.translate(c,l,p);const v=_t.normalize(_t.create(),this.stemCurve.velocityAt(h));_t.rotateY(s,s,_t.create(),Math.random()*Math.PI*2-Math.PI);const m=f.targetTo(f.create(),_t.create(),v,s);f.multiply(m,m,e),f.multiply(c,c,m);const _=f.multiply(f.create(),this.modelMatrix,c),g=_t.transformMat4(_t.create(),r,_),b=_t.transformMat4(_t.create(),_t.create(),_),w=_t.normalize(_t.create(),_t.subtract(_t.create(),g,b)),x=_t.clone(b);for(let t=0;t<4;++t){const t=-d(this,Hi,es).call(this,x);_t.add(x,x,_t.scale(_t.create(),w,t))}const y=_t.subtract(_t.create(),x,b),C=Math.min(1.2,_t.length(y)/o);f.scale(c,c,[C,C,C]),this.leafInstances.bindMatrices[t]=c;const E=Math.max(.75*this.averageLeafDuration,this.averageLeafDuration*C);this.leafInstances.animationParams[t]={duration:E},this.totalDuration=Math.max(this.totalDuration,E+this.leafStaggerDelay*t)}this.startFrame=t,this.leafAnimationStartNdx=-1}function Ji(t){const e=this.context,n=c(this,zi),i=Math.min(this.totalDuration,t-this.startFrame);for(let t=0;t<n;++t){const e=this.leafInstances.animationParams[t].duration,n=t*this.leafStaggerDelay;let s=Math.min(e,Math.max(0,i-n))/e;this.onLeafGrow&&s>0&&t>this.leafAnimationStartNdx&&(this.leafAnimationStartNdx=t,this.onLeafGrow(t));let r=s;s<=.2?r/=.2:r=s>.8?1-(s-.8)/.2:1,r=Fi(r);const o=.8*(1-r*r)+.2,a=10*r*r*.5+1,l=.5*Ni.get(s*a,s*a)*o,c=this.leafInstances.bindMatrices[t],u=f.fromScaling(f.create(),_t.fromValues(r,r,r));f.rotateX(u,u,l),f.multiply(u,c,u),f.copy(this.leafInstances.matrices[t],u)}e.bindBuffer(e.ARRAY_BUFFER,this.leafInstances.buffer),e.bufferSubData(e.ARRAY_BUFFER,0,this.leafInstances.matricesArray),e.bindBuffer(e.ARRAY_BUFFER,null),i>=this.totalDuration&&this.animationDoneCallback&&this.animationDoneCallback()}function ts(t,e){const n=this.context;n.useProgram(this.leafProgram),n.bindVertexArray(this.leafVAO),n.uniformMatrix4fv(this.leafLocations.u_viewMatrix,!1,t.viewMatrix),n.uniformMatrix4fv(this.leafLocations.u_projectionMatrix,!1,t.projectionMatrix),n.uniformMatrix4fv(this.leafLocations.u_inversProjectionMatrix,!1,t.inversProjectionMatrix),n.uniform3f(this.leafLocations.u_cameraPosition,t.cameraMatrix[12],t.cameraMatrix[14],t.cameraMatrix[14]),n.uniformMatrix4fv(this.leafLocations.u_worldMatrix,!1,e),n.uniformMatrix4fv(this.leafLocations.u_worldInverseTransposeMatrix,!1,t.worldInverseTransposeMatrix),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.leafGradientTexture),n.uniform1i(this.leafProgram.u_gradientTexture,0),n.drawElementsInstanced(n.TRIANGLES,this.leafBuffers.numElem,n.UNSIGNED_SHORT,0,c(this,zi)),n.cullFace(n.FRONT);const i=f.scale(f.create(),t.worldInverseTransposeMatrix,_t.fromValues(-1,-1,-1));n.uniformMatrix4fv(this.leafLocations.u_worldInverseTransposeMatrix,!1,i),n.drawElementsInstanced(n.TRIANGLES,this.leafBuffers.numElem,n.UNSIGNED_SHORT,0,c(this,zi)),n.cullFace(n.BACK)}function es(t){const e=.93;return d(this,$i,ns).call(this,t,this.vesselRadius*e,this.vesselBevelRadius*e,this.vesselHeight/2*e)}function ns(t,e,n,i){const s=ln.fromValues(ln.length(ln.fromValues(t[0],t[2]))-e+n,Math.abs(t[1])-i+n);return Math.min(Math.max(s[0],s[1]),0)+ln.length(ln.fromValues(Math.max(s[0],0),Math.max(s[1],0)))-n}var is={};!function(t,e,n,i){function s(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=s(e),o=s(n),a=s(i),l=function(t,e,n){return{endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}},c=function(t,e,n){return{endTime:e,insertTime:n,type:"linearRampToValue",value:t}},u=function(t,e){return{startTime:e,type:"setValue",value:t}},h=function(t,e,n){return{duration:n,startTime:e,type:"setValueCurve",values:t}},p=function(t,e,n){var i=n.startTime,s=n.target,r=n.timeConstant;return s+(e-s)*Math.exp((i-t)/r)},d=function(t){return"exponentialRampToValue"===t.type},v=function(t){return"linearRampToValue"===t.type},m=function(t){return d(t)||v(t)},f=function(t){return"setValue"===t.type},_=function(t){return"setValueCurve"===t.type},g=function t(e,n,i,s){var r=e[n];return void 0===r?s:m(r)||f(r)?r.value:_(r)?r.values[r.values.length-1]:p(i,t(e,n-1,r.startTime,s),r)},b=function(t,e,n,i,s){return void 0===n?[i.insertTime,s]:m(n)?[n.endTime,n.value]:f(n)?[n.startTime,n.value]:_(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,g(t,e-1,n.startTime,s)]},w=function(t){return"cancelAndHold"===t.type},x=function(t){return"cancelScheduledValues"===t.type},y=function(t){return w(t)||x(t)?t.cancelTime:d(t)||v(t)?t.endTime:t.startTime},C=function(t,e,n,i){var s=i.endTime,r=i.value;return n===r?r:0<n&&0<r||n<0&&r<0?n*Math.pow(r/n,(t-e)/(s-e)):0},E=function(t,e,n,i){return n+(t-e)/(i.endTime-e)*(i.value-n)},T=function(t,e){var n=Math.floor(e),i=Math.ceil(e);return n===i?t[n]:(1-(e-n))*t[n]+(1-(i-e))*t[i]},M=function(t,e){var n=e.duration,i=e.startTime,s=e.values,r=(t-i)/n*(s.length-1);return T(s,r)},k=function(t){return"setTarget"===t.type},P=function(t){function e(t){o.default(this,e),this._automationEvents=[],this._currenTime=0,this._defaultValue=t}return a.default(e,[{key:t,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(t){var e=y(t);if(w(t)||x(t)){var n=this._automationEvents.findIndex((function(n){return x(t)&&_(n)?n.startTime+n.duration>=e:y(n)>=e})),i=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),w(t)){var s=this._automationEvents[this._automationEvents.length-1];if(void 0!==i&&m(i)){if(k(s))throw new Error("The internal list is malformed.");var r=_(s)?s.startTime+s.duration:y(s),o=_(s)?s.values[s.values.length-1]:s.value,a=d(i)?C(e,r,o,i):E(e,r,o,i),p=d(i)?l(a,e,this._currenTime):c(a,e,this._currenTime);this._automationEvents.push(p)}void 0!==s&&k(s)&&this._automationEvents.push(u(this.getValue(e),e)),void 0!==s&&_(s)&&s.startTime+s.duration>e&&(this._automationEvents[this._automationEvents.length-1]=h(new Float32Array([6,7]),s.startTime,e-s.startTime))}}else{var f=this._automationEvents.findIndex((function(t){return y(t)>e})),g=-1===f?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[f-1];if(void 0!==g&&_(g)&&y(g)+g.duration>e)return!1;var b=d(t)?l(t.value,t.endTime,this._currenTime):v(t)?c(t.value,e,this._currenTime):t;if(-1===f)this._automationEvents.push(b);else{if(_(t)&&e+t.duration>y(this._automationEvents[f]))return!1;this._automationEvents.splice(f,0,b)}}return!0}},{key:"flush",value:function(t){var e=this._automationEvents.findIndex((function(e){return y(e)>t}));if(e>1){var n=this._automationEvents.slice(e-1),i=n[0];k(i)&&n.unshift(u(g(this._automationEvents,e-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=n}}},{key:"getValue",value:function(t){if(0===this._automationEvents.length)return this._defaultValue;var e=this._automationEvents.findIndex((function(e){return y(e)>t})),n=this._automationEvents[e],i=(-1===e?this._automationEvents.length:e)-1,s=this._automationEvents[i];if(void 0!==s&&k(s)&&(void 0===n||!m(n)||n.insertTime>t))return p(t,g(this._automationEvents,i-1,s.startTime,this._defaultValue),s);if(void 0!==s&&f(s)&&(void 0===n||!m(n)))return s.value;if(void 0!==s&&_(s)&&(void 0===n||!m(n)||s.startTime+s.duration>t))return t<s.startTime+s.duration?M(t,s):s.values[s.values.length-1];if(void 0!==s&&m(s)&&(void 0===n||!m(n)))return s.value;if(void 0!==n&&d(n)){var o=b(this._automationEvents,i,s,n,this._defaultValue),a=r.default(o,2),l=a[0],c=a[1];return C(t,l,c,n)}if(void 0!==n&&v(n)){var u=b(this._automationEvents,i,s,n,this._defaultValue),h=r.default(u,2),w=h[0],x=h[1];return E(t,w,x,n)}return this._defaultValue}}]),e}(Symbol.iterator),A=function(t){return{cancelTime:t,type:"cancelAndHold"}},S=function(t){return{cancelTime:t,type:"cancelScheduledValues"}},V=function(t,e){return{endTime:e,type:"exponentialRampToValue",value:t}},O=function(t,e){return{endTime:e,type:"linearRampToValue",value:t}},D=function(t,e,n){return{startTime:e,target:t,timeConstant:n,type:"setTarget"}};t.AutomationEventList=P,t.createCancelAndHoldAutomationEvent=A,t.createCancelScheduledValuesAutomationEvent=S,t.createExponentialRampToValueAutomationEvent=V,t.createLinearRampToValueAutomationEvent=O,t.createSetTargetAutomationEvent=D,t.createSetValueAutomationEvent=u,t.createSetValueCurveAutomationEvent=h,Object.defineProperty(t,"__esModule",{value:!0})}(is,r("f0cZC"),r("bfbtb"),r("kNrk6"));const ss=new WeakSet,rs=new WeakMap,os=new WeakMap,as=new WeakMap,ls=new WeakMap,cs=new WeakMap,us=new WeakMap,hs=new WeakMap,ps=new WeakMap,ds=new WeakMap,vs={construct:()=>vs},ms=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,fs=(t,e)=>{const n=[];let i=t.replace(/^[\s]+/,""),s=i.match(ms);for(;null!==s;){const t=s[1].slice(1,-1),r=s[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,e).toString());n.push(r),i=i.slice(s[0].length).replace(/^[\s]+/,""),s=i.match(ms)}return[n.join(";"),i]},_s=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},gs=t=>{if(!(t=>{try{new new Proxy(t,vs)}catch{return!1}return!0})(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},bs=(t,e)=>{const n=t.get(e);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},ws=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[i]=n;return t.delete(i),i},xs=(t,e,n,i)=>{const s=bs(t,e),r=ws(s,(t=>t[0]===n&&t[1]===i));return 0===s.size&&t.delete(e),r},ys=t=>bs(us,t),Cs=t=>{if(ss.has(t))throw new Error("The AudioNode is already stored.");ss.add(t),ys(t).forEach((t=>t(!0)))},Es=t=>"port"in t,Ts=t=>{if(!ss.has(t))throw new Error("The AudioNode is not stored.");ss.delete(t),ys(t).forEach((t=>t(!1)))},Ms=(t,e)=>{!Es(t)&&e.every((t=>0===t.size))&&Ts(t)},ks={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},Ps=(t,e)=>t.context===e,As=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Ss=()=>new DOMException("","IndexSizeError"),Vs=t=>{var e;t.getChannelData=(e=t.getChannelData,n=>{try{return e.call(t,n)}catch(t){if(12===t.code)throw Ss();throw t}})},Os={numberOfChannels:1},Ds=t=>ss.has(t),Rs={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},Ls=t=>bs(rs,t),Is=t=>bs(as,t),Ns=(t,e)=>{const{activeInputs:n}=Ls(t);n.forEach((n=>n.forEach((([n])=>{e.includes(t)||Ns(n,[...e,t])}))));const i=(t=>"playbackRate"in t)(t)?[t.playbackRate]:Es(t)?Array.from(t.parameters.values()):(t=>"frequency"in t&&"gain"in t)(t)?[t.Q,t.detune,t.frequency,t.gain]:(t=>"offset"in t)(t)?[t.offset]:(t=>!("frequency"in t)&&"gain"in t)(t)?[t.gain]:(t=>"detune"in t&&"frequency"in t)(t)?[t.detune,t.frequency]:(t=>"pan"in t)(t)?[t.pan]:[];for(const t of i){const n=Is(t);void 0!==n&&n.activeInputs.forEach((([t])=>Ns(t,e)))}Ds(t)&&Ts(t)},Fs=t=>{Ns(t.destination,[])},Bs=t=>void 0===t||"number"==typeof t||"string"==typeof t&&("balanced"===t||"interactive"===t||"playback"===t),qs=t=>"context"in t,zs=t=>qs(t[0]),js=(t,e,n,i)=>{for(const e of t)if(n(e)){if(i)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},Us=(t,e,[n,i],s)=>{js(t,[e,n,i],(t=>t[0]===e&&t[1]===n),s)},Ws=(t,[e,n,i],s)=>{const r=t.get(e);void 0===r?t.set(e,new Set([[n,i]])):js(r,[n,i],(t=>t[0]===n),s)},Gs=t=>"inputs"in t,Ks=(t,e,n,i)=>{if(Gs(e)){const s=e.inputs[i];return t.connect(s,n,0),[s,n,0]}return t.connect(e,n,i),[e,n,i]},Hs=(t,e,n)=>{for(const i of t)if(i[0]===e&&i[1]===n)return t.delete(i),i;return null},$s=(t,e)=>{if(!ys(t).delete(e))throw new Error("Missing the expected event listener.")},Xs=(t,e,n)=>{const i=bs(t,e),s=ws(i,(t=>t[0]===n));return 0===i.size&&t.delete(e),s},Ys=(t,e,n,i)=>{Gs(e)?t.disconnect(e.inputs[i],n,0):t.disconnect(e,n,i)},Zs=t=>bs(os,t),Qs=t=>bs(ls,t),Js=t=>hs.has(t),tr=t=>!ss.has(t),er=(t,e)=>new Promise((n=>{if(null!==e)n(!0);else{const e=t.createScriptProcessor(256,1,1),i=t.createGain(),s=t.createBuffer(1,2,44100),r=s.getChannelData(0);r[0]=1,r[1]=1;const o=t.createBufferSource();o.buffer=s,o.loop=!0,o.connect(e).connect(t.destination),o.connect(i),o.disconnect(i),e.onaudioprocess=i=>{const s=i.inputBuffer.getChannelData(0);Array.prototype.some.call(s,(t=>1===t))?n(!0):n(!1),o.stop(),e.onaudioprocess=null,o.disconnect(e),e.disconnect(t.destination)},o.start()}})),nr=(t,e)=>{const n=new Map;for(const e of t)for(const t of e){const e=n.get(t);n.set(t,void 0===e?1:e+1)}n.forEach(((t,n)=>e(n,t)))},ir=t=>"context"in t,sr=(t,e,n,i)=>{const{activeInputs:s,passiveInputs:r}=Is(e),{outputs:o}=Ls(t),a=ys(t),l=o=>{const a=Zs(t),l=Qs(e);if(o){const e=Xs(r,t,n);Us(s,t,e,!1),i||Js(t)||a.connect(l,n)}else{const e=((t,e,n)=>ws(t,(t=>t[0]===e&&t[1]===n)))(s,t,n);Ws(r,e,!1),i||Js(t)||a.disconnect(l,n)}};return!!js(o,[e,n],(t=>t[0]===e&&t[1]===n),!0)&&(a.add(l),Ds(t)?Us(s,t,[n,l],!0):Ws(r,[t,n,l],!0),!0)},rr=(t,e,n,i,s)=>{const[r,o]=((t,e,n,i)=>{const{activeInputs:s,passiveInputs:r}=Ls(e),o=Hs(s[i],t,n);if(null===o)return[xs(r,t,n,i)[2],!1];return[o[2],!0]})(t,n,i,s);if(null!==r&&($s(t,r),!o||e||Js(t)||Ys(Zs(t),Zs(n),i,s)),Ds(n)){const{activeInputs:t}=Ls(n);Ms(n,t)}},or=(t,e,n,i)=>{const[s,r]=((t,e,n)=>{const{activeInputs:i,passiveInputs:s}=Is(e),r=Hs(i,t,n);if(null===r)return[Xs(s,t,n)[1],!1];return[r[2],!0]})(t,n,i);null!==s&&($s(t,s),!r||e||Js(t)||Zs(t).disconnect(Qs(n),i))};class ar{get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach(((n,i)=>t.call(e,n,i,this)))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}constructor(t){this._map=new Map(t)}}const lr={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function cr(t,e,n,i,s){if("function"==typeof t.copyFromChannel)0===e[n].byteLength&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],i,s);else{const r=t.getChannelData(i);if(0===e[n].byteLength)e[n]=r.slice(s,s+128);else{const t=new Float32Array(r.buffer,s*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(t)}}}const ur=(t,e,n,i,s)=>{"function"==typeof t.copyToChannel?0!==e[n].byteLength&&t.copyToChannel(e[n],i,s):0!==e[n].byteLength&&t.getChannelData(i).set(e[n],s)},hr=(t,e)=>{const n=[];for(let i=0;i<t;i+=1){const t=[],s="number"==typeof e?e:e[i];for(let e=0;e<s;e+=1)t.push(new Float32Array(128));n.push(t)}return n},pr=async(t,e,n,i,s,r,o)=>{const a=null===e?128*Math.ceil(t.context.length/128):e.length,l=i.channelCount*i.numberOfInputs,c=s.reduce(((t,e)=>t+e),0),u=0===c?null:n.createBuffer(c,a,n.sampleRate);if(void 0===r)throw new Error("Missing the processor constructor.");const h=Ls(t),p=await((t,e)=>{const n=bs(ds,t),i=Zs(e);return bs(n,i)})(n,t),d=hr(i.numberOfInputs,i.channelCount),v=hr(i.numberOfOutputs,s),m=Array.from(t.parameters.keys()).reduce(((t,e)=>({...t,[e]:new Float32Array(128)})),{});for(let c=0;c<a;c+=128){if(i.numberOfInputs>0&&null!==e)for(let t=0;t<i.numberOfInputs;t+=1)for(let n=0;n<i.channelCount;n+=1)cr(e,d[t],n,n,c);void 0!==r.parameterDescriptors&&null!==e&&r.parameterDescriptors.forEach((({name:t},n)=>{cr(e,m,t,l+n,c)}));for(let t=0;t<i.numberOfInputs;t+=1)for(let e=0;e<s[t];e+=1)0===v[t][e].byteLength&&(v[t][e]=new Float32Array(128));try{const t=d.map(((t,e)=>0===h.activeInputs[e].size?[]:t)),e=o(c/n.sampleRate,n.sampleRate,(()=>p.process(t,v,m)));if(null!==u)for(let t=0,e=0;t<i.numberOfOutputs;t+=1){for(let n=0;n<s[t];n+=1)ur(u,v[t],n,e+n,c);e+=s[t]}if(!e)break}catch(e){t.dispatchEvent(new ErrorEvent("processorerror",{colno:e.colno,filename:e.filename,lineno:e.lineno,message:e.message}));break}}return u},dr={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},vr={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},mr={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},fr={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},_r={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},gr=t=>{const{port1:e,port2:n}=new MessageChannel;return new Promise((i=>{const s=()=>{n.onmessage=null,e.close(),n.close(),i()};n.onmessage=()=>s();try{e.postMessage(t,[t])}finally{s()}}))},br={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},wr=(t,e,n)=>{const i=e[n];if(void 0===i)throw t();return i},xr={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},yr={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Cr=()=>new DOMException("","InvalidStateError"),Er=()=>new DOMException("","InvalidAccessError"),Tr={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Mr=(t,e,n,i,s,r,o,a,l,c,u)=>{const h=c.length;let p=a;for(let a=0;a<h;a+=1){let h=n[0]*c[a];for(let e=1;e<s;e+=1){const i=p-e&l-1;h+=n[e]*r[i],h-=t[e]*o[i]}for(let t=s;t<i;t+=1)h+=n[t]*r[p-t&l-1];for(let n=s;n<e;n+=1)h-=t[n]*o[p-n&l-1];r[p]=c[a],o[p]=h,p=p+1&l-1,u[a]=h}return p},kr={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Pr=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,(()=>{}));return void 0!==n&&(n.catch((()=>{})),!0)}catch{}return!1},Ar={numberOfChannels:1},Sr=(t,e,n)=>{const i=e[n];void 0!==i&&i!==t[n]&&(t[n]=i)},Vr=(t,e)=>{Sr(t,e,"channelCount"),Sr(t,e,"channelCountMode"),Sr(t,e,"channelInterpretation")},Or=t=>"function"==typeof t.getFloatTimeDomainData,Dr=(t,e,n)=>{const i=e[n];void 0!==i&&i!==t[n].value&&(t[n].value=i)},Rr=t=>{var e;t.start=(e=t.start,(n=0,i=0,s)=>{if("number"==typeof s&&s<0||i<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,i,s)})},Lr=t=>{var e;t.stop=(e=t.stop,(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})},Ir=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),Nr=async(t,e)=>{const n=await(t=>new Promise(((e,n)=>{const{port1:i,port2:s}=new MessageChannel;i.onmessage=({data:t})=>{i.close(),s.close(),e(t)},i.onmessageerror=({data:t})=>{i.close(),s.close(),n(t)},s.postMessage(t)})))(e);return new t(n)},Fr=(t,e)=>{const n=t.createBiquadFilter();return Vr(n,e),Dr(n,e,"Q"),Dr(n,e,"detune"),Dr(n,e,"frequency"),Dr(n,e,"gain"),Sr(n,e,"type"),n},Br=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return Vr(n,e),(t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw Cr()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw Cr()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw Cr()}})})(n),n},qr=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),zr=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return Vr(n,e),Dr(n,e,"delayTime"),n},jr=(t,e)=>{const n=t.createGain();return Vr(n,e),Dr(n,e,"gain"),n};function Ur(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function Wr(t,e){let n=[0,0];for(let r=t.length-1;r>=0;r-=1)s=e,n=[(i=n)[0]*s[0]-i[1]*s[1],i[0]*s[1]+i[1]*s[0]],n[0]+=t[r];var i,s;return n}const Gr=(t,e,n,i)=>t.createScriptProcessor(e,n,i),Kr=()=>new DOMException("","NotSupportedError"),Hr={numberOfChannels:1},$r={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Xr={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Yr={disableNormalization:!1},Zr={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Qr=()=>new DOMException("","UnknownError"),Jr={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},to=(t,e,n)=>void 0===t.copyFromChannel?t.getChannelData(n)[0]:(t.copyFromChannel(e,n),e[0]),eo=t=>{if(null===t)return!1;const e=t.length;return e%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0},no=(t,e,n,i)=>{let s=t;for(;!s.hasOwnProperty(e);)s=Object.getPrototypeOf(s);const{get:r,set:o}=Object.getOwnPropertyDescriptor(s,e);Object.defineProperty(t,e,{get:n(r),set:i(o)})},io=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(i){if(9!==i.code)throw i;io(t,e,n+1e-7)}},so=t=>{const e=t.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},ro=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},oo=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},ao=(t,e)=>{const n=e.createGain();t.connect(n);const i=(s=t.disconnect,()=>{s.call(t,n),t.removeEventListener("ended",i)});var s;t.addEventListener("ended",i),qr(t,n),t.stop=(e=>{let i=!1;return(s=0)=>{if(i)try{e.call(t,s)}catch{n.gain.setValueAtTime(0,s)}else e.call(t,s),i=!0}})(t.stop)},lo=(t,e)=>n=>{const i={value:t};return Object.defineProperties(n,{currentTarget:i,target:i}),"function"==typeof e?e.call(t,n):e.handleEvent.call(t,n)},co=(uo=js,(t,e,[n,i,s],r)=>{uo(t[i],[e,n,s],(t=>t[0]===e&&t[1]===n),r)});var uo;const ho=(t=>(e,n,[i,s,r],o)=>{const a=e.get(i);void 0===a?e.set(i,new Set([[s,n,r]])):t(a,[s,n,r],(t=>t[0]===s&&t[1]===n),o)})(js),po=(vo=ws,(t,e,n,i)=>vo(t[i],(t=>t[0]===e&&t[1]===n)));var vo;const mo=new WeakMap,fo=(_o=mo,t=>{var e;return null!==(e=_o.get(t))&&void 0!==e?e:0});var _o;const go=(bo=new Map,wo=new WeakMap,(t,e)=>{const n=wo.get(t);if(void 0!==n)return n;const i=bo.get(t);if(void 0!==i)return i;try{const n=e();return n instanceof Promise?(bo.set(t,n),n.catch((()=>!1)).then((e=>(bo.delete(t),wo.set(t,e),e)))):(wo.set(t,n),n)}catch{return wo.set(t,!1),!1}});var bo,wo;const xo="undefined"==typeof window?null:window,yo=(Co=go,Eo=Ss,(t,e)=>{const n=t.createAnalyser();if(Vr(n,e),!(e.maxDecibels>e.minDecibels))throw Eo();return Sr(n,e,"fftSize"),Sr(n,e,"maxDecibels"),Sr(n,e,"minDecibels"),Sr(n,e,"smoothingTimeConstant"),Co(Or,(()=>Or(n)))||(t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const i=Math.max(n.length,t.fftSize);for(let t=0;t<i;t+=1)e[t]=.0078125*(n[t]-128);return e}})(n),n});var Co,Eo;const To=(Mo=Ls,t=>{const e=Mo(t);if(null===e.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return e.renderer});var Mo;const ko=((t,e,n)=>async(i,s,r)=>{const o=t(i);await Promise.all(o.activeInputs.map(((t,o)=>Array.from(t).map((async([t,a])=>{const l=e(t),c=await l.render(t,s),u=i.context.destination;n(t)||i===u&&n(i)||c.connect(r,a,o)})))).reduce(((t,e)=>[...t,...e]),[]))})(Ls,To,Js),Po=(Ao=yo,So=Zs,Vo=ko,()=>{const t=new WeakMap;return{render(e,n){const i=t.get(n);return void 0!==i?Promise.resolve(i):(async(e,n)=>{let i=So(e);if(!Ps(i,n)){const t={channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,fftSize:i.fftSize,maxDecibels:i.maxDecibels,minDecibels:i.minDecibels,smoothingTimeConstant:i.smoothingTimeConstant};i=Ao(n,t)}return t.set(n,i),await Vo(e,n,i),i})(e,n)}}});var Ao,So,Vo;const Oo=(Do=cs,t=>{const e=Do.get(t);if(void 0===e)throw Cr();return e});var Do;const Ro=(t=>null===t?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null)(xo),Lo=(Io=Ro,t=>null!==Io&&t instanceof Io);var Io;const No=new WeakMap,Fo=(Bo=lo,class{addEventListener(t,e,n){if(null!==e){let i=this._listeners.get(e);void 0===i&&(i=Bo(this,e),"function"==typeof e&&this._listeners.set(e,i)),this._nativeEventTarget.addEventListener(t,i,n)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){const i=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===i?null:i,n)}constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}});var Bo;const qo=(t=>null===t?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null)(xo),zo=(jo=qo,t=>null!==jo&&t instanceof jo);var jo;const Uo=(t=>e=>null!==t&&"function"==typeof t.AudioNode&&e instanceof t.AudioNode)(xo),Wo=(t=>e=>null!==t&&"function"==typeof t.AudioParam&&e instanceof t.AudioParam)(xo),Go=(t=>null===t?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null)(xo),Ko=((t,e,n,i,s,r,o,a,l,c,u,h,p,d,v,m)=>class extends c{get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t,n=0,a=0){if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw s();const c=u(this._context),h=v(c);if(p(t)||d(t))throw r();if(qs(t)){const s=Zs(t);try{const e=Ks(this._nativeAudioNode,s,n,a),i=tr(this);(h||i)&&this._nativeAudioNode.disconnect(...e),"closed"!==this.context.state&&!i&&tr(t)&&Cs(t)}catch(t){if(12===t.code)throw r();throw t}if(e(this,t,n,a,h)){const e=l([this],t);nr(e,i(h))}return t}const m=Qs(t);if("playbackRate"===m.name&&1024===m.maxValue)throw o();try{this._nativeAudioNode.connect(m,n),(h||tr(this))&&this._nativeAudioNode.disconnect(m,n)}catch(t){if(12===t.code)throw r();throw t}if(sr(this,t,n,h)){const e=l([this],t);nr(e,i(h))}}disconnect(t,e,n){let i;const o=u(this._context),c=v(o);if(void 0===t)i=((t,e)=>{const n=Ls(t),i=[];for(const s of n.outputs)zs(s)?rr(t,e,...s):or(t,e,...s),i.push(s[0]);return n.outputs.clear(),i})(this,c);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw s();i=((t,e,n)=>{const i=Ls(t),s=[];for(const r of i.outputs)r[1]===n&&(zs(r)?rr(t,e,...r):or(t,e,...r),s.push(r[0]),i.outputs.delete(r));return s})(this,c,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs))throw s();if(qs(t)&&void 0!==n&&(n<0||n>=t.numberOfInputs))throw s();if(i=((t,e,n,i,s)=>{const r=Ls(t);return Array.from(r.outputs).filter((t=>!(t[0]!==n||void 0!==i&&t[1]!==i||void 0!==s&&t[2]!==s))).map((n=>(zs(n)?rr(t,e,...n):or(t,e,...n),r.outputs.delete(n),n[0])))})(this,c,t,e,n),0===i.length)throw r()}for(const t of i){const e=l([this],t);nr(e,a)}}constructor(e,i,s,r){super(s),this._context=e,this._nativeAudioNode=s;const o=u(e);h(o)&&!0!==n(er,(()=>er(o,m)))&&(t=>{const e=new Map;var n,i;t.connect=(n=t.connect.bind(t),(t,i=0,s=0)=>{const r=ir(t)?n(t,i,s):n(t,i),o=e.get(t);return void 0===o?e.set(t,[{input:s,output:i}]):o.every((t=>t.input!==s||t.output!==i))&&o.push({input:s,output:i}),r}),t.disconnect=(i=t.disconnect,(n,s,r)=>{if(i.apply(t),void 0===n)e.clear();else if("number"==typeof n)for(const[t,i]of e){const s=i.filter((t=>t.output!==n));0===s.length?e.delete(t):e.set(t,s)}else if(e.has(n))if(void 0===s)e.delete(n);else{const t=e.get(n);if(void 0!==t){const i=t.filter((t=>t.output!==s&&(t.input!==r||void 0===r)));0===i.length?e.delete(n):e.set(n,i)}}for(const[n,i]of e)i.forEach((e=>{ir(n)?t.connect(n,e.output,e.input):t.connect(n,e.output)}))})})(s),os.set(this,s),us.set(this,new Set),"closed"!==e.state&&i&&Cs(this),t(this,r,s)}})((Ho=rs,(t,e,n)=>{const i=[];for(let t=0;t<n.numberOfInputs;t+=1)i.push(new Set);Ho.set(t,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:e})}),((t,e,n,i,s,r,o,a,l,c,u,h,p)=>{const d=new WeakMap;return(v,m,f,_,g)=>{const{activeInputs:b,passiveInputs:w}=r(m),{outputs:x}=r(v),y=a(v),C=r=>{const a=l(m),c=l(v);if(r){const e=xs(w,v,f,_);t(b,v,e,!1),g||h(v)||n(c,a,f,_),p(m)&&Cs(m)}else{const t=i(b,v,f,_);e(w,_,t,!1),g||h(v)||s(c,a,f,_);const n=o(m);if(0===n)u(m)&&Ms(m,b);else{const t=d.get(m);void 0!==t&&clearTimeout(t),d.set(m,setTimeout((()=>{u(m)&&Ms(m,b)}),1e3*n))}}};return!!c(x,[m,f,_],(t=>t[0]===m&&t[1]===f&&t[2]===_),!0)&&(y.add(C),u(v)?t(b,v,[f,_,C],!0):e(w,_,[v,f,C],!0),!0)}})(co,ho,Ks,po,Ys,Ls,fo,ys,Zs,js,Ds,Js,tr),go,((t,e,n,i,s,r)=>o=>(a,l)=>{const c=t.get(a);if(void 0===c){if(!o&&r(a)){const t=i(a),{outputs:r}=n(a);for(const n of r)if(zs(n)){const s=i(n[0]);e(t,s,n[1],n[2])}else{const e=s(n[0]);t.disconnect(e,n[1])}}t.set(a,l)}else t.set(a,c+l)})(hs,Ys,Ls,Zs,Qs,Ds),Ss,Er,Kr,((t,e,n,i,s,r,o,a)=>(l,c)=>{const u=e.get(l);if(void 0===u)throw new Error("Missing the expected cycle count.");const h=r(l.context),p=a(h);if(u===c){if(e.delete(l),!p&&o(l)){const e=i(l),{outputs:r}=n(l);for(const n of r)if(zs(n)){const s=i(n[0]);t(e,s,n[1],n[2])}else{const t=s(n[0]);e.connect(t,n[1])}}}else e.set(l,u-c)})(Ks,hs,Ls,Zs,Qs,Oo,Ds,Lo),((t,e,n)=>function i(s,r){const o=qs(r)?r:n(t,r);if((t=>"delayTime"in t)(o))return[];if(s[0]===o)return[s];if(s.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map((t=>i([...s,o],t[0]))).reduce(((t,e)=>t.concat(e)),[])})(No,Ls,bs),Fo,Oo,zo,Uo,Wo,Lo,Go);var Ho;const $o=((t,e,n,i,s,r)=>class extends t{get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}constructor(t,n){const o=s(t),a={...ks,...n},l=i(o,a);super(t,!1,l,r(o)?e():null),this._nativeAnalyserNode=l}})(Ko,Po,Ss,yo,Oo,Lo),Xo=new WeakSet,Yo=(t=>null===t?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null)(xo),Zo=(Qo=new Uint32Array(1),t=>(Qo[0]=t,Qo[0]));var Qo;const Jo=((t,e)=>n=>{n.copyFromChannel=(i,s,r=0)=>{const o=t(r),a=t(s);if(a>=n.numberOfChannels)throw e();const l=n.length,c=n.getChannelData(a),u=i.length;for(let t=o<0?-o:0;t+o<l&&t<u;t+=1)i[t]=c[t+o]},n.copyToChannel=(i,s,r=0)=>{const o=t(r),a=t(s);if(a>=n.numberOfChannels)throw e();const l=n.length,c=n.getChannelData(a),u=i.length;for(let t=o<0?-o:0;t+o<l&&t<u;t+=1)c[t+o]=i[t]}})(Zo,Ss),ta=(ea=Zo,t=>{var e,n;t.copyFromChannel=(e=t.copyFromChannel,(n,i,s=0)=>{const r=ea(s),o=ea(i);if(r<t.length)return e.call(t,n,o,r)}),t.copyToChannel=(n=t.copyToChannel,(e,i,s=0)=>{const r=ea(s),o=ea(i);if(r<t.length)return n.call(t,e,o,r)})});var ea;const na=((t,e,n,i,s,r,o,a)=>{let l,c=null;return l=Symbol.hasInstance,class u{static[l](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===u.prototype||t.has(e)}constructor(l){if(null===s)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:u,numberOfChannels:h,sampleRate:p}={...Os,...l};null===c&&(c=new s(1,1,44100));const d=null!==i&&e(r,r)?new i({length:u,numberOfChannels:h,sampleRate:p}):c.createBuffer(h,u,p);if(0===d.numberOfChannels)throw n();return"function"!=typeof d.copyFromChannel?(o(d),Vs(d)):e(As,(()=>As(d)))||a(d),t.add(d),d}}})(Xo,go,Kr,Yo,Ro,(ia=Yo,()=>{if(null===ia)return!1;try{new ia({length:1,sampleRate:44100})}catch{return!1}return!0}),Jo,ta);var ia;const sa=(ra=jr,(t,e)=>{const n=ra(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(n).connect(t.destination);const i=()=>{e.removeEventListener("ended",i),e.disconnect(n),n.disconnect()};e.addEventListener("ended",i)});var ra;const oa=(aa=To,la=Is,ca=Js,async(t,e,n)=>{const i=la(t);await Promise.all(Array.from(i.activeInputs).map((async([t,i])=>{const s=aa(t),r=await s.render(t,e);ca(t)||r.connect(n,i)})))});var aa,la,ca;const ua=(ha=oa,(t,e,n)=>ha(e,t,n));var ha;const pa=((t,e,n,i,s,r,o,a,l,c,u)=>(h,p)=>{const d=h.createBufferSource();return Vr(d,p),Dr(d,p,"playbackRate"),Sr(d,p,"buffer"),Sr(d,p,"loop"),Sr(d,p,"loopEnd"),Sr(d,p,"loopStart"),e(n,(()=>n(h)))||(t=>{t.start=(e=>{let n=!1;return(i=0,s=0,r)=>{if(n)throw Cr();e.call(t,i,s,r),n=!0}})(t.start)})(d),e(i,(()=>i(h)))||l(d),e(s,(()=>s(h)))||c(d,h),e(r,(()=>r(h)))||Rr(d),e(o,(()=>o(h)))||u(d,h),e(a,(()=>a(h)))||Lr(d),t(h,d),d})(sa,go,(t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1}),(t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0}),(t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0}),so,ro,oo,(t=>{var e;t.start=(e=t.start,(n=0,i=0,s)=>{const r=t.buffer,o=null===r?i:Math.min(r.duration,i);null!==r&&o>r.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,s)})}),(da=no,(t,e)=>{const n=e.createBuffer(1,1,44100);null===t.buffer&&(t.buffer=n),da(t,"buffer",(e=>()=>{const i=e.call(t);return i===n?null:i}),(e=>i=>e.call(t,null===i?n:i)))}),ao);var da;const va=((t,e)=>(n,i,s)=>(t(i).replay(s),e(i,n,s)))((t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer})(Is),oa),ma=((t,e,n,i,s)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(l,c){const u=r.get(c);return void 0!==u?Promise.resolve(u):(async(l,c)=>{let u=n(l);const h=Ps(u,c);if(!h){const t={buffer:u.buffer,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,loop:u.loop,loopEnd:u.loopEnd,loopStart:u.loopStart,playbackRate:u.playbackRate.value};u=e(c,t),null!==o&&u.start(...o),null!==a&&u.stop(a)}return r.set(c,u),h?await t(c,l.playbackRate,u.playbackRate):await i(c,l.playbackRate,u.playbackRate),await s(l,c,u),u})(l,c)}}})(ua,pa,Zs,va,ko),fa=((t,e,n,i,s,r,o,a,l,c,u,h,p)=>(d,v,m,f=null,_=null)=>{const g=new is.AutomationEventList(m.defaultValue),b=v?i(g):null,w={get defaultValue(){return m.defaultValue},get maxValue(){return null===f?m.maxValue:f},get minValue(){return null===_?m.minValue:_},get value(){return m.value},set value(t){m.value=t,w.setValueAtTime(t,d.context.currentTime)},cancelAndHoldAtTime(t){if("function"==typeof m.cancelAndHoldAtTime)null===b&&g.flush(d.context.currentTime),g.add(s(t)),m.cancelAndHoldAtTime(t);else{const e=Array.from(g).pop();null===b&&g.flush(d.context.currentTime),g.add(s(t));const n=Array.from(g).pop();m.cancelScheduledValues(t),e!==n&&void 0!==n&&("exponentialRampToValue"===n.type?m.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?m.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?m.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&m.setValueCurveAtTime(n.values,n.startTime,n.duration))}return w},cancelScheduledValues:t=>(null===b&&g.flush(d.context.currentTime),g.add(r(t)),m.cancelScheduledValues(t),w),exponentialRampToValueAtTime(t,e){if(0===t)throw new RangeError;if(!Number.isFinite(e)||e<0)throw new RangeError;return null===b&&g.flush(d.context.currentTime),g.add(o(t,e)),m.exponentialRampToValueAtTime(t,e),w},linearRampToValueAtTime:(t,e)=>(null===b&&g.flush(d.context.currentTime),g.add(a(t,e)),m.linearRampToValueAtTime(t,e),w),setTargetAtTime:(t,e,n)=>(null===b&&g.flush(d.context.currentTime),g.add(l(t,e,n)),m.setTargetAtTime(t,e,n),w),setValueAtTime:(t,e)=>(null===b&&g.flush(d.context.currentTime),g.add(c(t,e)),m.setValueAtTime(t,e),w),setValueCurveAtTime(t,e,n){const i=t instanceof Float32Array?t:new Float32Array(t);if(null!==h&&"webkitAudioContext"===h.name){const t=e+n,s=d.context.sampleRate,r=Math.ceil(e*s),o=Math.floor(t*s),a=o-r,l=new Float32Array(a);for(let t=0;t<a;t+=1){const o=(i.length-1)/n*((r+t)/s-e),a=Math.floor(o),c=Math.ceil(o);l[t]=a===c?i[a]:(1-(o-a))*i[a]+(1-(c-o))*i[c]}null===b&&g.flush(d.context.currentTime),g.add(u(l,e,n)),m.setValueCurveAtTime(l,e,n);const c=o/s;c<t&&p(w,l[l.length-1],c),p(w,i[i.length-1],t)}else null===b&&g.flush(d.context.currentTime),g.add(u(i,e,n)),m.setValueCurveAtTime(i,e,n);return w}};return n.set(w,m),e.set(w,d),t(w,b),w})((_a=as,(t,e)=>{_a.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})}),No,ls,(t=>({replay(e){for(const n of t)if("exponentialRampToValue"===n.type){const{endTime:t,value:i}=n;e.exponentialRampToValueAtTime(i,t)}else if("linearRampToValue"===n.type){const{endTime:t,value:i}=n;e.linearRampToValueAtTime(i,t)}else if("setTarget"===n.type){const{startTime:t,target:i,timeConstant:s}=n;e.setTargetAtTime(i,t,s)}else if("setValue"===n.type){const{startTime:t,value:i}=n;e.setValueAtTime(i,t)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:t,startTime:i,values:s}=n;e.setValueCurveAtTime(s,i,t)}}}})),is.createCancelAndHoldAutomationEvent,is.createCancelScheduledValuesAutomationEvent,is.createExponentialRampToValueAutomationEvent,is.createLinearRampToValueAutomationEvent,is.createSetTargetAutomationEvent,is.createSetValueAutomationEvent,is.createSetValueCurveAutomationEvent,qo,io);var _a;const ga=((t,e,n,i,s,r,o,a)=>class extends t{get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw i();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===e?t:n}get playbackRate(){return this._playbackRate}start(t=0,e=0,n){if(this._nativeAudioBufferSourceNode.start(t,e,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[t,e]:[t,e,n]),"closed"!==this.context.state){Cs(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),Ds(this)&&Ts(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}constructor(t,i){const a=r(t),l={...Rs,...i},c=s(a,l),u=o(a),h=u?e():null;super(t,!1,c,h),this._audioBufferSourceNodeRenderer=h,this._isBufferNullified=!1,this._isBufferSet=null!==l.buffer,this._nativeAudioBufferSourceNode=c,this._onended=null,this._playbackRate=n(this,u,c.playbackRate,34028234663852886e22,-34028234663852886e22)}})(Ko,ma,fa,Cr,pa,Oo,Lo,lo),ba=((t,e,n,i,s,r,o,a)=>class extends t{get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw i();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw i();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}constructor(t,n){const i=r(t),l=o(i),c=s(i,n,l);super(t,!1,c,l?e(a):null),this._isNodeOfNativeOfflineAudioContext=l,this._nativeAudioDestinationNode=c}})(Ko,(t=>{const e=new WeakMap;return{render(n,i){const s=e.get(i);return void 0!==s?Promise.resolve(s):(async(n,i)=>{const s=i.destination;return e.set(i,s),await t(n,i,s),s})(n,i)}}}),Ss,Cr,((t,e)=>(n,i,s)=>{const r=n.destination;if(r.channelCount!==i)try{r.channelCount=i}catch{}s&&"explicit"!==r.channelCountMode&&(r.channelCountMode="explicit"),0===r.maxChannelCount&&Object.defineProperty(r,"maxChannelCount",{value:i});const o=t(n,{channelCount:i,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e);try{r.channelCount=e}catch(t){if(e>r.maxChannelCount)throw t}})),e(o,"channelCountMode",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelCountMode=e})),e(o,"channelInterpretation",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelInterpretation=e})),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o})(jr,no),Oo,Lo,ko),wa=((t,e,n,i,s)=>()=>{const r=new WeakMap;return{render(o,a){const l=r.get(a);return void 0!==l?Promise.resolve(l):(async(o,a)=>{let l=n(o);const c=Ps(l,a);if(!c){const t={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(a,t)}return r.set(a,l),c?(await t(a,o.Q,l.Q),await t(a,o.detune,l.detune),await t(a,o.frequency,l.frequency),await t(a,o.gain,l.gain)):(await i(a,o.Q,l.Q),await i(a,o.detune,l.detune),await i(a,o.frequency,l.frequency),await i(a,o.gain,l.gain)),await s(o,a,l),l})(o,a)}}})(ua,Fr,Zs,va,ko),xa=(t=>(e,n)=>t.set(e,n))(mo),ya=(Ca=Ko,Ea=fa,Ta=wa,Ma=Er,ka=Fr,Pa=Oo,Aa=Lo,Sa=xa,class extends Ca{get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(t,e,n)}catch(t){if(11===t.code)throw Ma();throw t}if(t.length!==e.length||e.length!==n.length)throw Ma()}constructor(t,e){const n=Pa(t),i={...dr,...e},s=ka(n,i),r=Aa(n);super(t,!1,s,r?Ta():null),this._Q=Ea(this,r,s.Q,34028234663852886e22,-34028234663852886e22),this._detune=Ea(this,r,s.detune,1200*Math.log2(34028234663852886e22),-1200*Math.log2(34028234663852886e22)),this._frequency=Ea(this,r,s.frequency,t.sampleRate/2,0),this._gain=Ea(this,r,s.gain,40*Math.log10(34028234663852886e22),-34028234663852886e22),this._nativeBiquadFilterNode=s,Sa(this,1)}});var Ca,Ea,Ta,Ma,ka,Pa,Aa,Sa;const Va=((t,e)=>(n,i,s)=>{const r=new Set;var o,a;return n.connect=(o=n.connect,(s,a=0,l=0)=>{const c=0===r.size;if(e(s))return o.call(n,s,a,l),t(r,[s,a,l],(t=>t[0]===s&&t[1]===a&&t[2]===l),!0),c&&i(),s;o.call(n,s,a),t(r,[s,a],(t=>t[0]===s&&t[1]===a),!0),c&&i()}),n.disconnect=(a=n.disconnect,(t,i,o)=>{const l=r.size>0;if(void 0===t)a.apply(n),r.clear();else if("number"==typeof t){a.call(n,t);for(const e of r)e[1]===t&&r.delete(e)}else{e(t)?a.call(n,t,i,o):a.call(n,t,i);for(const e of r)e[0]!==t||void 0!==i&&e[1]!==i||void 0!==o&&e[2]!==o||r.delete(e)}const c=0===r.size;l&&c&&s()}),n})(js,Uo),Oa=(Da=Cr,Ra=Va,(t,e)=>{e.channelCount=1,e.channelCountMode="explicit",Object.defineProperty(e,"channelCount",{get:()=>1,set:()=>{throw Da()}}),Object.defineProperty(e,"channelCountMode",{get:()=>"explicit",set:()=>{throw Da()}});const n=t.createBufferSource();Ra(e,(()=>{const t=e.numberOfInputs;for(let i=0;i<t;i+=1)n.connect(e,0,i)}),(()=>n.disconnect(e)))});var Da,Ra;const La=((t,e)=>(n,i)=>{const s=n.createChannelMerger(i.numberOfInputs);return null!==t&&"webkitAudioContext"===t.name&&e(n,s),Vr(s,i),s})(qo,Oa),Ia=((t,e,n)=>()=>{const i=new WeakMap;return{render(s,r){const o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=e(s);if(!Ps(o,r)){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfInputs:o.numberOfInputs};o=t(r,e)}return i.set(r,o),await n(s,r,o),o})(s,r)}}})(La,Zs,ko),Na=((t,e,n,i,s)=>class extends t{constructor(t,r){const o=i(t),a={...vr,...r};super(t,!1,n(o,a),s(o)?e():null)}})(Ko,Ia,La,Oo,Lo),Fa=((t,e,n)=>()=>{const i=new WeakMap;return{render(s,r){const o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=e(s);if(!Ps(o,r)){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfOutputs:o.numberOfOutputs};o=t(r,e)}return i.set(r,o),await n(s,r,o),o})(s,r)}}})(Br,Zs,ko),Ba=((t,e,n,i,s,r)=>class extends t{constructor(t,o){const a=i(t),l=r({...mr,...o});super(t,!1,n(a,l),s(a)?e():null)}})(Ko,Fa,Br,Oo,Lo,(t=>({...t,channelCount:t.numberOfOutputs}))),qa=((t,e,n,i)=>(s,{offset:r,...o})=>{const a=s.createBuffer(1,2,44100),l=e(s,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),c=n(s,{...o,gain:r}),u=a.getChannelData(0);u[0]=1,u[1]=1,l.buffer=a,l.loop=!0;const h={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(t){c.channelCount=t},get channelCountMode(){return c.channelCountMode},set channelCountMode(t){c.channelCountMode=t},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(t){c.channelInterpretation=t},get context(){return c.context},get inputs(){return[]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get offset(){return c.gain},get onended(){return l.onended},set onended(t){l.onended=t},addEventListener:(...t)=>l.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>l.dispatchEvent(t[0]),removeEventListener:(...t)=>l.removeEventListener(t[0],t[1],t[2]),start(t=0){l.start.call(l,t)},stop(t=0){l.stop.call(l,t)}};return t(s,l),i(qr(h,c),(()=>l.connect(c)),(()=>l.disconnect(c)))})(sa,pa,jr,Va),za=((t,e,n,i,s)=>(r,o)=>{if(void 0===r.createConstantSource)return n(r,o);const a=r.createConstantSource();return Vr(a,o),Dr(a,o,"offset"),e(i,(()=>i(r)))||Rr(a),e(s,(()=>s(r)))||Lr(a),t(r,a),a})(sa,go,qa,so,oo),ja=((t,e,n,i,s)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(l,c){const u=r.get(c);return void 0!==u?Promise.resolve(u):(async(l,c)=>{let u=n(l);const h=Ps(u,c);if(!h){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,offset:u.offset.value};u=e(c,t),null!==o&&u.start(o),null!==a&&u.stop(a)}return r.set(c,u),h?await t(c,l.offset,u.offset):await i(c,l.offset,u.offset),await s(l,c,u),u})(l,c)}}})(ua,za,Zs,va,ko),Ua=((t,e,n,i,s,r,o)=>class extends t{get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeConstantSourceNode.onended=e;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===e?t:n}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){Cs(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),Ds(this)&&Ts(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}constructor(t,o){const a=s(t),l={...fr,...o},c=i(a,l),u=r(a),h=u?n():null;super(t,!1,c,h),this._constantSourceNodeRenderer=h,this._nativeConstantSourceNode=c,this._offset=e(this,u,c.offset,34028234663852886e22,-34028234663852886e22),this._onended=null}})(Ko,fa,ja,za,Oo,Lo,lo),Wa=((t,e)=>(n,i)=>{const s=n.createConvolver();if(Vr(s,i),i.disableNormalization===s.normalize&&(s.normalize=!i.disableNormalization),Sr(s,i,"buffer"),i.channelCount>2)throw t();if(e(s,"channelCount",(t=>()=>t.call(s)),(e=>n=>{if(n>2)throw t();return e.call(s,n)})),"max"===i.channelCountMode)throw t();return e(s,"channelCountMode",(t=>()=>t.call(s)),(e=>n=>{if("max"===n)throw t();return e.call(s,n)})),s})(Kr,no),Ga=((t,e,n)=>()=>{const i=new WeakMap;return{render(s,r){const o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=e(s);if(!Ps(o,r)){const e={buffer:o.buffer,channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,disableNormalization:!o.normalize};o=t(r,e)}return i.set(r,o),Gs(o)?await n(s,r,o.inputs[0]):await n(s,r,o),o})(s,r)}}})(Wa,Zs,ko),Ka=((t,e,n,i,s,r)=>class extends t{get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer){const t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,44100),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}constructor(t,o){const a=i(t),l={..._r,...o},c=n(a,l);super(t,!1,c,s(a)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=c,null!==l.buffer&&r(this,l.buffer.duration)}})(Ko,Ga,Wa,Oo,Lo,xa),Ha=((t,e,n,i,s)=>r=>{const o=new WeakMap;return{render(a,l){const c=o.get(l);return void 0!==c?Promise.resolve(c):(async(a,l)=>{let c=n(a);const u=Ps(c,l);if(!u){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,delayTime:c.delayTime.value,maxDelayTime:r};c=e(l,t)}return o.set(l,c),u?await t(l,a.delayTime,c.delayTime):await i(l,a.delayTime,c.delayTime),await s(a,l,c),c})(a,l)}}})(ua,zr,Zs,va,ko),$a=((t,e,n,i,s,r,o)=>class extends t{get delayTime(){return this._delayTime}constructor(t,a){const l=s(t),c={...br,...a},u=i(l,c),h=r(l);super(t,!1,u,h?n(c.maxDelayTime):null),this._delayTime=e(this,h,u.delayTime),o(this,c.maxDelayTime)}})(Ko,fa,Ha,zr,Oo,Lo,xa),Xa=(Ya=Kr,(t,e)=>{const n=t.createDynamicsCompressor();if(Vr(n,e),e.channelCount>2)throw Ya();if("max"===e.channelCountMode)throw Ya();return Dr(n,e,"attack"),Dr(n,e,"knee"),Dr(n,e,"ratio"),Dr(n,e,"release"),Dr(n,e,"threshold"),n});var Ya;const Za=((t,e,n,i,s)=>()=>{const r=new WeakMap;return{render(o,a){const l=r.get(a);return void 0!==l?Promise.resolve(l):(async(o,a)=>{let l=n(o);const c=Ps(l,a);if(!c){const t={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(a,t)}return r.set(a,l),c?(await t(a,o.attack,l.attack),await t(a,o.knee,l.knee),await t(a,o.ratio,l.ratio),await t(a,o.release,l.release),await t(a,o.threshold,l.threshold)):(await i(a,o.attack,l.attack),await i(a,o.knee,l.knee),await i(a,o.ratio,l.ratio),await i(a,o.release,l.release),await i(a,o.threshold,l.threshold)),await s(o,a,l),l})(o,a)}}})(ua,Xa,Zs,va,ko),Qa=((t,e,n,i,s,r,o,a)=>class extends t{get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){const e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,s()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){const e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,s()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}constructor(t,s){const l=r(t),c={...xr,...s},u=i(l,c),h=o(l);super(t,!1,u,h?n():null),this._attack=e(this,h,u.attack),this._knee=e(this,h,u.knee),this._nativeDynamicsCompressorNode=u,this._ratio=e(this,h,u.ratio),this._release=e(this,h,u.release),this._threshold=e(this,h,u.threshold),a(this,.006)}})(Ko,fa,Za,Xa,Kr,Oo,Lo,xa),Ja=((t,e,n,i,s)=>()=>{const r=new WeakMap;return{render(o,a){const l=r.get(a);return void 0!==l?Promise.resolve(l):(async(o,a)=>{let l=n(o);const c=Ps(l,a);if(!c){const t={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(a,t)}return r.set(a,l),c?await t(a,o.gain,l.gain):await i(a,o.gain,l.gain),await s(o,a,l),l})(o,a)}}})(ua,jr,Zs,va,ko),tl=((t,e,n,i,s,r)=>class extends t{get gain(){return this._gain}constructor(t,o){const a=s(t),l={...yr,...o},c=i(a,l),u=r(a);super(t,!1,c,u?n():null),this._gain=e(this,u,c.gain,34028234663852886e22,-34028234663852886e22)}})(Ko,fa,Ja,jr,Oo,Lo),el=((t,e,n,i)=>(s,r,{channelCount:o,channelCountMode:a,channelInterpretation:l,feedback:c,feedforward:u})=>{const h=Ir(r,s.sampleRate),p=c instanceof Float64Array?c:new Float64Array(c),d=u instanceof Float64Array?u:new Float64Array(u),v=p.length,m=d.length,f=Math.min(v,m);if(0===v||v>20)throw i();if(0===p[0])throw e();if(0===m||m>20)throw i();if(0===d[0])throw e();if(1!==p[0]){for(let t=0;t<m;t+=1)d[t]/=p[0];for(let t=1;t<v;t+=1)p[t]/=p[0]}const _=n(s,h,o,o);_.channelCount=o,_.channelCountMode=a,_.channelInterpretation=l;const g=[],b=[],w=[];for(let t=0;t<o;t+=1){g.push(0);const t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),b.push(t),w.push(e)}_.onaudioprocess=t=>{const e=t.inputBuffer,n=t.outputBuffer,i=e.numberOfChannels;for(let t=0;t<i;t+=1){const i=e.getChannelData(t),s=n.getChannelData(t);g[t]=Mr(p,v,d,m,f,b[t],w[t],g[t],32,i,s)}};const x=s.sampleRate/2;return qr({get bufferSize(){return h},get channelCount(){return _.channelCount},set channelCount(t){_.channelCount=t},get channelCountMode(){return _.channelCountMode},set channelCountMode(t){_.channelCountMode=t},get channelInterpretation(){return _.channelInterpretation},set channelInterpretation(t){_.channelInterpretation=t},get context(){return _.context},get inputs(){return[_]},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},addEventListener:(...t)=>_.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>_.dispatchEvent(t[0]),getFrequencyResponse(e,n,i){if(e.length!==n.length||n.length!==i.length)throw t();const s=e.length;for(let t=0;t<s;t+=1){const s=-Math.PI*(e[t]/x),r=[Math.cos(s),Math.sin(s)],o=Ur(Wr(d,r),Wr(p,r));n[t]=Math.sqrt(o[0]*o[0]+o[1]*o[1]),i[t]=Math.atan2(o[1],o[0])}},removeEventListener:(...t)=>_.removeEventListener(t[0],t[1],t[2])},_)})(Er,Cr,Gr,Kr),nl=((t,e,n,i)=>s=>t(Pr,(()=>Pr(s)))?Promise.resolve(t(i,i)).then((t=>{if(!t){const t=n(s,512,0,1);s.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>s.currentTime,t.connect(s.destination)}return s.startRendering()})):new Promise((t=>{const n=e(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});s.oncomplete=e=>{n.disconnect(),t(e.renderedBuffer)},n.connect(s.destination),s.startRendering()})))(go,jr,Gr,((t,e)=>()=>{if(null===e)return Promise.resolve(!1);const n=new e(1,1,44100),i=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((t=>{n.oncomplete=()=>{i.disconnect(),t(0!==n.currentTime)},n.startRendering()}))})(jr,Ro)),il=((t,e,n,i,s)=>(r,o)=>{const a=new WeakMap;let l=null;const c=async(c,u)=>{let h=null,p=e(c);const d=Ps(p,u);if(void 0===u.createIIRFilter?h=t(u,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):d||(p=u.createIIRFilter(o,r)),a.set(u,null===h?p:h),null!==h){if(null===l){if(null===n)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new n(c.context.destination.channelCount,c.context.length,u.sampleRate);l=(async()=>{await i(c,t,t.destination);return((t,e,n,i)=>{const s=n instanceof Float64Array?n:new Float64Array(n),r=i instanceof Float64Array?i:new Float64Array(i),o=s.length,a=r.length,l=Math.min(o,a);if(1!==s[0]){for(let t=0;t<o;t+=1)r[t]/=s[0];for(let t=1;t<a;t+=1)s[t]/=s[0]}const c=new Float32Array(32),u=new Float32Array(32),h=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),p=t.numberOfChannels;for(let e=0;e<p;e+=1){const n=t.getChannelData(e),i=h.getChannelData(e);c.fill(0),u.fill(0),Mr(s,o,r,a,l,c,u,0,32,n,i)}return h})(await s(t),u,r,o)})()}const t=await l;return h.buffer=t,h.start(0),h}return await i(c,u,p),p};return{render(t,e){const n=a.get(e);return void 0!==n?Promise.resolve(n):c(t,e)}}})(pa,Zs,Ro,ko,nl);var sl;const rl=((t,e,n,i,s,r)=>class extends t{getFrequencyResponse(t,e,n){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,n)}constructor(t,o){const a=i(t),l=s(a),c={...Tr,...o},u=e(a,l?null:t.baseLatency,c);super(t,!1,u,l?n(c.feedback,c.feedforward):null),(t=>{var e;t.getFrequencyResponse=(e=t.getFrequencyResponse,(n,i,s)=>{if(n.length!==i.length||i.length!==s.length)throw Er();return e.call(t,n,i,s)})})(u),this._nativeIIRFilterNode=u,r(this,1)}})(Ko,(sl=el,(t,e,n)=>{if(void 0===t.createIIRFilter)return sl(t,e,n);const i=t.createIIRFilter(n.feedforward,n.feedback);return Vr(i,n),i}),il,Oo,Lo,xa),ol=((t,e,n,i,s,r,o,a)=>(l,c)=>{const u=c.listener,{forwardX:h,forwardY:p,forwardZ:d,positionX:v,positionY:m,positionZ:f,upX:_,upY:g,upZ:b}=void 0===u.forwardX?(()=>{const h=new Float32Array(1),p=e(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),d=o(c);let v=!1,m=[0,0,-1,0,1,0],f=[0,0,0];const _=()=>{if(v)return;v=!0;const t=i(c,256,9,0);t.onaudioprocess=({inputBuffer:t})=>{const e=[r(t,h,0),r(t,h,1),r(t,h,2),r(t,h,3),r(t,h,4),r(t,h,5)];e.some(((t,e)=>t!==m[e]))&&(u.setOrientation(...e),m=e);const n=[r(t,h,6),r(t,h,7),r(t,h,8)];n.some(((t,e)=>t!==f[e]))&&(u.setPosition(...n),f=n)},p.connect(t)},g=t=>e=>{e!==m[t]&&(m[t]=e,u.setOrientation(...m))},b=t=>e=>{e!==f[t]&&(f[t]=e,u.setPosition(...f))},w=(e,i,r)=>{const o=n(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:i});o.connect(p,0,e),o.start(),Object.defineProperty(o.offset,"defaultValue",{get:()=>i});const u=t({context:l},d,o.offset,34028234663852886e22,-34028234663852886e22);var h,v,m,f,g,b,w;return a(u,"value",(t=>()=>t.call(u)),(t=>e=>{try{t.call(u,e)}catch(t){if(9!==t.code)throw t}_(),d&&r(e)})),u.cancelAndHoldAtTime=(h=u.cancelAndHoldAtTime,d?()=>{throw s()}:(...t)=>{const e=h.apply(u,t);return _(),e}),u.cancelScheduledValues=(v=u.cancelScheduledValues,d?()=>{throw s()}:(...t)=>{const e=v.apply(u,t);return _(),e}),u.exponentialRampToValueAtTime=(m=u.exponentialRampToValueAtTime,d?()=>{throw s()}:(...t)=>{const e=m.apply(u,t);return _(),e}),u.linearRampToValueAtTime=(f=u.linearRampToValueAtTime,d?()=>{throw s()}:(...t)=>{const e=f.apply(u,t);return _(),e}),u.setTargetAtTime=(g=u.setTargetAtTime,d?()=>{throw s()}:(...t)=>{const e=g.apply(u,t);return _(),e}),u.setValueAtTime=(b=u.setValueAtTime,d?()=>{throw s()}:(...t)=>{const e=b.apply(u,t);return _(),e}),u.setValueCurveAtTime=(w=u.setValueCurveAtTime,d?()=>{throw s()}:(...t)=>{const e=w.apply(u,t);return _(),e}),u};return{forwardX:w(0,0,g(0)),forwardY:w(1,0,g(1)),forwardZ:w(2,-1,g(2)),positionX:w(6,0,b(0)),positionY:w(7,0,b(1)),positionZ:w(8,0,b(2)),upX:w(3,0,g(3)),upY:w(4,1,g(4)),upZ:w(5,0,g(5))}})():u;return{get forwardX(){return h},get forwardY(){return p},get forwardZ(){return d},get positionX(){return v},get positionY(){return m},get positionZ(){return f},get upX(){return _},get upY(){return g},get upZ(){return b}}})(fa,La,za,Gr,Kr,to,Lo,no),al=new WeakMap,ll=((t,e,n,i,s,r)=>class extends n{get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){const e="function"==typeof t?r(this,t):null;this._nativeContext.onstatechange=e;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===e?t:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}constructor(n,r){super(n),this._nativeContext=n,cs.set(this,n),i(n)&&s.set(n,new Set),this._destination=new t(this,r),this._listener=e(this,n),this._onstatechange=null}})(ba,ol,Fo,Lo,al,lo),cl=((t,e,n,i,s,r)=>(o,a)=>{const l=o.createOscillator();return Vr(l,a),Dr(l,a,"detune"),Dr(l,a,"frequency"),void 0!==a.periodicWave?l.setPeriodicWave(a.periodicWave):Sr(l,a,"type"),e(n,(()=>n(o)))||Rr(l),e(i,(()=>i(o)))||r(l,o),e(s,(()=>s(o)))||Lr(l),t(o,l),l})(sa,go,so,ro,oo,ao),ul=((t,e,n,i,s)=>()=>{const r=new WeakMap;let o=null,a=null,l=null;return{set periodicWave(t){o=t},set start(t){a=t},set stop(t){l=t},render(c,u){const h=r.get(u);return void 0!==h?Promise.resolve(h):(async(c,u)=>{let h=n(c);const p=Ps(h,u);if(!p){const t={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,detune:h.detune.value,frequency:h.frequency.value,periodicWave:null===o?void 0:o,type:h.type};h=e(u,t),null!==a&&h.start(a),null!==l&&h.stop(l)}return r.set(u,h),p?(await t(u,c.detune,h.detune),await t(u,c.frequency,h.frequency)):(await i(u,c.detune,h.detune),await i(u,c.frequency,h.frequency)),await s(c,u,h),h})(c,u)}}})(ua,cl,Zs,va,ko),hl=((t,e,n,i,s,r,o)=>class extends t{get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeOscillatorNode.onended=e;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===e?t:n}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){Cs(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),Ds(this)&&Ts(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}constructor(t,o){const a=s(t),l={...$r,...o},c=n(a,l),u=r(a),h=u?i():null,p=t.sampleRate/2;super(t,!1,c,h),this._detune=e(this,u,c.detune,153600,-153600),this._frequency=e(this,u,c.frequency,p,-p),this._nativeOscillatorNode=c,this._onended=null,this._oscillatorNodeRenderer=h,null!==this._oscillatorNodeRenderer&&void 0!==l.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=l.periodicWave)}})(Ko,fa,cl,ul,Oo,Lo,lo),pl=(dl=pa,(t,e)=>{const n=dl(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=t.createBuffer(1,2,44100);return n.buffer=i,n.loop=!0,n.connect(e),n.start(),()=>{n.stop(),n.disconnect(e)}});var dl;const vl=((t,e,n,i,s)=>(r,{curve:o,oversample:a,...l})=>{const c=r.createWaveShaper(),u=r.createWaveShaper();Vr(c,l),Vr(u,l);const h=n(r,{...l,gain:1}),p=n(r,{...l,gain:-1}),d=n(r,{...l,gain:1}),v=n(r,{...l,gain:-1});let m=null,f=!1,_=null;const g={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(t){h.channelCount=t,p.channelCount=t,c.channelCount=t,d.channelCount=t,u.channelCount=t,v.channelCount=t},get channelCountMode(){return c.channelCountMode},set channelCountMode(t){h.channelCountMode=t,p.channelCountMode=t,c.channelCountMode=t,d.channelCountMode=t,u.channelCountMode=t,v.channelCountMode=t},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(t){h.channelInterpretation=t,p.channelInterpretation=t,c.channelInterpretation=t,d.channelInterpretation=t,u.channelInterpretation=t,v.channelInterpretation=t},get context(){return c.context},get curve(){return _},set curve(n){if(null!==n&&n.length<2)throw e();if(null===n)c.curve=n,u.curve=n;else{const t=n.length,e=new Float32Array(t+2-t%2),i=new Float32Array(t+2-t%2);e[0]=n[0],i[0]=-n[t-1];const s=Math.ceil((t+1)/2),r=(t+1)/2-1;for(let o=1;o<s;o+=1){const a=o/s*r,l=Math.floor(a),c=Math.ceil(a);e[o]=l===c?n[l]:(1-(a-l))*n[l]+(1-(c-a))*n[c],i[o]=l===c?-n[t-1-l]:-(1-(a-l))*n[t-1-l]-(1-(c-a))*n[t-1-c]}e[s]=t%2==1?n[s-1]:(n[s-2]+n[s-1])/2,c.curve=e,u.curve=i}_=n,f&&(i(_)&&null===m?m=t(r,h):null!==m&&(m(),m=null))},get inputs(){return[h]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get oversample(){return c.oversample},set oversample(t){c.oversample=t,u.oversample=t},addEventListener:(...t)=>h.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>h.dispatchEvent(t[0]),removeEventListener:(...t)=>h.removeEventListener(t[0],t[1],t[2])};null!==o&&(g.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==g.oversample&&(g.oversample=a);return s(qr(g,d),(()=>{h.connect(c).connect(d),h.connect(p).connect(u).connect(v).connect(d),f=!0,i(_)&&(m=t(r,h))}),(()=>{h.disconnect(c),c.disconnect(d),h.disconnect(p),p.disconnect(u),u.disconnect(v),v.disconnect(d),f=!1,null!==m&&(m(),m=null)}))})(pl,Cr,jr,eo,Va),ml=((t,e,n,i,s,r,o)=>(a,l)=>{const c=a.createWaveShaper();if(null!==r&&"webkitAudioContext"===r.name&&void 0===a.createGain().gain.automationRate)return n(a,l);Vr(c,l);const u=null===l.curve||l.curve instanceof Float32Array?l.curve:new Float32Array(l.curve);if(null!==u&&u.length<2)throw e();Sr(c,{curve:u},"curve"),Sr(c,l,"oversample");let h=null,p=!1;o(c,"curve",(t=>()=>t.call(c)),(e=>n=>(e.call(c,n),p&&(i(n)&&null===h?h=t(a,c):i(n)||null===h||(h(),h=null)),n)));return s(c,(()=>{p=!0,i(c.curve)&&(h=t(a,c))}),(()=>{p=!1,null!==h&&(h(),h=null)}))})(pl,Cr,vl,eo,Va,qo,no),fl=((t,e,n,i,s,r,o,a,l,c)=>(u,{coneInnerAngle:h,coneOuterAngle:p,coneOuterGain:d,distanceModel:v,maxDistance:m,orientationX:f,orientationY:_,orientationZ:g,panningModel:b,positionX:w,positionY:x,positionZ:y,refDistance:C,rolloffFactor:E,...T})=>{const M=u.createPanner();if(T.channelCount>2)throw o();if("max"===T.channelCountMode)throw o();Vr(M,T);const k={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},P=n(u,{...k,channelInterpretation:"speakers",numberOfInputs:6}),A=i(u,{...T,gain:1}),S=i(u,{...k,gain:1}),V=i(u,{...k,gain:0}),O=i(u,{...k,gain:0}),D=i(u,{...k,gain:0}),R=i(u,{...k,gain:0}),L=i(u,{...k,gain:0}),I=s(u,256,6,1),N=r(u,{...k,curve:new Float32Array([1,1]),oversample:"none"});let F=[f,_,g],B=[w,x,y];const q=new Float32Array(1);I.onaudioprocess=({inputBuffer:t})=>{const e=[l(t,q,0),l(t,q,1),l(t,q,2)];e.some(((t,e)=>t!==F[e]))&&(M.setOrientation(...e),F=e);const n=[l(t,q,3),l(t,q,4),l(t,q,5)];n.some(((t,e)=>t!==B[e]))&&(M.setPosition(...n),B=n)},Object.defineProperty(V.gain,"defaultValue",{get:()=>0}),Object.defineProperty(O.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(L.gain,"defaultValue",{get:()=>0});const z={get bufferSize(){},get channelCount(){return M.channelCount},set channelCount(t){if(t>2)throw o();A.channelCount=t,M.channelCount=t},get channelCountMode(){return M.channelCountMode},set channelCountMode(t){if("max"===t)throw o();A.channelCountMode=t,M.channelCountMode=t},get channelInterpretation(){return M.channelInterpretation},set channelInterpretation(t){A.channelInterpretation=t,M.channelInterpretation=t},get coneInnerAngle(){return M.coneInnerAngle},set coneInnerAngle(t){M.coneInnerAngle=t},get coneOuterAngle(){return M.coneOuterAngle},set coneOuterAngle(t){M.coneOuterAngle=t},get coneOuterGain(){return M.coneOuterGain},set coneOuterGain(t){if(t<0||t>1)throw e();M.coneOuterGain=t},get context(){return M.context},get distanceModel(){return M.distanceModel},set distanceModel(t){M.distanceModel=t},get inputs(){return[A]},get maxDistance(){return M.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;M.maxDistance=t},get numberOfInputs(){return M.numberOfInputs},get numberOfOutputs(){return M.numberOfOutputs},get orientationX(){return S.gain},get orientationY(){return V.gain},get orientationZ(){return O.gain},get panningModel(){return M.panningModel},set panningModel(t){M.panningModel=t},get positionX(){return D.gain},get positionY(){return R.gain},get positionZ(){return L.gain},get refDistance(){return M.refDistance},set refDistance(t){if(t<0)throw new RangeError;M.refDistance=t},get rolloffFactor(){return M.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;M.rolloffFactor=t},addEventListener:(...t)=>A.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>A.dispatchEvent(t[0]),removeEventListener:(...t)=>A.removeEventListener(t[0],t[1],t[2])};h!==z.coneInnerAngle&&(z.coneInnerAngle=h),p!==z.coneOuterAngle&&(z.coneOuterAngle=p),d!==z.coneOuterGain&&(z.coneOuterGain=d),v!==z.distanceModel&&(z.distanceModel=v),m!==z.maxDistance&&(z.maxDistance=m),f!==z.orientationX.value&&(z.orientationX.value=f),_!==z.orientationY.value&&(z.orientationY.value=_),g!==z.orientationZ.value&&(z.orientationZ.value=g),b!==z.panningModel&&(z.panningModel=b),w!==z.positionX.value&&(z.positionX.value=w),x!==z.positionY.value&&(z.positionY.value=x),y!==z.positionZ.value&&(z.positionZ.value=y),C!==z.refDistance&&(z.refDistance=C),E!==z.rolloffFactor&&(z.rolloffFactor=E),1===F[0]&&0===F[1]&&0===F[2]||M.setOrientation(...F),0===B[0]&&0===B[1]&&0===B[2]||M.setPosition(...B);return c(qr(z,M),(()=>{A.connect(M),t(A,N,0,0),N.connect(S).connect(P,0,0),N.connect(V).connect(P,0,1),N.connect(O).connect(P,0,2),N.connect(D).connect(P,0,3),N.connect(R).connect(P,0,4),N.connect(L).connect(P,0,5),P.connect(I).connect(u.destination)}),(()=>{A.disconnect(M),a(A,N,0,0),N.disconnect(S),S.disconnect(P),N.disconnect(V),V.disconnect(P),N.disconnect(O),O.disconnect(P),N.disconnect(D),D.disconnect(P),N.disconnect(R),R.disconnect(P),N.disconnect(L),L.disconnect(P),P.disconnect(I),I.disconnect(u.destination)}))})(Ks,Cr,La,jr,Gr,ml,Kr,Ys,to,Va),_l=(gl=fl,(t,e)=>{const n=t.createPanner();return void 0===n.orientationX?gl(t,e):(Vr(n,e),Dr(n,e,"orientationX"),Dr(n,e,"orientationY"),Dr(n,e,"orientationZ"),Dr(n,e,"positionX"),Dr(n,e,"positionY"),Dr(n,e,"positionZ"),Sr(n,e,"coneInnerAngle"),Sr(n,e,"coneOuterAngle"),Sr(n,e,"coneOuterGain"),Sr(n,e,"distanceModel"),Sr(n,e,"maxDistance"),Sr(n,e,"panningModel"),Sr(n,e,"refDistance"),Sr(n,e,"rolloffFactor"),n)});var gl;const bl=((t,e,n,i,s,r,o,a,l,c)=>()=>{const u=new WeakMap;let h=null;return{render(p,d){const v=u.get(d);return void 0!==v?Promise.resolve(v):(async(p,d)=>{let v=null,m=r(p);const f={channelCount:m.channelCount,channelCountMode:m.channelCountMode,channelInterpretation:m.channelInterpretation},_={...f,coneInnerAngle:m.coneInnerAngle,coneOuterAngle:m.coneOuterAngle,coneOuterGain:m.coneOuterGain,distanceModel:m.distanceModel,maxDistance:m.maxDistance,panningModel:m.panningModel,refDistance:m.refDistance,rolloffFactor:m.rolloffFactor},g=Ps(m,d);if("bufferSize"in m)v=i(d,{...f,gain:1});else if(!g){const t={..._,orientationX:m.orientationX.value,orientationY:m.orientationY.value,orientationZ:m.orientationZ.value,positionX:m.positionX.value,positionY:m.positionY.value,positionZ:m.positionZ.value};m=s(d,t)}if(u.set(d,null===v?m:v),null!==v){if(null===h){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new o(6,p.context.length,d.sampleRate),i=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});i.connect(t.destination),h=(async()=>{const e=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map((async(e,i)=>{const s=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===i?1:0});return await a(t,e,s.offset),s})));for(let t=0;t<6;t+=1)e[t].connect(i,0,t),e[t].start(0);return c(t)})()}const t=await h,r=i(d,{...f,gain:1});await l(p,d,r);const u=[];for(let e=0;e<t.numberOfChannels;e+=1)u.push(t.getChannelData(e));let m=[u[0][0],u[1][0],u[2][0]],g=[u[3][0],u[4][0],u[5][0]],b=i(d,{...f,gain:1}),w=s(d,{..._,orientationX:m[0],orientationY:m[1],orientationZ:m[2],positionX:g[0],positionY:g[1],positionZ:g[2]});r.connect(b).connect(w.inputs[0]),w.connect(v);for(let e=128;e<t.length;e+=128){const t=[u[0][e],u[1][e],u[2][e]],n=[u[3][e],u[4][e],u[5][e]];if(t.some(((t,e)=>t!==m[e]))||n.some(((t,e)=>t!==g[e]))){m=t,g=n;const o=e/d.sampleRate;b.gain.setValueAtTime(0,o),b=i(d,{...f,gain:0}),w=s(d,{..._,orientationX:m[0],orientationY:m[1],orientationZ:m[2],positionX:g[0],positionY:g[1],positionZ:g[2]}),b.gain.setValueAtTime(1,o),r.connect(b).connect(w.inputs[0]),w.connect(v)}}return v}return g?(await t(d,p.orientationX,m.orientationX),await t(d,p.orientationY,m.orientationY),await t(d,p.orientationZ,m.orientationZ),await t(d,p.positionX,m.positionX),await t(d,p.positionY,m.positionY),await t(d,p.positionZ,m.positionZ)):(await a(d,p.orientationX,m.orientationX),await a(d,p.orientationY,m.orientationY),await a(d,p.orientationZ,m.orientationZ),await a(d,p.positionX,m.positionX),await a(d,p.positionY,m.positionY),await a(d,p.positionZ,m.positionZ)),Gs(m)?await l(p,d,m.inputs[0]):await l(p,d,m),m})(p,d)}}})(ua,La,za,jr,_l,Zs,Ro,va,ko,nl),wl=((t,e,n,i,s,r,o)=>class extends t{get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}constructor(t,a){const l=s(t),c={...Xr,...a},u=n(l,c),h=r(l);super(t,!1,u,h?i():null),this._nativePannerNode=u,this._orientationX=e(this,h,u.orientationX,34028234663852886e22,-34028234663852886e22),this._orientationY=e(this,h,u.orientationY,34028234663852886e22,-34028234663852886e22),this._orientationZ=e(this,h,u.orientationZ,34028234663852886e22,-34028234663852886e22),this._positionX=e(this,h,u.positionX,34028234663852886e22,-34028234663852886e22),this._positionY=e(this,h,u.positionY,34028234663852886e22,-34028234663852886e22),this._positionZ=e(this,h,u.positionZ,34028234663852886e22,-34028234663852886e22),o(this,1)}})(Ko,fa,_l,bl,Oo,Lo,xa),xl=(t=>(e,{disableNormalization:n,imag:i,real:s})=>{const r=i instanceof Float32Array?i:new Float32Array(i),o=s instanceof Float32Array?s:new Float32Array(s),a=e.createPeriodicWave(o,r,{disableNormalization:n});if(Array.from(i).length<2)throw t();return a})(Ss),yl=((t,e,n,i)=>{let s;return s=Symbol.hasInstance,class r{static[s](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===r.prototype||n.has(t)}constructor(s,r){const o=e(s),a=i({...Yr,...r}),l=t(o,a);return n.add(l),l}}})(xl,Oo,new WeakSet,(t=>{const{imag:e,real:n}=t;return void 0===e?void 0===n?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,(()=>0)),real:n}:void 0===n?{...t,imag:e,real:Array.from(e,(()=>0))}:{...t,imag:e,real:n}})),Cl=((t,e,n,i,s,r)=>{const o=16385,a=new Float32Array([1,1]),l=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...c,oversample:"none"},h=(t,r,h,p,d)=>{if(1===r)return((t,e,s,r)=>{const h=new Float32Array(o),p=new Float32Array(o);for(let t=0;t<o;t+=1){const e=t/16384*l;h[t]=Math.cos(e),p[t]=Math.sin(e)}const d=n(t,{...c,gain:0}),v=i(t,{...u,curve:h}),m=i(t,{...u,curve:a}),f=n(t,{...c,gain:0}),_=i(t,{...u,curve:p});return{connectGraph(){e.connect(d),e.connect(void 0===m.inputs?m:m.inputs[0]),e.connect(f),m.connect(s),s.connect(void 0===v.inputs?v:v.inputs[0]),s.connect(void 0===_.inputs?_:_.inputs[0]),v.connect(d.gain),_.connect(f.gain),d.connect(r,0,0),f.connect(r,0,1)},disconnectGraph(){e.disconnect(d),e.disconnect(void 0===m.inputs?m:m.inputs[0]),e.disconnect(f),m.disconnect(s),s.disconnect(void 0===v.inputs?v:v.inputs[0]),s.disconnect(void 0===_.inputs?_:_.inputs[0]),v.disconnect(d.gain),_.disconnect(f.gain),d.disconnect(r,0,0),f.disconnect(r,0,1)}}})(t,h,p,d);if(2===r)return((t,s,r,h)=>{const p=new Float32Array(o),d=new Float32Array(o),v=new Float32Array(o),m=new Float32Array(o),f=Math.floor(8192.5);for(let t=0;t<o;t+=1)if(t>f){const e=(t-f)/(16384-f)*l;p[t]=Math.cos(e),d[t]=Math.sin(e),v[t]=0,m[t]=1}else{const e=t/(16384-f)*l;p[t]=1,d[t]=0,v[t]=Math.cos(e),m[t]=Math.sin(e)}const _=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),g=n(t,{...c,gain:0}),b=i(t,{...u,curve:p}),w=n(t,{...c,gain:0}),x=i(t,{...u,curve:d}),y=i(t,{...u,curve:a}),C=n(t,{...c,gain:0}),E=i(t,{...u,curve:v}),T=n(t,{...c,gain:0}),M=i(t,{...u,curve:m});return{connectGraph(){s.connect(_),s.connect(void 0===y.inputs?y:y.inputs[0]),_.connect(g,0),_.connect(w,0),_.connect(C,1),_.connect(T,1),y.connect(r),r.connect(void 0===b.inputs?b:b.inputs[0]),r.connect(void 0===x.inputs?x:x.inputs[0]),r.connect(void 0===E.inputs?E:E.inputs[0]),r.connect(void 0===M.inputs?M:M.inputs[0]),b.connect(g.gain),x.connect(w.gain),E.connect(C.gain),M.connect(T.gain),g.connect(h,0,0),C.connect(h,0,0),w.connect(h,0,1),T.connect(h,0,1)},disconnectGraph(){s.disconnect(_),s.disconnect(void 0===y.inputs?y:y.inputs[0]),_.disconnect(g,0),_.disconnect(w,0),_.disconnect(C,1),_.disconnect(T,1),y.disconnect(r),r.disconnect(void 0===b.inputs?b:b.inputs[0]),r.disconnect(void 0===x.inputs?x:x.inputs[0]),r.disconnect(void 0===E.inputs?E:E.inputs[0]),r.disconnect(void 0===M.inputs?M:M.inputs[0]),b.disconnect(g.gain),x.disconnect(w.gain),E.disconnect(C.gain),M.disconnect(T.gain),g.disconnect(h,0,0),C.disconnect(h,0,0),w.disconnect(h,0,1),T.disconnect(h,0,1)}}})(t,h,p,d);throw s()};return(e,{channelCount:i,channelCountMode:o,pan:a,...l})=>{if("max"===o)throw s();const c=t(e,{...l,channelCount:1,channelCountMode:o,numberOfInputs:2}),u=n(e,{...l,channelCount:i,channelCountMode:o,gain:1}),p=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:a});let{connectGraph:d,disconnectGraph:v}=h(e,i,u,p,c);Object.defineProperty(p.gain,"defaultValue",{get:()=>0}),Object.defineProperty(p.gain,"maxValue",{get:()=>1}),Object.defineProperty(p.gain,"minValue",{get:()=>-1});const m={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(t){u.channelCount!==t&&(f&&v(),({connectGraph:d,disconnectGraph:v}=h(e,t,u,p,c)),f&&d()),u.channelCount=t},get channelCountMode(){return u.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw s();u.channelCountMode=t},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(t){u.channelInterpretation=t},get context(){return u.context},get inputs(){return[u]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get pan(){return p.gain},addEventListener:(...t)=>u.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>u.dispatchEvent(t[0]),removeEventListener:(...t)=>u.removeEventListener(t[0],t[1],t[2])};let f=!1;return r(qr(m,c),(()=>{d(),f=!0}),(()=>{v(),f=!1}))}})(La,Br,jr,ml,Kr,Va),El=((t,e)=>(n,i)=>{const s=i.channelCountMode;if("clamped-max"===s)throw e();if(void 0===n.createStereoPanner)return t(n,i);const r=n.createStereoPanner();return Vr(r,i),Dr(r,i,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>s,set:t=>{if(t!==s)throw e()}}),r})(Cl,Kr),Tl=((t,e,n,i,s)=>()=>{const r=new WeakMap;return{render(o,a){const l=r.get(a);return void 0!==l?Promise.resolve(l):(async(o,a)=>{let l=n(o);const c=Ps(l,a);if(!c){const t={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(a,t)}return r.set(a,l),c?await t(a,o.pan,l.pan):await i(a,o.pan,l.pan),Gs(l)?await s(o,a,l.inputs[0]):await s(o,a,l),l})(o,a)}}})(ua,El,Zs,va,ko),Ml=((t,e,n,i,s,r)=>class extends t{get pan(){return this._pan}constructor(t,o){const a=s(t),l={...Zr,...o},c=n(a,l),u=r(a);super(t,!1,c,u?i():null),this._pan=e(this,u,c.pan)}})(Ko,fa,El,Tl,Oo,Lo),kl=((t,e,n)=>()=>{const i=new WeakMap;return{render(s,r){const o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=e(s);if(!Ps(o,r)){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,curve:o.curve,oversample:o.oversample};o=t(r,e)}return i.set(r,o),Gs(o)?await n(s,r,o.inputs[0]):await n(s,r,o),o})(s,r)}}})(ml,Zs,ko),Pl=((t,e,n,i,s,r,o)=>class extends t{get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}constructor(t,e){const a=s(t),l={...Jr,...e},c=n(a,l);super(t,!0,c,r(a)?i():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=c,o(this,1)}})(Ko,Cr,ml,kl,Oo,Lo,xa),Al=(t=>null!==t&&t.isSecureContext)(xo),Sl=(t=>(e,n,i)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get:()=>Math.round(e*n)},currentTime:{configurable:!0,get:()=>e}});try{return i()}finally{null!==t&&(delete t.currentFrame,delete t.currentTime)}})(xo),Vl=new WeakMap,Ol=((t,e)=>n=>{let i=t.get(n);if(void 0!==i)return i;if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");return i=new e(1,1,44100),t.set(n,i),i})(Vl,Ro),Dl=Al?((t,e,n,i,s,r,o,a,l,c,u,h,p)=>{let d=0;return(v,m,f={credentials:"omit"})=>{const _=u.get(v);if(void 0!==_&&_.has(m))return Promise.resolve();const g=c.get(v);if(void 0!==g){const t=g.get(m);if(void 0!==t)return t}const b=r(v),w=void 0===b.audioWorklet?s(m).then((([t,e])=>{const[i,s]=fs(t,e);return n(`${i};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${s}\n})})(window,'_AWGS')`)})).then((()=>{const t=p._AWGS.pop();if(void 0===t)throw new SyntaxError;i(b.currentTime,b.sampleRate,(()=>t(class{},void 0,((t,n)=>{if(""===t.trim())throw e();const i=ps.get(b);if(void 0!==i){if(i.has(t))throw e();gs(n),_s(n.parameterDescriptors),i.set(t,n)}else gs(n),_s(n.parameterDescriptors),ps.set(b,new Map([[t,n]]))}),b.sampleRate,void 0,void 0)))})):Promise.all([s(m),Promise.resolve(t(h,h))]).then((([[t,e],n])=>{const i=d+1;d=i;const[s,r]=fs(t,e),c=new Blob([`${s};((AudioWorkletProcessor,registerProcessor)=>{${r}\n})(${n?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${n?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${n?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${i}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),u=URL.createObjectURL(c);return b.audioWorklet.addModule(u,f).then((()=>{if(a(b))return b;const t=o(b);return t.audioWorklet.addModule(u,f).then((()=>t))})).then((t=>{if(null===l)throw new SyntaxError;try{new l(t,`__sac${i}`)}catch{throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(u)))}));return void 0===g?c.set(v,new Map([[m,w]])):g.set(m,w),w.then((()=>{const t=u.get(v);void 0===t?u.set(v,new Set([m])):t.add(m)})).finally((()=>{const t=c.get(v);void 0!==t&&t.delete(m)})),w}})(go,Kr,(t=>e=>new Promise(((n,i)=>{if(null===t)return void i(new SyntaxError);const s=t.document.head;if(null===s)i(new SyntaxError);else{const r=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),l=t.onerror,c=()=>{t.onerror=l,URL.revokeObjectURL(a)};t.onerror=(e,n,s,r,o)=>n===a||n===t.location.href&&1===s&&1===r?(c(),i(o),!1):null!==l?l(e,n,s,r,o):void 0,r.onerror=()=>{c(),i(new SyntaxError)},r.onload=()=>{c(),n()},r.src=a,r.type="module",s.appendChild(r)}})))(xo),Sl,(Rl=()=>new DOMException("","AbortError"),async t=>{try{const e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch{}throw Rl()}),Oo,Ol,Lo,Go,new WeakMap,new WeakMap,((t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),i=new e(1,128,44100),s=URL.createObjectURL(n);let r=!1,o=!1;try{await i.audioWorklet.addModule(s);const e=new t(i,"a",{numberOfOutputs:0}),n=i.createOscillator();e.port.onmessage=()=>r=!0,e.onprocessorerror=()=>o=!0,n.connect(e),n.start(0),await i.startRendering()}catch{}finally{URL.revokeObjectURL(s)}return r&&!o})(Go,Ro),xo):void 0;var Rl;const Ll=((t,e)=>n=>t(n)||e(n))(zo,Lo),Il=((t,e,n,i,s,r,o,a,l,c,u)=>(h,p)=>{const d=o(h)?h:r(h);if(s.has(p)){const t=n();return Promise.reject(t)}try{s.add(p)}catch{}return e(l,(()=>l(d)))?d.decodeAudioData(p).then((n=>(gr(p).catch((()=>{})),e(a,(()=>a(n)))||u(n),t.add(n),n))):new Promise(((e,n)=>{const s=async()=>{try{await gr(p)}catch{}},r=t=>{n(t),s()};try{d.decodeAudioData(p,(n=>{"function"!=typeof n.copyFromChannel&&(c(n),Vs(n)),t.add(n),s().then((()=>e(n)))}),(t=>{r(null===t?i():t)}))}catch(t){r(t)}}))})(Xo,go,(()=>new DOMException("","DataCloneError")),(()=>new DOMException("","EncodingError")),new WeakSet,Oo,Ll,As,Pr,Jo,ta),Nl=(Fl=Dl,Bl=$o,ql=na,zl=ga,jl=ya,Ul=Na,Wl=Ba,Gl=Ua,Kl=Ka,Hl=Il,$l=$a,Xl=Qa,Yl=tl,Zl=rl,Ql=ll,Jl=hl,tc=wl,ec=yl,nc=Ml,ic=Pl,class extends Ql{get audioWorklet(){return this._audioWorklet}createAnalyser(){return new Bl(this)}createBiquadFilter(){return new jl(this)}createBuffer(t,e,n){return new ql({length:e,numberOfChannels:t,sampleRate:n})}createBufferSource(){return new zl(this)}createChannelMerger(t=6){return new Ul(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new Wl(this,{numberOfOutputs:t})}createConstantSource(){return new Gl(this)}createConvolver(){return new Kl(this)}createDelay(t=1){return new $l(this,{maxDelayTime:t})}createDynamicsCompressor(){return new Xl(this)}createGain(){return new Yl(this)}createIIRFilter(t,e){return new Zl(this,{feedback:e,feedforward:t})}createOscillator(){return new Jl(this)}createPanner(){return new tc(this)}createPeriodicWave(t,e,n={disableNormalization:!1}){return new ec(this,{...n,imag:e,real:t})}createStereoPanner(){return new nc(this)}createWaveShaper(){return new ic(this)}decodeAudioData(t,e,n){return Hl(this._nativeContext,t).then((t=>("function"==typeof e&&e(t),t)),(t=>{throw"function"==typeof n&&n(t),t}))}constructor(t,e){super(t,e),this._nativeContext=t,this._audioWorklet=void 0===Fl?void 0:{addModule:(t,e)=>Fl(this,t,e)}}});var Fl,Bl,ql,zl,jl,Ul,Wl,Gl,Kl,Hl,$l,Xl,Yl,Zl,Ql,Jl,tc,ec,nc,ic;const sc=((t,e,n,i)=>class extends t{get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}constructor(t,s){const r=n(t),o=e(r,s);if(i(r))throw TypeError();super(t,!0,o,null),this._nativeMediaElementAudioSourceNode=o}})(Ko,((t,e)=>t.createMediaElementSource(e.mediaElement)),Oo,Lo),rc=((t,e,n,i)=>class extends t{get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}constructor(t,s){const r=n(t);if(i(r))throw new TypeError;const o={...kr,...s},a=e(r,o);super(t,!1,a,null),this._nativeMediaStreamAudioDestinationNode=a}})(Ko,((t,e)=>{const n=t.createMediaStreamDestination();return Vr(n,e),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n}),Oo,Lo),oc=((t,e,n,i)=>class extends t{get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}constructor(t,s){const r=n(t),o=e(r,s);if(i(r))throw new TypeError;super(t,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}})(Ko,((t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort(((t,e)=>t.id<e.id?-1:t.id>e.id?1:0));const i=n.slice(0,1),s=t.createMediaStreamSource(new MediaStream(i));return Object.defineProperty(s,"mediaStream",{value:e}),s}),Oo,Lo),ac=((t,e)=>(n,{mediaStreamTrack:i})=>{if("function"==typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(i);const s=new MediaStream([i]),r=n.createMediaStreamSource(s);if("audio"!==i.kind)throw t();if(e(n))throw new TypeError;return r})(Cr,Lo),lc=((t,e,n)=>class extends t{constructor(t,i){const s=n(t);super(t,!0,e(s,i),null)}})(Ko,ac,Oo),cc=((t,e,n,i,s,r,o,a,l)=>class extends t{get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw e()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Fs(this)})))}createMediaElementSource(t){return new s(this,{mediaElement:t})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(t){return new o(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new a(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise(((t,e)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)})):this._nativeAudioContext.resume().catch((t=>{if(void 0===t||15===t.code)throw e();throw t}))}suspend(){return this._nativeAudioContext.suspend().catch((t=>{if(void 0===t)throw e();throw t}))}constructor(t={}){if(null===l)throw new Error("Missing the native AudioContext constructor.");let e;try{e=new l(t)}catch(t){if(12===t.code&&"sampleRate is not in range"===t.message)throw n();throw t}if(null===e)throw i();if(!Bs(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw n();super(e,2);const{latencyHint:s}=t,{sampleRate:r}=e;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===s?512/r:"interactive"===s||void 0===s?256/r:"playback"===s?1024/r:128*Math.max(2,Math.min(128,Math.round(s*r/128)))/r,this._nativeAudioContext=e,"webkitAudioContext"===l.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}})(Nl,Cr,Kr,Qr,sc,rc,oc,lc,qo),uc=(hc=al,t=>{const e=hc.get(t);if(void 0===e)throw new Error("The context has no set of AudioWorkletNodes.");return e});var hc;const pc=(dc=uc,(t,e)=>{dc(t).add(e)});var dc;const vc=(t=>(e,n,i=0,s=0)=>{const r=e[i];if(void 0===r)throw t();return ir(n)?r.connect(n,0,s):r.connect(n,0)})(Ss),mc=(t=>(e,n)=>{t(e).delete(n)})(uc),fc=(t=>(e,n,i,s=0)=>void 0===n?e.forEach((t=>t.disconnect())):"number"==typeof n?wr(t,e,n).disconnect():ir(n)?void 0===i?e.forEach((t=>t.disconnect(n))):void 0===s?wr(t,e,i).disconnect(n,0):wr(t,e,i).disconnect(n,0,s):void 0===i?e.forEach((t=>t.disconnect(n))):wr(t,e,i).disconnect(n,0))(Ss),_c=new WeakMap,gc=(bc=_c,wc=bs,t=>wc(bc,t));var bc,wc;const xc=((t,e,n,i,s,r,o,a,l,c,u,h,p)=>(d,v,m,f)=>{if(0===f.numberOfInputs&&0===f.numberOfOutputs)throw l();const _=Array.isArray(f.outputChannelCount)?f.outputChannelCount:Array.from(f.outputChannelCount);if(_.some((t=>t<1)))throw l();if(_.length!==f.numberOfOutputs)throw e();if("explicit"!==f.channelCountMode)throw l();const g=f.channelCount*f.numberOfInputs,b=_.reduce(((t,e)=>t+e),0),w=void 0===m.parameterDescriptors?0:m.parameterDescriptors.length;if(g+w>6||b>6)throw l();const x=new MessageChannel,y=[],C=[];for(let t=0;t<f.numberOfInputs;t+=1)y.push(o(d,{channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,gain:1})),C.push(s(d,{channelCount:f.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:f.channelCount}));const E=[];if(void 0!==m.parameterDescriptors)for(const{defaultValue:t,maxValue:e,minValue:n,name:i}of m.parameterDescriptors){const s=r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==f.parameterData[i]?f.parameterData[i]:void 0===t?0:t});Object.defineProperties(s.offset,{defaultValue:{get:()=>void 0===t?0:t},maxValue:{get:()=>void 0===e?34028234663852886e22:e},minValue:{get:()=>void 0===n?-34028234663852886e22:n}}),E.push(s)}const T=i(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,g+w)}),M=Ir(v,d.sampleRate),k=a(d,M,g+w,Math.max(1,b)),P=s(d,{channelCount:Math.max(1,b),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,b)}),A=[];for(let t=0;t<f.numberOfOutputs;t+=1)A.push(i(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:_[t]}));for(let t=0;t<f.numberOfInputs;t+=1){y[t].connect(C[t]);for(let e=0;e<f.channelCount;e+=1)C[t].connect(T,e,t*f.channelCount+e)}const S=new ar(void 0===m.parameterDescriptors?[]:m.parameterDescriptors.map((({name:t},e)=>{const n=E[e];return n.connect(T,0,g+e),n.start(0),[t,n.offset]})));T.connect(k);let V=f.channelInterpretation,O=null;const D=0===f.numberOfOutputs?[k]:A,R={get bufferSize(){return M},get channelCount(){return f.channelCount},set channelCount(t){throw n()},get channelCountMode(){return f.channelCountMode},set channelCountMode(t){throw n()},get channelInterpretation(){return V},set channelInterpretation(t){for(const e of y)e.channelInterpretation=t;V=t},get context(){return k.context},get inputs(){return y},get numberOfInputs(){return f.numberOfInputs},get numberOfOutputs(){return f.numberOfOutputs},get onprocessorerror(){return O},set onprocessorerror(t){"function"==typeof O&&R.removeEventListener("processorerror",O),O="function"==typeof t?t:null,"function"==typeof O&&R.addEventListener("processorerror",O)},get parameters(){return S},get port(){return x.port2},addEventListener:(...t)=>k.addEventListener(t[0],t[1],t[2]),connect:t.bind(null,D),disconnect:c.bind(null,D),dispatchEvent:(...t)=>k.dispatchEvent(t[0]),removeEventListener:(...t)=>k.removeEventListener(t[0],t[1],t[2])},L=new Map;var I,N;x.port1.addEventListener=(I=x.port1.addEventListener,(...t)=>{if("message"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=L.get(t[1]);void 0!==n?t[1]=n:(t[1]=t=>{u(d.currentTime,d.sampleRate,(()=>e(t)))},L.set(e,t[1]))}}return I.call(x.port1,t[0],t[1],t[2])}),x.port1.removeEventListener=(N=x.port1.removeEventListener,(...t)=>{if("message"===t[0]){const e=L.get(t[1]);void 0!==e&&(L.delete(t[1]),t[1]=e)}return N.call(x.port1,t[0],t[1],t[2])});let F=null;Object.defineProperty(x.port1,"onmessage",{get:()=>F,set:t=>{"function"==typeof F&&x.port1.removeEventListener("message",F),F="function"==typeof t?t:null,"function"==typeof F&&(x.port1.addEventListener("message",F),x.port1.start())}}),m.prototype.port=x.port1;let B=null;const q=((t,e,n,i)=>{let s=ds.get(t);void 0===s&&(s=new WeakMap,ds.set(t,s));const r=Nr(n,i);return s.set(e,r),r})(d,R,m,f);q.then((t=>B=t));const z=hr(f.numberOfInputs,f.channelCount),j=hr(f.numberOfOutputs,_),U=void 0===m.parameterDescriptors?[]:m.parameterDescriptors.reduce(((t,{name:e})=>({...t,[e]:new Float32Array(128)})),{});let W=!0;const G=()=>{f.numberOfOutputs>0&&k.disconnect(P);for(let t=0,e=0;t<f.numberOfOutputs;t+=1){const n=A[t];for(let i=0;i<_[t];i+=1)P.disconnect(n,e+i,i);e+=_[t]}},K=new Map;k.onaudioprocess=({inputBuffer:t,outputBuffer:e})=>{if(null!==B){const n=h(R);for(let i=0;i<M;i+=128){for(let e=0;e<f.numberOfInputs;e+=1)for(let n=0;n<f.channelCount;n+=1)cr(t,z[e],n,n,i);void 0!==m.parameterDescriptors&&m.parameterDescriptors.forEach((({name:e},n)=>{cr(t,U,e,g+n,i)}));for(let t=0;t<f.numberOfInputs;t+=1)for(let e=0;e<_[t];e+=1)0===j[t][e].byteLength&&(j[t][e]=new Float32Array(128));try{const t=z.map(((t,e)=>{if(n[e].size>0)return K.set(e,M/128),t;const i=K.get(e);return void 0===i?[]:(t.every((t=>t.every((t=>0===t))))&&(1===i?K.delete(e):K.set(e,i-1)),t)})),s=u(d.currentTime+i/d.sampleRate,d.sampleRate,(()=>B.process(t,j,U)));W=s;for(let t=0,n=0;t<f.numberOfOutputs;t+=1){for(let s=0;s<_[t];s+=1)ur(e,j[t],s,n+s,i);n+=_[t]}}catch(t){W=!1,R.dispatchEvent(new ErrorEvent("processorerror",{colno:t.colno,filename:t.filename,lineno:t.lineno,message:t.message}))}if(!W){for(let t=0;t<f.numberOfInputs;t+=1){y[t].disconnect(C[t]);for(let e=0;e<f.channelCount;e+=1)C[i].disconnect(T,e,t*f.channelCount+e)}if(void 0!==m.parameterDescriptors){const t=m.parameterDescriptors.length;for(let e=0;e<t;e+=1){const t=E[e];t.disconnect(T,0,g+e),t.stop()}}T.disconnect(k),k.onaudioprocess=null,H?G():Y();break}}}};let H=!1;const $=o(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),X=()=>k.connect($).connect(d.destination),Y=()=>{k.disconnect($),$.disconnect()};return X(),p(R,(()=>{if(W){Y(),f.numberOfOutputs>0&&k.connect(P);for(let t=0,e=0;t<f.numberOfOutputs;t+=1){const n=A[t];for(let i=0;i<_[t];i+=1)P.connect(n,e+i,i);e+=_[t]}}H=!0}),(()=>{W&&(X(),G()),H=!1}))})(vc,Ss,Cr,La,Br,za,jr,Gr,Kr,fc,Sl,gc,Va),yc=((t,e,n,i,s)=>(r,o,a,l,c,u)=>{if(null!==a)try{const e=new a(r,l,u),i=new Map;let o=null;if(Object.defineProperties(e,{channelCount:{get:()=>u.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>o,set:t=>{"function"==typeof o&&e.removeEventListener("processorerror",o),o="function"==typeof t?t:null,"function"==typeof o&&e.addEventListener("processorerror",o)}}}),e.addEventListener=(p=e.addEventListener,(...t)=>{if("processorerror"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=i.get(t[1]);void 0!==n?t[1]=n:(t[1]=n=>{"error"===n.type?(Object.defineProperties(n,{type:{value:"processorerror"}}),e(n)):e(new ErrorEvent(t[0],{...n}))},i.set(e,t[1]))}}return p.call(e,"error",t[1],t[2]),p.call(e,...t)}),e.removeEventListener=(h=e.removeEventListener,(...t)=>{if("processorerror"===t[0]){const e=i.get(t[1]);void 0!==e&&(i.delete(t[1]),t[1]=e)}return h.call(e,"error",t[1],t[2]),h.call(e,t[0],t[1],t[2])}),0!==u.numberOfOutputs){const t=n(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(t).connect(r.destination);return s(e,(()=>t.disconnect()),(()=>t.connect(r.destination)))}return e}catch(t){if(11===t.code)throw i();throw t}var h,p;if(void 0===c)throw i();return(t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}})(u),e(r,o,c,u)})(Cr,xc,jr,Kr,Va),Cc=((t,e,n,i,s,r,o,a,l,c,u,h,p,d,v,m)=>(f,_,g)=>{const b=new WeakMap;let w=null;return{render(x,y){a(y,x);const C=b.get(y);return void 0!==C?Promise.resolve(C):(async(a,x)=>{let y=u(a),C=null;const E=Ps(y,x),T=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(null===h){const t=T.reduce(((t,e)=>t+e),0),n=s(x,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),r=[];for(let t=0;t<a.numberOfOutputs;t+=1)r.push(i(x,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:T[t]}));const c=o(x,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1});c.connect=e.bind(null,r),c.disconnect=l.bind(null,r),C=[n,r,c]}else E||(y=new h(x,f));if(b.set(x,null===C?y:C[2]),null!==C){if(null===w){if(void 0===g)throw new Error("Missing the processor constructor.");if(null===p)throw new Error("Missing the native OfflineAudioContext constructor.");const t=a.channelCount*a.numberOfInputs,e=void 0===g.parameterDescriptors?0:g.parameterDescriptors.length,n=t+e,l=async()=>{const l=new p(n,128*Math.ceil(a.context.length/128),x.sampleRate),c=[],u=[];for(let t=0;t<_.numberOfInputs;t+=1)c.push(o(l,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),u.push(s(l,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const h=await Promise.all(Array.from(a.parameters.values()).map((async t=>{const e=r(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await d(l,t,e.offset),e}))),f=i(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+e)});for(let t=0;t<_.numberOfInputs;t+=1){c[t].connect(u[t]);for(let e=0;e<_.channelCount;e+=1)u[t].connect(f,e,t*_.channelCount+e)}for(const[e,n]of h.entries())n.connect(f,0,t+e),n.start(0);return f.connect(l.destination),await Promise.all(c.map((t=>v(a,l,t)))),m(l)};w=pr(a,0===n?null:await l(),x,_,T,g,c)}const t=await w,e=n(x,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[l,u,h]=C;null!==t&&(e.buffer=t,e.start(0)),e.connect(l);for(let t=0,e=0;t<a.numberOfOutputs;t+=1){const n=u[t];for(let i=0;i<T[t];i+=1)l.connect(n,e+i,i);e+=T[t]}return h}if(E)for(const[e,n]of a.parameters.entries())await t(x,n,y.parameters.get(e));else for(const[t,e]of a.parameters.entries())await d(x,e,y.parameters.get(t));return await v(a,x,y),y})(x,y)}}})(ua,vc,pa,La,Br,za,jr,mc,fc,Sl,Zs,Go,Ro,va,ko,nl),Ec=(Tc=Vl,t=>Tc.get(t));var Tc;const Mc=(t=>(e,n)=>{t.set(e,n)})(_c),kc=Al?((t,e,n,i,s,r,o,a,l,c,u,h,p,d)=>class extends e{get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){const e="function"==typeof t?d(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===e?t:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}constructor(e,d,v){var m;const f=a(e),_=l(f),g=u({...lr,...v});p(g);const b=ps.get(f),w=null==b?void 0:b.get(d),x=_||"closed"!==f.state?f:null!==(m=o(f))&&void 0!==m?m:f,y=s(x,_?null:e.baseLatency,c,d,w,g);super(e,!0,y,_?i(d,g,w):null);const C=[];y.parameters.forEach(((t,e)=>{const i=n(this,_,t);C.push([e,i])})),this._nativeAudioWorkletNode=y,this._onprocessorerror=null,this._parameters=new ar(C),_&&t(f,this);const{activeInputs:E}=r(this);h(y,E)}})(pc,Ko,fa,Cc,yc,Ls,Ec,Oo,Lo,Go,(t=>({...t,outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Array.from({length:t.numberOfOutputs},(()=>1))})),Mc,(t=>{const{port1:e,port2:n}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),n.close()}}),lo):void 0,Pc=(((t,e,n,i,s)=>{})(Cr,Kr,Qr,ll,qo),((t,e)=>(n,i,s)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,i,s)}catch(e){if("SyntaxError"===e.name)throw t();throw e}})(Kr,Ro)),Ac=((t,e,n,i,s,r,o,a)=>(l,c)=>n(l).render(l,c).then((()=>Promise.all(Array.from(i(c)).map((t=>n(t).render(t,c)))))).then((()=>s(c))).then((n=>("function"!=typeof n.copyFromChannel?(o(n),Vs(n)):e(r,(()=>r(n)))||a(n),t.add(n),n))))(Xo,go,To,uc,nl,As,Jo,ta),Sc=(((t,e,n,i,s)=>{})(go,Cr,Pc,ll,Ac),((t,e,n,i,s)=>class extends t{get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",s(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,Fs(this)})))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout((()=>this._waitForThePromiseToSettle(t)))}constructor(t,n,s){let r;if("number"==typeof t&&void 0!==n&&void 0!==s)r={length:n,numberOfChannels:t,sampleRate:s};else{if("object"!=typeof t)throw new Error("The given parameters are not valid.");r=t}const{length:o,numberOfChannels:a,sampleRate:l}={...Hr,...r},c=i(a,o,l);e(Pr,(()=>Pr(c)))||c.addEventListener("statechange",(()=>{let t=0;const e=n=>{"running"===this._state&&(t>0?(c.removeEventListener("statechange",e),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):t+=1)};return e})()),super(c,a),this._length=o,this._nativeOfflineAudioContext=c,this._state=null}})(Nl,go,Cr,Pc,Ac)),Vc=((t,e)=>n=>{const i=t.get(n);return e(i)||e(n)})(cs,zo),Oc=(Dc=os,Rc=Uo,t=>Dc.has(t)||Rc(t));var Dc,Rc;const Lc=(Ic=ls,Nc=Wo,t=>Ic.has(t)||Nc(t));var Ic,Nc;const Fc=((t,e)=>n=>{const i=t.get(n);return e(i)||e(n)})(cs,Lo);function Bc(t,e){if(!t)throw new Error(e)}function qc(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function zc(t){t.isOffline||"running"===t.state||Uc('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let jc=console;function Uc(...t){jc.warn(...t)}function Wc(t){return void 0===t}function Gc(t){return!Wc(t)}function Kc(t){return"number"==typeof t}function Hc(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function $c(t){return"boolean"==typeof t}function Xc(t){return Array.isArray(t)}function Yc(t){return"string"==typeof t}function Zc(t){return Yc(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}const Qc="object"==typeof self?self:null,Jc=Qc&&(Qc.hasOwnProperty("AudioContext")||Qc.hasOwnProperty("webkitAudioContext"));function tu(t,e,n,i){var s,r=arguments.length,o=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(r<3?s(o):r>3?s(e,n,o):s(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o}function eu(t,e,n,i){return new(n||(n=Promise))((function(s,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))}Object.create;Object.create;class nu{_createWorker(){const t=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}constructor(t,e,n){this._callback=t,this._type=e,this._updateInterval=n,this._createClock()}}function iu(t){return Lc(t)}function su(t){return Oc(t)}function ru(t){return Fc(t)}function ou(t){return Vc(t)}function au(t){return t instanceof AudioBuffer}function lu(t,e){return"value"===t||iu(e)||su(e)||au(e)}function cu(t,...e){if(!e.length)return t;const n=e.shift();if(Hc(t)&&Hc(n))for(const e in n)lu(e,n[e])?t[e]=n[e]:Hc(n[e])?(t[e]||Object.assign(t,{[e]:{}}),cu(t[e],n[e])):Object.assign(t,{[e]:n[e]});return cu(t,...e)}function uu(t,e,n=[],i){const s={},r=Array.from(e);if(Hc(r[0])&&i&&!Reflect.has(r[0],i)){Object.keys(r[0]).some((e=>Reflect.has(t,e)))||(cu(s,{[i]:r[0]}),n.splice(n.indexOf(i),1),r.shift())}if(1===r.length&&Hc(r[0]))cu(s,r[0]);else for(let t=0;t<n.length;t++)Gc(r[t])&&(s[n[t]]=r[t]);return cu(t,s)}function hu(t,e){return Wc(t)?e:t}function pu(t,e){return e.forEach((e=>{Reflect.has(t,e)&&delete t[e]})),t}class du{static getDefaults(){return{}}log(...t){(this.debug||Qc&&this.toString()===Qc.TONE_DEBUG_CLASS)&&function(...t){jc.log(...t)}(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}constructor(){this.debug=!1,this._wasDisposed=!1}}du.version="14.7.77";function vu(t,e){return t>e+1e-6}function mu(t,e){return vu(t,e)||_u(t,e)}function fu(t,e){return t+1e-6<e}function _u(t,e){return Math.abs(t-e)<1e-6}function gu(t,e,n){return Math.max(Math.min(t,n),e)}class bu extends du{static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(Bc(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];Bc(mu(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){const e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this}get(t,e="time"){const n=this._search(t,e);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const n=this._search(t,e);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const n=this._search(t);return n-1>=0?this._timeline[n-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(_u(this._timeline[e].time,t)){for(let n=e;n>=0&&_u(this._timeline[n].time,t);n--)e=n;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&mu(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(0===this._timeline.length)return-1;let n=0;const i=this._timeline.length;let s=i;if(i>0&&this._timeline[i-1][e]<=t)return i-1;for(;n<s;){let i=Math.floor(n+(s-n)/2);const r=this._timeline[i],o=this._timeline[i+1];if(_u(r[e],t)){for(let n=i;n<this._timeline.length;n++){if(!_u(this._timeline[n][e],t))break;i=n}return i}if(fu(r[e],t)&&vu(o[e],t))return i;vu(r[e],t)?s=i:n=i+1}return-1}_iterate(t,e=0,n=this._timeline.length-1){this._timeline.slice(e,n+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const n=this._search(t);return-1!==n&&this._iterate(e,0,n),this}forEachAfter(t,e){const n=this._search(t);return this._iterate(e,n+1),this}forEachBetween(t,e,n){let i=this._search(t),s=this._search(e);return-1!==i&&-1!==s?(this._timeline[i].time!==t&&(i+=1),this._timeline[s].time===e&&(s-=1),this._iterate(n,i,s)):-1===i&&this._iterate(n,0,s),this}forEachFrom(t,e){let n=this._search(t);for(;n>=0&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this}forEachAtTime(t,e){const n=this._search(t);if(-1!==n&&_u(this._timeline[n].time,t)){let i=n;for(let e=n;e>=0&&_u(this._timeline[e].time,t);e--)i=e;this._iterate((t=>{e(t)}),i,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}constructor(){super(),this.name="Timeline",this._timeline=[];const t=uu(bu.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}}const wu=[];function xu(t){wu.push(t)}const yu=[];function Cu(t){yu.push(t)}class Eu extends du{on(t,e){return t.split(/\W+/).forEach((t=>{Wc(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)})),this}once(t,e){const n=(...i)=>{e(...i),this.off(t,n)};return this.on(t,n),this}off(t,e){return t.split(/\W+/).forEach((n=>{if(Wc(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(Wc(e))this._events[t]=[];else{const n=this._events[t];for(let t=n.length-1;t>=0;t--)n[t]===e&&n.splice(t,1)}})),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const n=this._events[t].slice(0);for(let t=0,i=n.length;t<i;t++)n[t].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach((e=>{const n=Object.getOwnPropertyDescriptor(Eu.prototype,e);Object.defineProperty(t.prototype,e,n)}))}dispose(){return super.dispose(),this._events=void 0,this}constructor(){super(...arguments),this.name="Emitter"}}class Tu extends Eu{toJSON(){return{}}constructor(){super(...arguments),this.isOffline=!1}}class Mu extends Tu{static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var t;return this._initialized||(t=this,wu.forEach((e=>e(t))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,n){return this._context.createBuffer(t,e,n)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,n){return this._context.createPeriodicWave(t,e,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){Bc(ou(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(t)}createMediaElementSource(t){Bc(ou(this._context),"Not available if OfflineAudioContext");return this._context.createMediaElementSource(t)}createMediaStreamDestination(){Bc(ou(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){Bc(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){Bc(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){Bc(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){Bc(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return function(t,e,n){return Bc(Gc(kc),"This node only works in a secure context (https or localhost)"),new kc(t,e,n)}(this.rawContext,t,e)}addAudioWorkletModule(t,e){return eu(this,void 0,void 0,(function*(){Bc(Gc(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)}))}workletsAreReady(){return eu(this,void 0,void 0,(function*(){const t=[];this._workletModules.forEach((e=>t.push(e))),yield Promise.all(t)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(this._latencyHint=t,Yc(t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return ou(this._context)?this._context.resume():Promise.resolve()}close(){return eu(this,void 0,void 0,(function*(){var t;ou(this._context)&&(yield this._context.close()),this._initialized&&(t=this,yu.forEach((e=>e(t))))}))}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0);for(let e=0;e<n.length;e++)n[e]=t;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=e,i.loop=!0,i.start(0),this._constants.set(t,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((t=>this._constants[t].disconnect())),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:n+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach((e=>{e.id===t&&this._timeouts.remove(e)})),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const n=++this._timeoutIds,i=()=>{const s=this.now();this._timeouts.add({callback:()=>{t(),i()},id:n,time:s+e})};return i(),n}constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new bu,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const t=uu(Mu.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=function(t){return new cc(t)}({latencyHint:t.latencyHint}),this._ticker=new nu(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}}function ku(t,e){Xc(e)?e.forEach((e=>ku(t,e))):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function Pu(t,e){Xc(e)?e.forEach((e=>Pu(t,e))):Object.defineProperty(t,e,{writable:!0})}const Au=()=>{};class Su extends du{static getDefaults(){return{onerror:Au,onload:Au,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Ru().sampleRate}set(t){return t instanceof Su?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return eu(this,void 0,void 0,(function*(){const e=Su.load(t).then((t=>{this.set(t),this.onload(this)}));Su.downloads.push(e);try{yield e}finally{const t=Su.downloads.indexOf(e);Su.downloads.splice(t,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=Xc(t)&&t[0].length>0,n=e?t.length:1,i=e?t[0].length:t.length,s=Ru(),r=s.createBuffer(n,i,s.sampleRate),o=e||1!==n?t:[t];for(let t=0;t<n;t++)r.copyToChannel(o[t],t);return this._buffer=r,this}toMono(t){if(Kc(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length);const e=this.numberOfChannels;for(let n=0;n<e;n++){const e=this.toArray(n);for(let n=0;n<e.length;n++)t[n]+=e[n]}t=t.map((t=>t/e)),this.fromArray(t)}return this}toArray(t){if(Kc(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){const n=Math.floor(t*this.sampleRate),i=Math.floor(e*this.sampleRate);Bc(n<i,"The start time must be less than the end time");const s=i-n,r=Ru().createBuffer(this.numberOfChannels,s,this.sampleRate);for(let t=0;t<this.numberOfChannels;t++)r.copyToChannel(this.getChannelData(t).subarray(n,i),t);return new Su(r)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new Su).fromArray(t)}static fromUrl(t){return eu(this,void 0,void 0,(function*(){const e=new Su;return yield e.load(t)}))}static load(t){return eu(this,void 0,void 0,(function*(){const e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){const n=e[1].split("|");let i=n[0];for(const t of n)if(Su.supportsType(t)){i=t;break}t=t.replace(e[0],i)}const n=""===Su.baseUrl||Su.baseUrl.endsWith("/")?Su.baseUrl:Su.baseUrl+"/",i=yield fetch(n+t);if(!i.ok)throw new Error(`could not load url: ${t}`);const s=yield i.arrayBuffer();return yield Ru().decodeAudioData(s)}))}static supportsType(t){const e=t.split("."),n=e[e.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return eu(this,void 0,void 0,(function*(){for(yield Promise.resolve();Su.downloads.length;)yield Su.downloads[0]}))}constructor(){super(),this.name="ToneAudioBuffer",this.onload=Au;const t=uu(Su.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&au(t.url)||t.url instanceof Su?this.set(t.url):Yc(t.url)&&this.load(t.url).catch(t.onerror)}}Su.baseUrl="",Su.downloads=[];class Vu extends Mu{now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return eu(this,void 0,void 0,(function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const n=Math.floor(this.sampleRate/128);t&&e%n==0&&(yield new Promise((t=>setTimeout(t,1))))}}))}render(t=!0){return eu(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new Su(e)}))}close(){return Promise.resolve()}constructor(){var t,e,n;super({clockSource:"offline",context:ru(arguments[0])?arguments[0]:(t=arguments[0],e=arguments[1]*arguments[2],n=arguments[2],new Sc(t,e,n)),lookAhead:0,updateInterval:ru(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=ru(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}}const Ou=new class extends Tu{createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,n){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return eu(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}};let Du=Ou;function Ru(){return Du===Ou&&Jc&&Lu(new Mu),Du}function Lu(t){Du=ou(t)?new Mu(t):ru(t)?new Vu(t):t}if(Qc&&!Qc.TONE_SILENCE_LOGGING){let t="v";0;const e=` * Tone.js ${t}14.7.77 * `;console.log(`%c${e}`,"background: #000; color: #fff")}class Iu extends du{static getDefaults(){return{baseUrl:"",onerror:Au,onload:Au,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return Bc(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every((([t,e])=>e.loaded))}add(t,e,n=Au,i=Au){return Yc(e)?this._buffers.set(t.toString(),new Su(this.baseUrl+e,n,i)):this._buffers.set(t.toString(),new Su(e,n,i)),this}dispose(){return super.dispose(),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this}constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=uu(Iu.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach((e=>{this._loadingCount++;const n=t.urls[e];this.add(e,n,this._bufferLoaded.bind(this,t.onload),t.onerror)}))}}function Nu(t){return Math.pow(10,t/20)}function Fu(t){return Math.log(t)/Math.LN10*20}function Bu(t){return Math.pow(2,t/12)}let qu=440;function zu(t){return Math.round(ju(t))}function ju(t){return 69+12*Math.log2(t/qu)}function Uu(t){return qu*Math.pow(2,(t-69)/12)}class Wu extends du{_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const n=parseInt(t,10),i="."===e?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/n)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,n)=>{let i=0;return t&&"0"!==t&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(i+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(i+=this._beatsToUnits(parseFloat(n)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Wu&&this.fromType(this._val),Wc(this._val))return this._noArg();if(Yc(this._val)&&Wc(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(Hc(this._val)){let t=0;for(const e in this._val)if(Gc(this._val[e])){const n=this._val[e];t+=new this.constructor(this.context,e).valueOf()*n}return t}if(Gc(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return Yc(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}constructor(t,e,n){super(),this.defaultUnits="s",this._val=e,this._units=n,this.context=t,this._expressions=this._getExpressions()}}class Gu extends Wu{_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new Gu(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const n=new this.constructor(this.context,t).valueOf(),i=this.valueOf();return i+(Math.round(i/n)*n-i)*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let t=1;t<9;t++){const n=Math.pow(2,t);e.push(n+"n."),e.push(n+"n"),e.push(n+"t")}e.push("0");let n=e[0],i=new Gu(this.context,e[0]).toSeconds();return e.forEach((e=>{const s=new Gu(this.context,e).toSeconds();Math.abs(s-t)<Math.abs(i-t)&&(n=e,i=s)})),n}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const n=Math.floor(e/this._getTimeSignature());let i=e%1*4;e=Math.floor(e)%this._getTimeSignature();const s=i.toString();s.length>3&&(i=parseFloat(parseFloat(s).toFixed(3)));return[n,e,i].join(":")}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return zu(this.toFrequency())}_now(){return this.context.now()}constructor(){super(...arguments),this.name="TimeClass"}}class Ku extends Gu{static get A4(){return qu}static set A4(t){!function(t){qu=t}(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:Ku.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,e){const n=Hu[t.toLowerCase()]+12*(parseInt(e,10)+1);return"midi"===this.defaultUnits?n:Ku.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,n){let i=1;return t&&"0"!==t&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(i*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(i*=this._beatsToUnits(parseFloat(n)/4)),i}}})}transpose(t){return new Ku(this.context,this.valueOf()*Bu(t))}harmonize(t){return t.map((t=>this.transpose(t)))}toMidi(){return zu(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/Ku.A4);let n=Math.round(12*e)+57;const i=Math.floor(n/12);i<0&&(n+=-12*i);return $u[n%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return Uu(t)}static ftom(t){return zu(t)}constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}}const Hu={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},$u=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Xu extends Gu{_now(){return this.context.transport.seconds}constructor(){super(...arguments),this.name="TransportTime"}}class Yu extends du{static getDefaults(){return{context:Ru()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new Gu(this.context,t).toSeconds()}toFrequency(t){return new Ku(this.context,t).toFrequency()}toTicks(t){return new Xu(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach((n=>{Wc(t[n])&&delete e[n]})),e}get(){const t=this.constructor.getDefaults();return Object.keys(t).forEach((e=>{if(Reflect.has(this,e)){const n=this[e];Gc(n)&&Gc(n.value)&&Gc(n.setValueAtTime)?t[e]=n.value:n instanceof Yu?t[e]=n._getPartialProperties(t[e]):Xc(n)||Kc(n)||Yc(n)||$c(n)?t[e]=n:delete t[e]}})),t}set(t){return Object.keys(t).forEach((e=>{Reflect.has(this,e)&&Gc(this[e])&&(this[e]&&Gc(this[e].value)&&Gc(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof Yu?this[e].set(t[e]):this[e]=t[e])})),this}constructor(){super();const t=uu(Yu.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}}class Zu extends Yu{static getDefaults(){return Object.assign(Yu.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return Gc(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return Gc(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return Gc(this.maxValue)&&Gc(this.minValue)&&qc(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?Nu(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&"decibels"===this.units?Fu(t):t}setValueAtTime(t,e){const n=this.toSeconds(e),i=this._fromType(t);return Bc(isFinite(i)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",t,n),this._events.add({time:n,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,n),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),n=this._events.getAfter(e),i=this._events.get(e);let s=this._initialValue;if(null===i)s=this._initialValue;else if("setTargetAtTime"!==i.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)s=i.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let t=i.value;if("setTargetAtTime"===i.type){const e=this._events.getBefore(i.time);t=null===e?this._initialValue:e.value}s="linearRampToValueAtTime"===n.type?this._linearInterpolate(i.time,t,n.time,n.value,e):this._exponentialInterpolate(i.time,t,n.time,n.value,e)}else s=i.value;else{const t=this._events.getBefore(i.time);let n;n=null===t?this._initialValue:t.value,"setTargetAtTime"===i.type&&(s=this._exponentialApproach(i.time,n,i.value,i.constant,e))}return this._toType(s)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const n=this._fromType(t),i=this.toSeconds(e);return Bc(isFinite(n)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this._events.add({time:i,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",t,i),this._param.linearRampToValueAtTime(n,i),this}exponentialRampToValueAtTime(t,e){let n=this._fromType(t);n=_u(n,0)?this._minOutput:n,this._assertRange(n);const i=this.toSeconds(e);return Bc(isFinite(n)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",t,i),this._param.exponentialRampToValueAtTime(n,i),this}exponentialRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this}linearRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this}targetRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this}exponentialApproachValueAtTime(t,e,n){e=this.toSeconds(e),n=this.toSeconds(n);const i=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(t,e,i),this.cancelAndHoldAtTime(e+.9*n),this.linearRampToValueAtTime(t,e+n),this}setTargetAtTime(t,e,n){const i=this._fromType(t);Bc(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const s=this.toSeconds(e);return this._assertRange(i),Bc(isFinite(i)&&isFinite(s),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:n,time:s,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",t,s,n),this._param.setTargetAtTime(i,s,n),this}setValueCurveAtTime(t,e,n,i=1){n=this.toSeconds(n),e=this.toSeconds(e);const s=this._fromType(t[0])*i;this.setValueAtTime(this._toType(s),e);const r=n/(t.length-1);for(let n=1;n<t.length;n++){const s=this._fromType(t[n])*i;this.linearRampToValueAtTime(this._toType(s),e+n*r)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return Bc(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),n=this._fromType(this.getValueAtTime(e));Bc(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+n);const i=this._events.get(e),s=this._events.getAfter(e);return i&&_u(i.time,e)?s?(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):s&&(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time),"linearRampToValueAtTime"===s.type?this.linearRampToValueAtTime(this._toType(n),e):"exponentialRampToValueAtTime"===s.type&&this.exponentialRampToValueAtTime(this._toType(n),e)),this._events.add({time:e,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,e),this}rampTo(t,e=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,n):this.linearRampTo(t,e,n),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const n=this._events.get(e);if(n&&"setTargetAtTime"===n.type){const i=this._events.getAfter(n.time),s=i?i.time:e+2,r=(s-e)/10;for(let n=e;n<s;n+=r)t.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,(e=>{"cancelScheduledValues"===e.type?t.cancelScheduledValues(e.time):"setTargetAtTime"===e.type?t.setTargetAtTime(e.value,e.time,e.constant):t[e.type](e.value,e.time)})),this}setParam(t){Bc(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,n,i,s){return n+(e-n)*Math.exp(-(s-t)/i)}_linearInterpolate(t,e,n,i,s){return e+(s-t)/(n-t)*(i-e)}_exponentialInterpolate(t,e,n,i,s){return e*Math.pow(i/e,(s-t)/(n-t))}constructor(){super(uu(Zu.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const t=uu(Zu.getDefaults(),arguments,["param","units","convert"]);for(Bc(Gc(t.param)&&(iu(t.param)||t.param instanceof Zu),"param must be an AudioParam");!iu(t.param);)t.param=t.param._param;this._swappable=!!Gc(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new bu(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,Gc(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}}class Qu extends Yu{get numberOfInputs(){return Gc(this.input)?iu(this.input)||this.input instanceof Zu?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Gc(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return Gc(t)&&(t instanceof Qu||su(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach((e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation}))}_getChannelProperties(){const t=this._getInternalNodes();Bc(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,n=0){return th(this,t,e,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Uc("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,n=0){return eh(this,t,e,n),this}chain(...t){return Ju(this,...t),this}fan(...t){return t.forEach((t=>this.connect(t))),this}dispose(){return super.dispose(),Gc(this.input)&&(this.input instanceof Qu?this.input.dispose():su(this.input)&&this.input.disconnect()),Gc(this.output)&&(this.output instanceof Qu?this.output.dispose():su(this.output)&&this.output.disconnect()),this._internalChannels=[],this}constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}}function Ju(...t){const e=t.shift();t.reduce(((t,e)=>(t instanceof Qu?t.connect(e):su(t)&&th(t,e),e)),e)}function th(t,e,n=0,i=0){for(Bc(Gc(t),"Cannot connect from undefined node"),Bc(Gc(e),"Cannot connect to undefined node"),(e instanceof Qu||su(e))&&Bc(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Bc(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof Qu||e instanceof Zu;)Gc(e.input)&&(e=e.input);for(;t instanceof Qu;)Gc(t.output)&&(t=t.output);iu(e)?t.connect(e,n):t.connect(e,n,i)}function eh(t,e,n=0,i=0){if(Gc(e))for(;e instanceof Qu;)e=e.input;for(;!su(t);)Gc(t.output)&&(t=t.output);iu(e)?t.disconnect(e,n):su(e)?t.disconnect(e,n,i):t.disconnect()}class nh extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}constructor(){super(uu(nh.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const t=uu(nh.getDefaults(),arguments,["gain","units"]);this.gain=new Zu({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),ku(this,"gain")}}class ih extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Au})}_startGain(t,e=1){Bc(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=t+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+n):this._gainNode.gain.exponentialApproachValueAtTime(e,t,n)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){Bc(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.context.currentTime),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Au&&(this.onended(this),this.onended=Au,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Bc(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}constructor(t){super(t),this.onended=Au,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new nh({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const e=this.toSeconds(t);return-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}}class sh extends ih{static getDefaults(){return Object.assign(ih.getDefaults(),{url:new Su,loop:!1,loopEnd:0,loopStart:0,onload:Au,onerror:Au,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,n,i=1){Bc(this.buffer.loaded,"buffer is either not set or not loaded");const s=this.toSeconds(t);this._startGain(s,i),e=this.loop?hu(e,this.loopStart):hu(e,0);let r=Math.max(this.toSeconds(e),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),n=t-e;mu(r,t)&&(r=(r-e)%n+e),_u(r,this.buffer.duration)&&(r=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,fu(r,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(s,r)),Gc(n)){let t=this.toSeconds(n);t=Math.max(t,0),this.stop(s+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}constructor(){super(uu(sh.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const t=uu(sh.getDefaults(),arguments,["url","onload"]);th(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Zu({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new Su(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}}class rh extends Yu{schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new bu,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}}xu((t=>{t.draw=new rh({context:t})})),Cu((t=>{t.draw.dispose()}));class oh extends bu{getValueAtTime(t){const e=this.get(t);return null!==e?e.state:this._initial}setStateAtTime(t,e,n){return qc(e,0),this.add(Object.assign({},n,{state:t,time:e})),this}getLastState(t,e){for(let n=this._search(e);n>=0;n--){const e=this._timeline[n];if(e.state===t)return e}}getNextState(t,e){const n=this._search(e);if(-1!==n)for(let e=n;e<this._timeline.length;e++){const n=this._timeline[e];if(n.state===t)return n}}constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}}class ah extends ih{static getDefaults(){return Object.assign(ih.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}constructor(){super(uu(ah.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const t=uu(ah.getDefaults(),arguments,["offset"]);th(this._source,this._gainNode),this.offset=new Zu({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}}class lh extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,n=0){return ch(this,t,e,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,n){return this._param.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){return this._param.linearRampTo(t,e,n),this}targetRampTo(t,e,n){return this._param.targetRampTo(t,e,n),this}exponentialApproachValueAtTime(t,e,n){return this._param.exponentialApproachValueAtTime(t,e,n),this}setTargetAtTime(t,e,n){return this._param.setTargetAtTime(t,e,n),this}setValueCurveAtTime(t,e,n,i){return this._param.setValueCurveAtTime(t,e,n,i),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,n){return this._param.rampTo(t,e,n),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}constructor(){super(uu(lh.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const t=uu(lh.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new ah({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}}function ch(t,e,n,i){(e instanceof Zu||iu(e)||e instanceof lh&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof lh&&(e.overridden=!0)),th(t,e,n,i)}class uh extends Zu{static getDefaults(){return Object.assign(Zu.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,n){e=this.toSeconds(e),this.setRampPoint(e);const i=this._fromType(t),s=this._events.get(e),r=Math.round(Math.max(1/n,1));for(let t=0;t<=r;t++){const r=n*t+e,o=this._exponentialApproach(s.time,s.value,i,n,r);this.linearRampToValueAtTime(this._toType(o),r)}return this}setValueAtTime(t,e){const n=this.toSeconds(e);super.setValueAtTime(t,e);const i=this._events.get(n),s=this._events.previousEvent(i),r=this._getTicksUntilEvent(s,n);return i.ticks=Math.max(r,0),this}linearRampToValueAtTime(t,e){const n=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const i=this._events.get(n),s=this._events.previousEvent(i),r=this._getTicksUntilEvent(s,n);return i.ticks=Math.max(r,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const n=this._fromType(t),i=this._events.get(e),s=Math.round(Math.max(10*(e-i.time),1)),r=(e-i.time)/s;for(let t=0;t<=s;t++){const s=r*t+i.time,o=this._exponentialInterpolate(i.time,i.value,e,n,s);this.linearRampToValueAtTime(this._toType(o),s)}return this}_getTicksUntilEvent(t,e){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Wc(t.ticks)){const e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}const n=this._fromType(this.getValueAtTime(t.time));let i=this._fromType(this.getValueAtTime(e));const s=this._events.get(e);return s&&s.time===e&&"setValueAtTime"===s.type&&(i=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(n+i)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),n=this._events.get(e);return Math.max(this._getTicksUntilEvent(n,e),0)}getDurationOfTicks(t,e){const n=this.toSeconds(e),i=this.getTicksAtTime(e);return this.getTimeOfTick(i+t)-n}getTimeOfTick(t){const e=this._events.get(t,"ticks"),n=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&n&&"linearRampToValueAtTime"===n.type&&e.value!==n.value){const i=this._fromType(this.getValueAtTime(e.time)),s=(this._fromType(this.getValueAtTime(n.time))-i)/(n.time-e.time),r=Math.sqrt(Math.pow(i,2)-2*s*(e.ticks-t)),o=(-i+r)/s,a=(-i-r)/s;return(o>0?o:a)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const n=this.toSeconds(e),i=this.toSeconds(t),s=this.getTicksAtTime(n);return this.getTicksAtTime(n+i)-s}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}constructor(){super(uu(uh.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new bu(1/0),this._multiplier=1;const t=uu(uh.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}}class hh extends lh{static getDefaults(){return Object.assign(lh.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}constructor(){super(uu(hh.getDefaults(),arguments,["value"])),this.name="TickSignal";const t=uu(hh.getDefaults(),arguments,["value"]);this.input=this._param=new uh({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}}class ph extends Yu{static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Yu.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const n=this.toSeconds(t);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),Gc(e)&&this.setTicksAtTime(e,n)),this}stop(t){const e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){const t=this._state.get(e);t&&t.time>0&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&this._state.setStateAtTime("paused",e),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),n=this._state.getLastState("stopped",e),i={state:"paused",time:e};this._state.add(i);let s=n,r=0;return this._state.forEachBetween(n.time,e+this.sampleTime,(t=>{let e=s.time;const n=this._tickOffset.get(t.time);n&&n.time>=s.time&&(r=n.ticks,e=n.time),"started"===s.state&&"started"!==t.state&&(r+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),s=t})),this._state.remove(i),r}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),n=this.frequency.timeToTicks(t,e);this.setTicksAtTime(n,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let i=e,s=0;return this._state.forEachBetween(e.time,t+this.sampleTime,(t=>{let e=i.time;const n=this._tickOffset.get(t.time);n&&n.time>=i.time&&(s=n.seconds,e=n.time),"started"===i.state&&"started"!==t.state&&(s+=t.time-e),i=t})),this._state.remove(n),s}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const n=this._tickOffset.get(e),i=this._state.get(e),s=Math.max(n.time,i.time),r=this.frequency.getTicksAtTime(s)+t-n.ticks;return this.frequency.getTimeOfTick(r)}forEachTickBetween(t,e,n){let i=this._state.get(t);this._state.forEachBetween(t,e,(e=>{i&&"started"===i.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(i.time,t),e.time-this.sampleTime,n),i=e}));let s=null;if(i&&"started"===i.state){const r=Math.max(i.time,t),o=this.frequency.getTicksAtTime(r),a=o-this.frequency.getTicksAtTime(i.time);let l=Math.ceil(a)-a;l=_u(l,1)?0:l;let c=this.frequency.getTimeOfTick(o+l);for(;c<e;){try{n(c,Math.round(this.getTicksAtTime(c)))}catch(t){s=t;break}c+=this.frequency.getDurationOfTicks(1,c)}}if(s)throw s;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}constructor(){super(uu(ph.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new oh,this._tickOffset=new bu;const t=uu(ph.getDefaults(),arguments,["frequency"]);this.frequency=new hh({context:this.context,units:t.units,value:t.frequency}),ku(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}}class dh extends Yu{static getDefaults(){return Object.assign(Yu.getDefaults(),{callback:Au,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){zc(this.context);const n=this.toSeconds(t);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,e),n<this._lastUpdate&&this.emit("start",n,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const n=this.toSeconds(e),i=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(i+t,n)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,(t=>{switch(t.state){case"started":const e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}})),this._tickSource.forEachTickBetween(t,e,((t,e)=>{this.callback(t,e)})))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}constructor(){super(uu(dh.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=Au,this._lastUpdate=0,this._state=new oh("stopped"),this._boundLoop=this._loop.bind(this);const t=uu(dh.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new ph({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,ku(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}}Eu.mixin(dh);class vh extends Xu{_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}}class mh extends du{add(t){Bc(Gc(t.time),"Events must have a time property"),Bc(Gc(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new fh(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){const e=[];this._root.search(t.time,e);for(const n of e)if(n.event===t){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,(t=>this.remove(t))),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{let e,n=null;if(t.getBalance()>0)if(null===t.left.right)e=t.left,e.right=t.right,n=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent&&(e.parent.right=e.left,n=e.parent,e.left=t.left,e.right=t.right)}else if(null===t.right.left)e=t.right,e.left=t.left,n=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent&&(e.parent.left=e.right,n=e.parent,e.left=t.left,e.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),n&&this._rebalance(n)}t.dispose()}_rotateLeft(t){const e=t.parent,n=t.isLeftChild(),i=t.right;i&&(t.right=i.left,i.left=t),null!==e?n?e.left=i:e.right=i:this._setRoot(i)}_rotateRight(t){const e=t.parent,n=t.isLeftChild(),i=t.left;i&&(t.left=i.right,i.right=t),null!==e?n?e.left=i:e.right=i:this._setRoot(i)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){const e=[];if(this._root.search(t,e),e.length>0){let t=e[0];for(let n=1;n<e.length;n++)e[n].low>t.low&&(t=e[n]);return t.event}}return null}forEach(t){if(null!==this._root){const e=[];this._root.traverse((t=>e.push(t))),e.forEach((e=>{e.event&&t(e.event)}))}return this}forEachAtTime(t,e){if(null!==this._root){const n=[];this._root.search(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}forEachFrom(t,e){if(null!==this._root){const n=[];this._root.searchAfter(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((t=>t.dispose())),this._root=null,this}constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}}class fh{insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}constructor(t,e,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=t,this.high=e,this.max=this.high}}class _h extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}constructor(){super(uu(_h.getDefaults(),arguments,["volume"])),this.name="Volume";const t=uu(_h.getDefaults(),arguments,["volume"]);this.input=this.output=new nh({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,ku(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}}class gh extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),Ju(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}constructor(){super(uu(gh.getDefaults(),arguments)),this.name="Destination",this.input=new _h({context:this.context}),this.output=new nh({context:this.context}),this.volume=this.input.volume;const t=uu(gh.getDefaults(),arguments);Ju(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}}xu((t=>{t.destination=new gh({context:t})})),Cu((t=>{t.destination.dispose()}));class bh extends du{set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}constructor(t){super(),this.name="TimelineValue",this._timeline=new bu({memory:10}),this._initialValue=t}}class wh{static getDefaults(){return{callback:Au,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}constructor(t,e){this.id=wh._eventId++;const n=Object.assign(wh.getDefaults(),e);this.transport=t,this.callback=n.callback,this._once=n.once,this.time=n.time}}wh._eventId=0;class xh extends wh{static getDefaults(){return Object.assign({},wh.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){const e=this.transport.getTicksAtTime(t);e>=this.time&&e>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new vh(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const e=this.transport.getTicksAtTime(t);e>this.time&&(this._nextTick=this.time+Math.ceil((e-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new vh(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new vh(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(xh.getDefaults(),e);this.duration=new vh(t.context,n.duration).valueOf(),this._interval=new vh(t.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}}class yh extends Yu{static getDefaults(){return Object.assign(Yu.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){const n=e%(2*this._swingTicks)/(2*this._swingTicks),i=Math.sin(n*Math.PI)*this._swingAmount;t+=new vh(this.context,2*this._swingTicks/3).toSeconds()*i}this._timeline.forEachAtTime(e,(e=>e.invoke(t)))}schedule(t,e){const n=new wh(this,{callback:t,time:new Xu(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(t,e,n,i=1/0){const s=new xh(this,{callback:t,duration:new Gu(this.context,i).toTicks(),interval:new Gu(this.context,e).toTicks(),time:new Xu(this.context,n).toTicks()});return this._addEvent(s,this._repeatedEvents)}scheduleOnce(t,e){const n=new wh(this,{callback:t,once:!0,time:new Xu(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,(t=>this.clear(t.id))),this._repeatedEvents.forEachFrom(e,(t=>this.clear(t.id))),this}_bindClockEvents(){this._clock.on("start",((t,e)=>{e=new vh(this.context,e).toSeconds(),this.emit("start",t,e)})),this._clock.on("stop",(t=>{this.emit("stop",t)})),this._clock.on("pause",(t=>{this.emit("pause",t)}))}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let n;return Gc(e)&&(n=this.toTicks(e)),this._clock.start(t,n),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){Xc(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new Gu(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new Gu(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new vh(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new vh(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),n=this._clock.frequency.timeToTicks(t,e);this.ticks=n}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(e),i=e+this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,e);this.emit("stop",i),this._clock.setTicksAtTime(t,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{const e=this.now(),n=t-this.getTicksAtTime(e)%t;return this._clock.nextTickTime(n,e)}}syncSignal(t,e){if(!e){const n=this.now();if(0!==t.getValueAtTime(n)){const i=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);e=t.getValueAtTime(n)/i}else e=0}const n=new nh(e);return this.bpm.connect(n),n.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:n,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const n=this._syncedSignals[e];n.signal===t&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Pu(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}constructor(){super(uu(yh.getDefaults(),arguments)),this.name="Transport",this._loop=new bh(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new bu,this._repeatedEvents=new mh,this._syncedSignals=[],this._swingAmount=0;const t=uu(yh.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new dh({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),ku(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}}Eu.mixin(yh),xu((t=>{t.transport=new yh({context:t})})),Cu((t=>{t.transport.dispose()}));class Ch extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{mute:!1,onstop:Au,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,n){let i=Wc(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(i=this._clampToCurrentTime(i),this._synced||"started"!==this._state.getValueAtTime(i))if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const t=this._state.get(i);t&&(t.offset=this.toSeconds(hu(e,0)),t.duration=n?this.toSeconds(n):void 0);const s=this.context.transport.schedule((t=>{this._start(t,e,n)}),i);this._scheduled.push(s),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else zc(this.context),this._start(i,e,n);else Bc(vu(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,e,n);return this}stop(t){let e=Wc(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||Gc(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,n){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(e>0){const n=this._state.get(e);if(n&&"started"===n.state&&n.time!==e){const i=e-this.toSeconds(n.time);let s;n.duration&&(s=this.toSeconds(n.duration)-i),this._start(t,this.toSeconds(n.offset)+i,s)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((t=>this.context.transport.clear(t))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Au,this.unsync(),this._volume.dispose(),this._state.dispose(),this}constructor(t){super(t),this.input=void 0,this._state=new oh("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Au,this._syncedStop=Au,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new _h({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,ku(this,"volume"),this.onstop=t.onstop}}function Eh(t,e){return eu(this,void 0,void 0,(function*(){const n=e/t.context.sampleRate,i=new Vu(1,n,t.context.sampleRate);new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:i})).toDestination().start(0);return(yield i.render()).getChannelData(0)}))}class Th extends ih{static getDefaults(){return Object.assign(ih.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}constructor(){super(uu(Th.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const t=uu(Th.getDefaults(),arguments,["frequency","type"]);th(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new Zu({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new Zu({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),ku(this,["frequency","detune"])}}class Mh extends Ch{static getDefaults(){return Object.assign(Ch.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),n=new Th({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){return Mh._periodicWaveCache.find((t=>{return t.phase===this._phase&&(e=t.partials,n=this._partials,e.length===n.length&&e.every(((t,e)=>n[e]===t)));var e,n}))}{const t=Mh._periodicWaveCache.find((t=>t.type===this._type&&t.phase===this._phase));return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const e=this._getCachedPeriodicWave();if(Gc(e)){const{partials:t,wave:n}=e;this._wave=n,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[e,n]=this._getRealImaginary(t,this._phase),i=this.context.createPeriodicWave(e,n);this._wave=i,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),Mh._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),Mh._periodicWaveCache.length>100&&Mh._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){qc(t,0);let e=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(e=n[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{const e=new Float32Array(t);this._partials.forEach(((t,n)=>e[n]=t)),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){let n=2048;const i=new Float32Array(n),s=new Float32Array(n);let r=1;if("custom"===t){if(r=this._partials.length+1,this._partialCount=this._partials.length,n=r,0===this._partials.length)return[i,s]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(r=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],r=Math.max(r,2),n=r):this._partialCount=0,this._partials=[]}for(let o=1;o<n;++o){const n=2/(o*Math.PI);let a;switch(t){case"sine":a=o<=r?1:0,this._partials[o-1]=a;break;case"square":a=1&o?2*n:0,this._partials[o-1]=a;break;case"sawtooth":a=n*(1&o?1:-1),this._partials[o-1]=a;break;case"triangle":a=1&o?n*n*2*(o-1>>1&1?-1:1):0,this._partials[o-1]=a;break;case"custom":a=this._partials[o-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==a?(i[o]=-a*Math.sin(e*o),s[o]=a*Math.cos(e*o)):(i[o]=0,s[o]=0)}return[i,s]}_inverseFFT(t,e,n){let i=0;const s=t.length;for(let r=0;r<s;r++)i+=t[r]*Math.cos(r*n)+e[r]*Math.sin(r*n);return i}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let n=0;const i=2*Math.PI;for(let s=0;s<32;s++)n=Math.max(this._inverseFFT(t,e,s/32*i),n);return gu(-this._inverseFFT(t,e,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return eu(this,void 0,void 0,(function*(){return Eh(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}constructor(){super(uu(Mh.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const t=uu(Mh.getDefaults(),arguments,["frequency","type"]);this.frequency=new lh({context:this.context,units:"frequency",value:t.frequency}),ku(this,"frequency"),this.detune=new lh({context:this.context,units:"cents",value:t.detune}),ku(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}}Mh._periodicWaveCache=[];class kh extends Qu{connect(t,e=0,n=0){return ch(this,t,e,n),this}constructor(){super(Object.assign(uu(kh.getDefaults(),arguments,["context"])))}}class Ph extends kh{static getDefaults(){return Object.assign(lh.getDefaults(),{length:1024})}setMap(t,e=1024){const n=new Float32Array(e);for(let i=0,s=e;i<s;i++){const e=i/(s-1)*2-1;n[i]=t(e,i)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){Bc(["none","2x","4x"].some((e=>e.includes(t))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}constructor(){super(Object.assign(uu(Ph.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const t=uu(Ph.getDefaults(),arguments,["mapping","length"]);Xc(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):"function"==typeof t.mapping&&this.setMap(t.mapping,t.length)}}class Ah extends kh{dispose(){return super.dispose(),this._norm.dispose(),this}constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Ph({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}}class Sh extends lh{static getDefaults(){return Object.assign(lh.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}constructor(){super(Object.assign(uu(Sh.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const t=uu(Sh.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new nh({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}}class Vh extends Ch{static getDefaults(){return Object.assign(Mh.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return eu(this,void 0,void 0,(function*(){return Eh(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}constructor(){super(uu(Vh.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new Ah({context:this.context}),this._modulationNode=new nh({context:this.context});const t=uu(Vh.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Mh({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Mh({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Sh({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),ku(this,["frequency","detune","harmonicity"])}}class Oh extends Ch{static getDefaults(){return Object.assign(Mh.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return eu(this,void 0,void 0,(function*(){return Eh(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}constructor(){super(uu(Oh.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new nh({context:this.context,gain:0});const t=uu(Oh.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Mh({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new lh({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new Mh({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Sh({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new Sh({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),ku(this,["modulationIndex","frequency","detune","harmonicity"])}}class Dh extends Ch{static getDefaults(){return Object.assign(Ch.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return eu(this,void 0,void 0,(function*(){return Eh(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}constructor(){super(uu(Dh.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new nh({context:this.context,gain:0}),this._thresh=new Ph({context:this.context,mapping:t=>t<=0?-1:1});const t=uu(Dh.getDefaults(),arguments,["frequency","width"]);this.width=new lh({context:this.context,units:"audioRange",value:t.width}),this._triangle=new Mh({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),ku(this,["width","frequency","detune"])}}class Rh extends Ch{static getDefaults(){return Object.assign(Mh.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach((e=>e.start(t)))}_stop(t){t=this.toSeconds(t),this._forEach((e=>e.stop(t)))}_restart(t){this._forEach((e=>e.restart(t)))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach((e=>e.type=t))}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,n=t/(this._oscillators.length-1);this._forEach(((t,i)=>t.detune.value=e+n*i))}}get count(){return this._oscillators.length}set count(t){if(qc(t,1),this._oscillators.length!==t){this._forEach((t=>t.dispose())),this._oscillators=[];for(let e=0;e<t;e++){const n=new Mh({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):Au});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[e]=n}this.spread=this._spread,"started"===this.state&&this._forEach((t=>t.start()))}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach(((t,e)=>t.phase=this._phase+e/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach((e=>e.baseType=t)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach((e=>e.partials=t)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach((e=>e.partialCount=t)),this._type=this._oscillators[0].type}asArray(t=1024){return eu(this,void 0,void 0,(function*(){return Eh(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((t=>t.dispose())),this}constructor(){super(uu(Rh.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const t=uu(Rh.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new lh({context:this.context,units:"frequency",value:t.frequency}),this.detune=new lh({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,ku(this,["frequency","detune"])}}class Lh extends Ch{static getDefaults(){return Object.assign(Ch.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return eu(this,void 0,void 0,(function*(){return Eh(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}constructor(){super(uu(Lh.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Sh({context:this.context,value:2});const t=uu(Lh.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Dh({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Mh({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),ku(this,["modulationFrequency","frequency","detune"])}}const Ih={am:Vh,fat:Rh,fm:Oh,oscillator:Mh,pulse:Dh,pwm:Lh};class Nh extends Ch{static getDefaults(){return Object.assign(Mh.getDefaults(),Oh.getDefaults(),Vh.getDefaults(),Rh.getDefaults(),Dh.getDefaults(),Lh.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some((t=>this._sourceType===t))&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=Ih[t],n=this.now();if(this._oscillator){const t=this._oscillator;t.stop(n),this.context.setTimeout((()=>t.dispose()),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof Ih[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&Kc(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&Kc(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Yc(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return eu(this,void 0,void 0,(function*(){return Eh(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}constructor(){super(uu(Nh.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const t=uu(Nh.getDefaults(),arguments,["frequency","type"]);this.frequency=new lh({context:this.context,units:"frequency",value:t.frequency}),this.detune=new lh({context:this.context,units:"cents",value:t.detune}),ku(this,["frequency","detune"]),this.set(t)}}class Fh extends lh{static getDefaults(){return Object.assign(lh.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}constructor(){super(Object.assign(uu(Fh.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new nh({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,Ju(this._constantSource,this._sum)}}class Bh extends kh{static getDefaults(){return Object.assign(kh.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}constructor(){super(Object.assign(uu(Bh.getDefaults(),arguments,["min","max"]))),this.name="Scale";const t=uu(Bh.getDefaults(),arguments,["min","max"]);this._mult=this.input=new Sh({context:this.context,value:t.max-t.min}),this._add=this.output=new Fh({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}}function qh(t,e=1/0){const n=new WeakMap;return function(i,s){Reflect.defineProperty(i,s,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(i){qc(i,t,e),n.set(this,i)}})}}function zh(t,e=1/0){const n=new WeakMap;return function(i,s){Reflect.defineProperty(i,s,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(i){qc(this.toSeconds(i),t,e),n.set(this,i)}})}}class jh extends Ch{static getDefaults(){return Object.assign(Ch.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Au,onerror:Au,playbackRate:1,reverse:!1})}load(t){return eu(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=Au){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,n){return super.start(t,e,n),this}_start(t,e,n){e=this._loop?hu(e,this._loopStart):hu(e,0);const i=this.toSeconds(e),s=n;n=hu(n,Math.max(this._buffer.duration-i,0));let r=this.toSeconds(n);r/=this._playbackRate,t=this.toSeconds(t);const o=new sh({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+r),this._state.setStateAtTime("stopped",t+r,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&Wc(s)?o.start(t,i):o.start(t,i,r-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach((t=>t.stop(e)))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}seek(t,e){const n=this.toSeconds(e);if("started"===this._state.getValueAtTime(n)){const e=this.toSeconds(t);this._stop(n),this._start(n,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&qc(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopStart=t}))}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&qc(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopEnd=t}))}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach((e=>{e.loop=t})),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),n=this._state.getNextState("stopped",e);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach((t=>t.cancelStop()))),this._activeSources.forEach((n=>{n.playbackRate.setValueAtTime(t,e)}))}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((t=>t.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}constructor(){super(uu(jh.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=uu(jh.getDefaults(),arguments,["url","onload"]);this._buffer=new Su({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}}tu([zh(0)],jh.prototype,"fadeIn",void 0),tu([zh(0)],jh.prototype,"fadeOut",void 0);class Uh extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(Yc(t))return t;{let n;for(n in Wh)if(Wh[n][e]===t)return n;return t}}_setCurve(t,e,n){if(Yc(n)&&Reflect.has(Wh,n)){const i=Wh[n];Hc(i)?"_decayCurve"!==t&&(this[t]=i[e]):this[t]=i}else{if(!Xc(n)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+n);this[t]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){Bc(["linear","exponential"].some((e=>e===t)),`Invalid envelope curve: ${t}`),this._decayCurve=t}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let n=this.toSeconds(this.attack);const i=this.toSeconds(this.decay),s=this.getValueAtTime(t);if(s>0){n=(1-s)/(1/n)}if(n<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if("linear"===this._attackCurve)this._sig.linearRampTo(e,n,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(e,n,t);else{this._sig.cancelAndHoldAtTime(t);let i=this._attackCurve;for(let t=1;t<i.length;t++)if(i[t-1]<=s&&s<=i[t]){i=this._attackCurve.slice(t),i[0]=s;break}this._sig.setValueCurveAtTime(i,t,n,e)}if(i&&this.sustain<1){const s=e*this.sustain,r=t+n;this.log("decay",r),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(s,i+r):this._sig.exponentialApproachValueAtTime(s,r,i)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,t):(Bc(Xc(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,n,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,n=0){return ch(this,t,e,n),this}asArray(t=1024){return eu(this,void 0,void 0,(function*(){const e=t/this.context.sampleRate,n=new Vu(1,e,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),s=i+this.toSeconds(this.release),r=.1*s,o=s+r,a=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/o,decay:e*this.toSeconds(this.decay)/o,release:e*this.toSeconds(this.release)/o,context:n}));a._sig.toDestination(),a.triggerAttackRelease(e*(i+r)/o,0);return(yield n.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}constructor(){super(uu(Uh.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new lh({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const t=uu(Uh.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}}tu([zh(0)],Uh.prototype,"attack",void 0),tu([zh(0)],Uh.prototype,"decay",void 0),tu([qh(0,1)],Uh.prototype,"sustain",void 0),tu([zh(0)],Uh.prototype,"release",void 0);const Wh=(()=>{const t=128;let e,n;const i=[];for(e=0;e<t;e++)i[e]=Math.sin(e/127*(Math.PI/2));const s=[];for(e=0;e<127;e++){n=e/127;const t=Math.sin(n*(2*Math.PI)*6.4-Math.PI/2)+1;s[e]=t/10+.83*n}s[127]=1;const r=[];for(e=0;e<t;e++)r[e]=Math.ceil(e/127*5)/5;const o=[];for(e=0;e<t;e++)n=e/127,o[e]=.5*(1-Math.cos(Math.PI*n));const a=[];for(e=0;e<t;e++){n=e/127;const t=4*Math.pow(n,3)+.2,i=Math.cos(t*Math.PI*2*n);a[e]=Math.abs(i*(1-n))}function l(t){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=1-t[n];return e}return{bounce:{In:l(a),Out:a},cosine:{In:i,Out:(c=i,c.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:s,Out:l(s)},sine:{In:o,Out:l(o)},step:{In:r,Out:l(r)}};var c})();class Gh extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const n=this["_original_"+t]=this[t];this[t]=(...t)=>{const i=t[e],s=this.context.transport.schedule((i=>{t[e]=i,n.apply(this,t)}),i);this._scheduledEvents.push(s)}}unsync(){return this._scheduledEvents.forEach((t=>this.context.transport.clear(t))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,n,i){const s=this.toSeconds(n),r=this.toSeconds(e);return this.triggerAttack(t,s,i),this.triggerRelease(s+r),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}constructor(){super(uu(Gh.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const t=uu(Gh.getDefaults(),arguments);this._volume=this.output=new _h({context:this.context,volume:t.volume}),this.volume=this._volume.volume,ku(this,"volume")}}class Kh extends Gh{static getDefaults(){return Object.assign(Gh.getDefaults(),{detune:0,onsilence:Au,portamento:0})}triggerAttack(t,e,n=1){this.log("triggerAttack",t,e,n);const i=this.toSeconds(e);return this._triggerEnvelopeAttack(i,n),this.setNote(t,i),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const n=this.toSeconds(e),i=t instanceof Ku?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,t,n)}else this.frequency.setValueAtTime(i,n);return this}constructor(){super(uu(Kh.getDefaults(),arguments));const t=uu(Kh.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}}tu([zh(0)],Kh.prototype,"portamento",void 0);class Hh extends Uh{dispose(){return super.dispose(),this._gainNode.dispose(),this}constructor(){super(uu(Hh.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new nh({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}}class $h extends Kh{static getDefaults(){return Object.assign(Kh.getDefaults(),{envelope:Object.assign(pu(Uh.getDefaults(),Object.keys(Qu.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(pu(Nh.getDefaults(),[...Object.keys(Ch.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}constructor(){super(uu($h.getDefaults(),arguments)),this.name="Synth";const t=uu($h.getDefaults(),arguments);this.oscillator=new Nh(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Hh(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),ku(this,["oscillator","frequency","detune","envelope"])}}class Xh extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(t){Bc(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t),`Invalid filter type: ${t}`),this._filter.type=t}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let n=0;n<t;n++){const i=19980*Math.pow(n/t,2)+20;e[n]=i}const n=new Float32Array(t),i=new Float32Array(t),s=this.context.createBiquadFilter();return s.type=this.type,s.Q.value=this.Q.value,s.frequency.value=this.frequency.value,s.gain.value=this.gain.value,s.getFrequencyResponse(e,n,i),n}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}constructor(){super(uu(Xh.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const t=uu(Xh.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Zu({context:this.context,units:"number",value:t.Q,param:this._filter.Q}),this.frequency=new Zu({context:this.context,units:"frequency",value:t.frequency,param:this._filter.frequency}),this.detune=new Zu({context:this.context,units:"cents",value:t.detune,param:this._filter.detune}),this.gain=new Zu({context:this.context,units:"decibels",convert:!1,value:t.gain,param:this._filter.gain}),this.type=t.type}}class Yh extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(t){Bc(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t),`Invalid filter type: ${t}`),this._type=t,this._filters.forEach((e=>e.type=t))}get rolloff(){return this._rolloff}set rolloff(t){const e=Kc(t)?t:parseInt(t,10),n=[-12,-24,-48,-96];let i=n.indexOf(e);Bc(-1!==i,`rolloff can only be ${n.join(", ")}`),i+=1,this._rolloff=e,this.input.disconnect(),this._filters.forEach((t=>t.disconnect())),this._filters=new Array(i);for(let t=0;t<i;t++){const e=new Xh({context:this.context});e.type=this._type,this.frequency.connect(e.frequency),this.detune.connect(e.detune),this.Q.connect(e.Q),this.gain.connect(e.gain),this._filters[t]=e}this._internalChannels=this._filters,Ju(this.input,...this._internalChannels,this.output)}getFrequencyResponse(t=128){const e=new Xh({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),n=new Float32Array(t).map((()=>1));return this._filters.forEach((()=>{e.getFrequencyResponse(t).forEach(((t,e)=>n[e]*=t))})),e.dispose(),n}dispose(){return super.dispose(),this._filters.forEach((t=>{t.dispose()})),Pu(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}constructor(){super(uu(Yh.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new nh({context:this.context}),this.output=new nh({context:this.context}),this._filters=[];const t=uu(Yh.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new lh({context:this.context,units:"positive",value:t.Q}),this.frequency=new lh({context:this.context,units:"frequency",value:t.frequency}),this.detune=new lh({context:this.context,units:"cents",value:t.detune}),this.gain=new lh({context:this.context,units:"decibels",convert:!1,value:t.gain}),this._type=t.type,this.rolloff=t.rolloff,ku(this,["detune","frequency","gain","Q"])}}const Zh=[1,1.483,1.932,2.546,2.63,3.897];class Qh extends Kh{static getDefaults(){return cu(Kh.getDefaults(),{envelope:Object.assign(pu(Uh.getDefaults(),Object.keys(Qu.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(t,e=1){return this.envelope.triggerAttack(t,e),this._oscillators.forEach((e=>e.start(t))),0===this.envelope.sustain&&this._oscillators.forEach((e=>{e.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))})),this}_triggerEnvelopeRelease(t){return this.envelope.triggerRelease(t),this._oscillators.forEach((e=>e.stop(t+this.toSeconds(this.envelope.release)))),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(t){this._oscillators.forEach((e=>e.modulationIndex.value=t))}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(t){this._oscillators.forEach((e=>e.harmonicity.value=t))}get resonance(){return this._filterFreqScaler.min}set resonance(t){this._filterFreqScaler.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,t)}dispose(){return super.dispose(),this._oscillators.forEach((t=>t.dispose())),this._freqMultipliers.forEach((t=>t.dispose())),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}constructor(){super(uu(Qh.getDefaults(),arguments)),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[];const t=uu(Qh.getDefaults(),arguments);this.detune=new lh({context:this.context,units:"cents",value:t.detune}),this.frequency=new lh({context:this.context,units:"frequency"}),this._amplitude=new nh({context:this.context,gain:0}).connect(this.output),this._highpass=new Yh({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let e=0;e<Zh.length;e++){const n=new Oh({context:this.context,harmonicity:t.harmonicity,modulationIndex:t.modulationIndex,modulationType:"square",onstop:0===e?()=>this.onsilence(this):Au,type:"square"});n.connect(this._highpass),this._oscillators[e]=n;const i=new Sh({context:this.context,value:Zh[e]});this._freqMultipliers[e]=i,this.frequency.chain(i,n.frequency),this.detune.connect(n.detune)}this._filterFreqScaler=new Bh({context:this.context,max:7e3,min:this.toFrequency(t.resonance)}),this.envelope=new Uh({attack:t.envelope.attack,attackCurve:"linear",context:this.context,decay:t.envelope.decay,release:t.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=t.octaves,this.octaves=t.octaves}}class Jh extends $h{static getDefaults(){return cu(Kh.getDefaults(),$h.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const n=this.toSeconds(e),i=this.toFrequency(t instanceof Ku?t.toFrequency():t),s=i*this.octaves;return this.oscillator.frequency.setValueAtTime(s,n),this.oscillator.frequency.exponentialRampToValueAtTime(i,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}constructor(){super(uu(Jh.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const t=uu(Jh.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,ku(this,["oscillator","envelope"])}}tu([qh(0)],Jh.prototype,"octaves",void 0),tu([zh(0)],Jh.prototype,"pitchDecay",void 0);const tp=new Set;function ep(t){tp.add(t)}function np(t,e){const n=`registerProcessor("${t}", ${e})`;tp.add(n)}ep('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n');ep("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n");ep("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");np("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class ip extends Gh{static getDefaults(){return Object.assign(Gh.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Au,onerror:Au,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,n=1){return this.log("triggerAttack",t,e,n),Array.isArray(t)||(t=[t]),t.forEach((t=>{const i=ju(new Ku(this.context,t).toFrequency()),s=Math.round(i),r=i-s,o=this._findClosest(s),a=s-o,l=this._buffers.get(a),c=Bu(o+r),u=new sh({url:l,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:c}).connect(this.output);u.start(e,0,l.duration/c,n),Xc(this._activeSources.get(s))||this._activeSources.set(s,[]),this._activeSources.get(s).push(u),u.onended=()=>{if(this._activeSources&&this._activeSources.has(s)){const t=this._activeSources.get(s),e=t.indexOf(u);-1!==e&&t.splice(e,1)}}})),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach((t=>{const n=new Ku(this.context,t).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const t=this._activeSources.get(n);e=this.toSeconds(e),t.forEach((t=>{t.stop(e)})),this._activeSources.set(n,[])}})),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach((t=>{for(;t.length;){t.shift().stop(e)}})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,n,i=1){const s=this.toSeconds(n);return this.triggerAttack(t,s,i),Xc(e)?(Bc(Xc(t),"notes must be an array when duration is array"),t.forEach(((t,n)=>{const i=e[Math.min(n,e.length-1)];this.triggerRelease(t,s+this.toSeconds(i))}))):this.triggerRelease(t,s+this.toSeconds(e)),this}add(t,e,n){if(Bc(Zc(t)||isFinite(t),`note must be a pitch or midi: ${t}`),Zc(t)){const i=new Ku(this.context,t).toMidi();this._buffers.add(i,e,n)}else this._buffers.add(t,e,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((t=>{t.forEach((t=>t.dispose()))})),this._activeSources.clear(),this}constructor(){super(uu(ip.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const t=uu(ip.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),e={};Object.keys(t.urls).forEach((n=>{const i=parseInt(n,10);if(Bc(Zc(n)||Kc(i)&&isFinite(i),`url key is neither a note or midi pitch: ${n}`),Zc(n)){const i=new Ku(this.context,n).toMidi();e[i]=t.urls[n]}else Kc(i)&&isFinite(i)&&(e[i]=t.urls[i])})),this._buffers=new Iu({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}}tu([zh(0)],ip.prototype,"attack",void 0),tu([zh(0)],ip.prototype,"release",void 0);class sp extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}constructor(){super(Object.assign(uu(sp.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const t=uu(sp.getDefaults(),arguments,["pan"]);this.pan=new Zu({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",ku(this,"pan")}}np("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class rp extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),rp._allSolos.get(this.context).forEach((t=>t._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){rp._soloed.has(this.context)||rp._soloed.set(this.context,new Set),rp._soloed.get(this.context).add(this)}_removeSolo(){rp._soloed.has(this.context)&&rp._soloed.get(this.context).delete(this)}_isSoloed(){return rp._soloed.has(this.context)&&rp._soloed.get(this.context).has(this)}_noSolos(){return!rp._soloed.has(this.context)||rp._soloed.has(this.context)&&0===rp._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),rp._allSolos.get(this.context).delete(this),this._removeSolo(),this}constructor(){super(uu(rp.getDefaults(),arguments,["solo"])),this.name="Solo";const t=uu(rp.getDefaults(),arguments,["solo"]);this.input=this.output=new nh({context:this.context}),rp._allSolos.has(this.context)||rp._allSolos.set(this.context,new Set),rp._allSolos.get(this.context).add(this),this.solo=t.solo}}rp._allSolos=new Map,rp._soloed=new Map;class op extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}constructor(){super(uu(op.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const t=uu(op.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new sp({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new _h({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,ku(this,["pan","volume"])}}class ap extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return ap.buses.has(t)||ap.buses.set(t,new nh({context:this.context})),ap.buses.get(t)}send(t,e=0){const n=this._getBus(t),i=new nh({context:this.context,units:"decibels",gain:e});return this.connect(i),i.connect(n),i}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}constructor(){super(uu(ap.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const t=uu(ap.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new rp({solo:t.solo,context:this.context}),this._panVol=this.output=new op({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),ku(this,["pan","volume"])}}ap.buses=new Map;class lp extends Qu{static getDefaults(){return Object.assign(Qu.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}constructor(){super(...arguments),this.name="Listener",this.positionX=new Zu({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Zu({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Zu({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Zu({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Zu({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Zu({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Zu({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Zu({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Zu({context:this.context,param:this.context.rawContext.listener.upZ})}}xu((t=>{t.listener=new lp({context:t})})),Cu((t=>{t.listener.dispose()}));const cp=Ru().transport;Ru().destination,Ru().destination;Ru().listener;Ru().draw;const up=Ru();var hp=new WeakSet;class pp{onLeafGrow(t){"running"!==up.state&&up.resume()}onLeafWither(){this.bell.triggerAttackRelease(100,"8n")}onPlantGrow(){const t=Math.floor(Math.random()*this.baseSoundsOscFreq.length);this.baseSoundOsc.frequency.rampTo(this.baseSoundsOscFreq[t],.2)}constructor(t){v(this,hp),this.pane=t,this.bell=new Qh({harmonicity:12,resonance:800,modulationIndex:20,envelope:{decay:.4},volume:-15}).toDestination(),this.baseSoundsOscFreq=["B3","E3","A3","D3","F#3"],this.baseSoundOsc=new Rh("B3","square",10),this.baseSoundOscDst=this.baseSoundOsc.toDestination(),this.baseSoundOscDst.volume.value=-25,this.baseSoundOscDst.start(),cp.bpm.value=115,cp.stop(),d(this,hp,dp).call(this)}}function dp(){if(this.pane){const t=this.pane.addFolder({title:"audio"});t.addButton({title:"play"}).on("click",(()=>cp.start()));t.addButton({title:"stop"}).on("click",(()=>cp.stop()))}}var vp=new WeakMap,mp=new WeakMap,fp=new WeakMap,_p=new WeakMap,gp=new WeakSet,bp=new WeakSet,wp=new WeakSet,xp=new WeakSet,yp=new WeakSet,Cp=new WeakSet,Ep=new WeakSet,Tp=new WeakSet,Mp=new WeakSet,kp=new WeakSet,Pp=new WeakSet,Ap=new WeakSet,Sp=new WeakSet;class Vp{resize(){const t=this.gl;(function(t){const e=t.clientWidth,n=t.clientHeight,i=t.width!==e||t.height!==n;return i&&(t.width=e,t.height=n),i})(t.canvas)&&(t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),d(this,Tp,Bp).call(this,t)),this.blurScale=t.canvas.clientHeight/550,d(this,Ap,Up).call(this,t)}run(t=0){this.fpsGraph&&this.fpsGraph.begin(),p(this,fp,Math.min(32,t-c(this,vp))),p(this,vp,t),this.animate&&p(this,mp,c(this,mp)+c(this,fp)/16),c(this,_p)||(this.control.update(c(this,fp)),f.fromQuat(this.drawUniforms.worldMatrix,this.control.rotationQuat),f.invert(this.drawUniforms.worldInverseTransposeMatrix,this.drawUniforms.worldMatrix),f.transpose(this.drawUniforms.worldInverseTransposeMatrix,this.drawUniforms.worldInverseTransposeMatrix),f.invert(this.drawUniforms.inversProjectionMatrix,this.drawUniforms.projectionMatrix),this.plant.update(c(this,mp)),d(this,gp,Op).call(this),this.fpsGraph&&this.fpsGraph.end(),requestAnimationFrame((t=>this.run(t))))}destroy(){p(this,_p,!0)}initTweakpane(){if(this.pane){const t=200;this.fpsGraph=this.pane.addBlade({view:"fpsgraph",label:"fps",lineCount:1,maxValue:120,minValue:0}),this.pane.addInput(this,"animate",{label:"animate"});const e=this.pane.addFolder({title:"Camera"});d(this,Sp,Wp).call(this,e,this.camera,"near","near",1,t,null,(()=>d(this,Ap,Up).call(this,this.gl))),d(this,Sp,Wp).call(this,e,this.camera,"far","far",1,t,null,(()=>d(this,Ap,Up).call(this,this.gl)))}}constructor(t,e,n=null){v(this,gp),v(this,bp),v(this,wp),v(this,xp),v(this,yp),v(this,Cp),v(this,Ep),v(this,Tp),v(this,Mp),v(this,kp),v(this,Pp),v(this,Ap),v(this,Sp),m(this,"oninit",void 0),h(this,vp,{writable:!0,value:0}),h(this,mp,{writable:!0,value:0}),h(this,fp,{writable:!0,value:0}),h(this,_p,{writable:!0,value:!1}),m(this,"camera",{matrix:f.create(),near:60,far:155,distance:100,orbit:ft.create(),position:_t.create(),rotation:_t.create(),up:_t.fromValues(0,1,0)}),m(this,"animate",!0),m(this,"plantSettings",{showGuides:!1}),this.canvas=t,this.pane=e,this.oninit=n,d(this,yp,Lp).call(this)}}function Op(){const t=this.gl;si(t,this.plantFBO,this.drawBufferSize[0],this.drawBufferSize[1]),t.clearColor(1,1,1,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.plant.render(this.drawUniforms,this.plantSettings.showGuides),si(t,null,this.drawBufferSize[0],this.drawBufferSize[1]),si(t,this.deltaDepthFBO,this.drawBufferSize[0],this.drawBufferSize[1]),t.useProgram(this.deltaDepthProgram),t.clearColor(1,1,1,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.plantColorTexture),t.uniform1i(this.deltaDepthLocations.u_colorTexture,0),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.plantDepthTexture),t.uniform1i(this.deltaDepthLocations.u_depthTexture,1),t.uniformMatrix4fv(this.deltaDepthLocations.u_viewMatrix,!1,this.drawUniforms.viewMatrix),t.uniformMatrix4fv(this.deltaDepthLocations.u_projectionMatrix,!1,this.drawUniforms.projectionMatrix),t.uniformMatrix4fv(this.deltaDepthLocations.u_inversProjectionMatrix,!1,this.drawUniforms.inversProjectionMatrix),t.uniformMatrix4fv(this.deltaDepthLocations.u_worldMatrix,!1,this.drawUniforms.worldMatrix),t.bindVertexArray(this.vesselVAO),t.drawElements(t.TRIANGLES,this.vesselBuffers.numElem,t.UNSIGNED_SHORT,0),si(t,null,this.drawBufferSize[0],this.drawBufferSize[1]),si(t,this.hBlurFBO,this.drawBufferSize[0],this.drawBufferSize[1]),d(this,bp,Dp).call(this,this.deltaDepthColorTexture),si(t,null,this.drawBufferSize[0],this.drawBufferSize[1]),si(t,this.vBlurFBO,this.drawBufferSize[0],this.drawBufferSize[1]),d(this,bp,Dp).call(this,this.hBlurTexture,!0),si(t,null,this.drawBufferSize[0],this.drawBufferSize[1]),t.clearColor(1,1,1,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),d(this,wp,Rp).call(this,!1)}function Dp(t,e=!1){const n=this.gl;n.useProgram(this.blurProgram),n.clearColor(1,1,1,1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,t),n.uniform1i(this.blurLocations.u_colorTexture,0),e?n.uniform2f(this.blurLocations.u_direction,0,1):n.uniform2f(this.blurLocations.u_direction,1,0),n.uniform1f(this.blurLocations.u_scale,this.blurScale),n.bindVertexArray(this.quadVAO),n.drawArrays(n.TRIANGLES,0,this.quadBuffers.numElem)}function Rp(t,e=!1){const n=this.gl;n.useProgram(this.vesselProgram),n.enable(n.CULL_FACE),n.enable(n.DEPTH_TEST);let i=this.drawUniforms.worldInverseTransposeMatrix;t&&(n.cullFace(n.FRONT),i=f.scale(f.create(),this.drawUniforms.worldInverseTransposeMatrix,_t.fromValues(-1,-1,-1))),e||(n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.vBlurTexture),n.uniform1i(this.vesselLocations.u_colorTexture,0)),n.uniformMatrix4fv(this.vesselLocations.u_viewMatrix,!1,this.drawUniforms.viewMatrix),n.uniformMatrix4fv(this.vesselLocations.u_projectionMatrix,!1,this.drawUniforms.projectionMatrix),n.uniform3f(this.vesselLocations.u_cameraPosition,this.camera.position[0],this.camera.position[1],this.camera.position[2]),n.uniformMatrix4fv(this.vesselLocations.u_worldMatrix,!1,this.drawUniforms.worldMatrix),n.uniformMatrix4fv(this.vesselLocations.u_worldInverseTransposeMatrix,!1,i),n.bindVertexArray(this.vesselVAO),n.drawElements(n.TRIANGLES,this.vesselBuffers.numElem,n.UNSIGNED_SHORT,0),n.cullFace(n.BACK)}function Lp(){this.gl=this.canvas.getContext("webgl2",{antialias:!1,alpha:!1});const t=this.gl;if(!t)throw new Error("No WebGL 2 context!");t.getExtension("EXT_color_buffer_float")||(console.error("FLOAT color buffer not available"),document.body.innerHTML="This example requires EXT_color_buffer_float which is unavailable on this system."),this.deltaDepthProgram=ti(t,[e("#version 300 es\n#define GLSLIFY 1\n\nuniform mat4 u_worldMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_projectionMatrix;\n\nin vec3 a_position;\n\nout vec3 v_position;\n\nvoid main() {\n    vec4 worldPosition = u_worldMatrix * vec4(a_position, 1.);\n    vec4 viewPosition = u_viewMatrix * worldPosition;\n    gl_Position = u_projectionMatrix * viewPosition;\n    v_position = viewPosition.xyz;\n}\n"),e("#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\nuniform mat4 u_inversProjectionMatrix;\nuniform sampler2D u_colorTexture;\nuniform sampler2D u_depthTexture;\n\nin vec3 v_position;\n\nout vec4 outColor;\n\n// reconstructs the view space position given the screen space coordinates\n// along with the depth\nvec3 reconstructPosition(vec2 uv, float depth, mat4 inversProjectionMatrix) {\n    float x = uv.x * 2. - 1.;   // = x / w\n    float y = uv.y * 2. - 1.;   // = y / w\n    float z = depth * 2. - 1.;\n    vec4 projectedPosition = vec4(x, y, z, 1.);\n    vec4 pos = inversProjectionMatrix * projectedPosition;\n    return pos.xyz / pos.w;\n}\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / vec2(textureSize(u_colorTexture, 0));\n    float vesselRadius = 20.;\n    float cameraDistance = 100.;\n\n    float plantDepth = texture(u_depthTexture, uv).r;\n    vec3 plantPosition = reconstructPosition(uv, plantDepth, u_inversProjectionMatrix);\n    // get the normalized plant z position\n    float plantNormZ = (cameraDistance + vesselRadius + plantPosition.z) / (2. * vesselRadius);\n    // get the normalized vessel z position\n    float vesselNormZ = (cameraDistance + vesselRadius + v_position.z) / (2. * vesselRadius);\n    float deltaBlur = smoothstep(0.15, 0.4, vesselNormZ - plantNormZ);\n    float deltaFog = smoothstep(0.0, 1.1, vesselNormZ - plantNormZ);\n    vec4 color = mix(texture(u_colorTexture, uv), vec4(1.), deltaFog);\n\n    outColor = vec4(color.rgb, deltaBlur);\n}\n")],null,{a_position:0}),this.blurProgram=ti(t,[e("#version 300 es\n#define GLSLIFY 1\n\nin vec2 a_position;\n\nvoid main() {\n    gl_Position = vec4(a_position, 0., 1.);\n}"),e("#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D u_colorTexture;\nuniform float u_scale;\nuniform vec2 u_direction;\n\nout vec4 blurColor;\n\nfloat getRadius(float depth) {\n    return clamp(depth, 0.0, 1.);\n}\n\nvoid blur(\n    in vec2 A,\n    in vec2 direction,\n    in float scale,\n    in sampler2D inTexture,\n    out vec4 outColor\n) {\n    const int KERNEL_SIZE = 6;\n    float gaussian[KERNEL_SIZE];  \n    gaussian[5] = 0.04153263993208;\n    gaussian[4] = 0.06352050813141;\n    gaussian[3] = 0.08822292796029;\n    gaussian[2] = 0.11143948794984;\n    gaussian[1] = 0.12815541114232;\n    gaussian[0] = 0.13425804976814;\n\n    vec4 resultColor = vec4(0.);\n    float weightSum = 0.;\n\n    // position of the current pixel\n    vec2 texelSize = 1. / vec2(textureSize(inTexture, 0));\n    vec4 colorA = texture(inTexture, A);\n    float depthA = colorA.a;\n    float rA = getRadius(depthA);\n\n    // scatter as you gather loop\n    for(int i = -KERNEL_SIZE + 1; i < KERNEL_SIZE; ++i) {\n        vec2 B = A + direction * ((float(i) * scale) * texelSize);\n        vec4 colorB = texture(inTexture, B);\n        float depthB = colorB.a;\n        float rB = getRadius(depthB);\n\n        float blurWeight = gaussian[abs(i)];\n\n        // only consider if B is in front of A\n        float bNearerWeight = clamp(abs(rA) - abs(rB) + 1., 0., .5);\n        float weight = bNearerWeight * blurWeight;\n        weightSum += weight;\n        resultColor.rgb += colorB.rgb * weight;\n    }\n\n    // apply total weights\n    resultColor.rgb /= weightSum;\n    resultColor.a = colorA.a;\n\n    outColor = resultColor;\n}\n\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / vec2(textureSize(u_colorTexture, 0));\n\n    blur(\n        uv,\n        u_direction,\n        u_scale,\n        u_colorTexture,\n        blurColor\n    );\n\n    //blurColor = vec4(texture(u_colorTexture, uv).a);\n}")],null,{a_position:0}),this.vesselProgram=ti(t,[e("#version 300 es\n#define GLSLIFY 1\n\nuniform mat4 u_worldMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_worldInverseTransposeMatrix;\nuniform vec3 u_cameraPosition;\n\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_uv;\n\nout vec3 v_position;\nout vec3 v_viewPosition;\nout vec3 v_normal;\nout vec3 v_viewNormal;\nout vec2 v_uv;\nout vec3 v_surfaceToView;\n\nvoid main() {\n    v_uv = a_uv;\n    v_normal = (u_worldInverseTransposeMatrix * vec4(a_normal, 0.)).xyz;\n    vec4 worldPosition = u_worldMatrix * vec4(a_position, 1.);\n    vec4 viewPosition = u_viewMatrix * worldPosition;\n    gl_Position = u_projectionMatrix * viewPosition;\n    v_surfaceToView = u_cameraPosition - worldPosition.xyz;\n    v_position = a_position.xyz;\n    v_viewPosition = viewPosition.xyz;\n    v_viewNormal = (u_viewMatrix * vec4(v_normal, 0.)).xyz;\n}\n"),e("#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D u_colorTexture;\nuniform float u_frames;\n\nin vec3 v_position;\nin vec3 v_normal;\nin vec3 v_viewNormal;\nin vec2 v_uv;\nin vec3 v_surfaceToView;\nin vec3 v_viewPosition;\n\nout vec4 outColor;\n\n#define PI 3.1415926535\n\nvoid main() {\n    vec2 texelSize = 1. / vec2(textureSize(u_colorTexture, 0));\n    vec2 uv = gl_FragCoord.xy * texelSize;\n\n    vec3 pos = v_position;\n    vec3 N = normalize(v_normal);\n    vec3 VN = normalize(v_viewNormal);\n    vec3 V = normalize(v_surfaceToView);\n    vec3 L = normalize(vec3(0., .5, 4.));\n    float NdL = max(0., dot(N, L));\n\n    // calculate the half vector\n    vec3 H = normalize(V + N);\n\n    // specular term\n    float specular = pow(max(0., max(0., dot(H, L))), 100.) * .6;\n\n    // diffuse term\n    float diffuse = NdL * .3 + .7;\n\n    // edge darkening term\n    float edge = min(1., pow(min(1., NdL + 0.5), 3.) + 0.6);\n\n    // ambient light color\n    vec4 ambient = vec4(0.9, 0.9, 1., 1.);\n    \n    vec4 innerColor = texture(u_colorTexture, uv);\n\n    vec4 vesselColor = ambient * diffuse + vec4(specular) * 1.5;\n    vesselColor *= edge;\n\n    outColor = innerColor * 0.9 + vesselColor * 0.1 + vec4(N.zyx, 1.) * 0.05;\n}\n")],null,{a_position:0,a_normal:1,a_uv:2}),this.titleProgram=ti(t,[e("#version 300 es\n#define GLSLIFY 1\n\nuniform mat4 u_worldMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_projectionMatrix;\n\nin vec3 a_position;\nin vec2 a_uv;\n\nout vec2 v_uv;\n\nvoid main() {\n    v_uv = a_uv;\n    vec4 worldPosition = u_worldMatrix * vec4(a_position, 1.);\n    vec4 viewPosition = u_viewMatrix * worldPosition;\n    gl_Position = u_projectionMatrix * viewPosition;\n}\n"),e("#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D u_titleTexture;\nuniform float u_frames;\n\nin vec2 v_uv;\n\nout vec4 outColor;\n\nvoid main() {\n    vec2 uv = vec2(v_uv.x - u_frames * 0.00025, v_uv.y);\n    vec4 color = 1. - texture(u_titleTexture, uv * vec2(-4., 0.99));\n    //color = mix(vec4(248. / 255., 248. / 255., 222. / 255., 1.), vec4(1.), color);\n    color = mix(vec4(228. / 255., 238. / 255., 255. / 255., 1.), vec4(1.), color);\n    //color = mix(vec4(55. / 255., 25. / 255., 22. / 255., 1.), vec4(1.), color);\n\n    color = mix(color, vec4(1.), sin(v_uv.x * 9.5) * 0.5 + 0.5);\n\n    outColor = color;\n}\n")],null,{a_position:0,a_uv:1}),this.deltaDepthLocations={a_position:t.getAttribLocation(this.deltaDepthProgram,"a_position"),u_worldMatrix:t.getUniformLocation(this.deltaDepthProgram,"u_worldMatrix"),u_viewMatrix:t.getUniformLocation(this.deltaDepthProgram,"u_viewMatrix"),u_projectionMatrix:t.getUniformLocation(this.deltaDepthProgram,"u_projectionMatrix"),u_inversProjectionMatrix:t.getUniformLocation(this.deltaDepthProgram,"u_inversProjectionMatrix"),u_colorTexture:t.getUniformLocation(this.deltaDepthProgram,"u_colorTexture"),u_depthTexture:t.getUniformLocation(this.deltaDepthProgram,"u_depthTexture")},this.blurLocations={a_position:t.getAttribLocation(this.blurProgram,"a_position"),u_colorTexture:t.getUniformLocation(this.blurProgram,"u_colorTexture"),u_scale:t.getUniformLocation(this.blurProgram,"u_scale"),u_direction:t.getUniformLocation(this.blurProgram,"u_direction")},this.vesselLocations={a_position:t.getAttribLocation(this.vesselProgram,"a_position"),a_normal:t.getAttribLocation(this.vesselProgram,"a_normal"),a_uv:t.getAttribLocation(this.vesselProgram,"a_uv"),u_worldMatrix:t.getUniformLocation(this.vesselProgram,"u_worldMatrix"),u_viewMatrix:t.getUniformLocation(this.vesselProgram,"u_viewMatrix"),u_projectionMatrix:t.getUniformLocation(this.vesselProgram,"u_projectionMatrix"),u_worldInverseTransposeMatrix:t.getUniformLocation(this.vesselProgram,"u_worldInverseTransposeMatrix"),u_cameraPosition:t.getUniformLocation(this.vesselProgram,"u_cameraPosition"),u_colorTexture:t.getUniformLocation(this.vesselProgram,"u_colorTexture")},this.titleLocations={a_position:t.getAttribLocation(this.titleProgram,"a_position"),a_uv:t.getAttribLocation(this.titleProgram,"a_uv"),u_worldMatrix:t.getUniformLocation(this.titleProgram,"u_worldMatrix"),u_viewMatrix:t.getUniformLocation(this.titleProgram,"u_viewMatrix"),u_projectionMatrix:t.getUniformLocation(this.titleProgram,"u_projectionMatrix"),u_titleTexture:t.getUniformLocation(this.titleProgram,"u_titleTexture"),u_frames:t.getUniformLocation(this.titleProgram,"u_frames")},this.drawUniforms={worldMatrix:f.create(),viewMatrix:f.create(),cameraMatrix:f.create(),projectionMatrix:f.create(),inversProjectionMatrix:f.create(),worldInverseTransposeMatrix:f.create()},this.VESSEL_HEIGHT=50,this.VESSEL_RADIUS=20,this.VESSEL_BEVEL_RADIUS=13,this.vesselGeometry=new xi(this.VESSEL_HEIGHT,this.VESSEL_RADIUS,this.VESSEL_BEVEL_RADIUS),this.vesselBuffers={position:ni(t,this.vesselGeometry.vertices,t.STATIC_DRAW),normal:ni(t,this.vesselGeometry.normals,t.STATIC_DRAW),numElem:this.vesselGeometry.indices.length},this.vesselVAO=ei(t,[[this.vesselBuffers.position,this.vesselLocations.a_position,3],[this.vesselBuffers.normal,this.vesselLocations.a_normal,3]],this.vesselGeometry.indices);const n=[-1,-1,3,-1,-1,3];this.quadBuffers={position:ni(t,new Float32Array(n),t.STATIC_DRAW),numElem:n.length/2},this.quadVAO=ei(t,[[this.quadBuffers.position,0,2]]),this.plant=new Xi(t,this.VESSEL_HEIGHT,this.VESSEL_RADIUS,this.VESSEL_BEVEL_RADIUS,(()=>this.plant.generate(c(this,mp)))),this.plant.generate(c(this,mp)),this.titleRibbonGeometry=d(this,kp,zp).call(this,50,8,60,1),this.titleRibbonBuffers={position:ni(t,new Float32Array(this.titleRibbonGeometry.vertices),t.STATIC_DRAW),uv:ni(t,new Float32Array(this.titleRibbonGeometry.uvs),t.STATIC_DRAW),numElem:this.titleRibbonGeometry.count},this.titleRibbonVAO=ei(t,[[this.titleRibbonBuffers.position,this.titleLocations.a_position,3],[this.titleRibbonBuffers.uv,this.titleLocations.a_uv,2]],this.titleRibbonGeometry.indices);const i=ln.fromValues(t.canvas.clientWidth,t.canvas.clientHeight);this.drawBufferSize=ln.clone(i),this.plantColorTexture=d(this,Cp,Ip).call(this,t,t.RGBA,i,t.LINEAR,t.LINEAR,t.REPEAT,t.REPEAT),this.plantDepthTexture=d(this,Cp,Ip).call(this,t,t.DEPTH_COMPONENT32F,i,t.NEAREST,t.NEAREST,t.REPEAT,t.REPEAT),this.plantFBO=ii(t,[this.plantColorTexture],this.plantDepthTexture),this.deltaDepthColorTexture=d(this,Cp,Ip).call(this,t,t.RGBA,i,t.LINEAR,t.LINEAR,t.REPEAT,t.REPEAT),this.deltaDepthFBO=ii(t,[this.deltaDepthColorTexture]),this.hBlurTexture=d(this,Cp,Ip).call(this,t,t.RGBA,i,t.LINEAR,t.LINEAR,t.REPEAT,t.REPEAT),this.vBlurTexture=d(this,Cp,Ip).call(this,t,t.RGBA,i,t.LINEAR,t.LINEAR,t.REPEAT,t.REPEAT),this.hBlurFBO=ii(t,[this.hBlurTexture]),this.vBlurFBO=ii(t,[this.vBlurTexture]),this.control=new ai(this.canvas),this.resize(),d(this,Ep,Fp).call(this),this.camera.position[2]=this.camera.distance,d(this,Pp,jp).call(this),d(this,Ap,Up).call(this,t),this.initTweakpane(),this.audioEffects=new pp(this.pane),this.oninit&&this.oninit(this)}function Ip(t,e,n,i,s,r,o){const a=ri(t,i,s,r,o);return t.bindTexture(t.TEXTURE_2D,a),e===t.RGBA?t.texImage2D(t.TEXTURE_2D,0,e,n[0],n[1],0,e,t.UNSIGNED_BYTE,null):e===t.DEPTH_COMPONENT32F?t.texImage2D(t.TEXTURE_2D,0,e,n[0],n[1],0,t.DEPTH_COMPONENT,t.FLOAT,null):e===t.RGBA16F&&t.texStorage2D(t.TEXTURE_2D,1,t.RGBA16F,n[0],n[1]),t.bindTexture(t.TEXTURE_2D,null),a}var Np;function Fp(){const t=this.gl;this.titleTexture=ri(t,t.LINEAR,t.LINEAR,t.REPEAT,t.REPEAT),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);const e=new Image;e.width=2e3,e.addEventListener("load",(()=>{t.bindTexture(t.TEXTURE_2D,this.titleTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.bindTexture(t.TEXTURE_2D,null)})),e.src=new URL(Np)}function Bp(t){const e=ln.fromValues(t.canvas.clientWidth,t.canvas.clientHeight);this.drawBufferSize=ln.clone(e),d(this,Mp,qp).call(this,t,this.plantColorTexture,t.RGBA,e),d(this,Mp,qp).call(this,t,this.plantDepthTexture,t.DEPTH_COMPONENT32F,e),d(this,Mp,qp).call(this,t,this.deltaDepthColorTexture,t.RGBA,e),d(this,Mp,qp).call(this,t,this.hBlurTexture,t.RGBA,e),d(this,Mp,qp).call(this,t,this.vBlurTexture,t.RGBA,e),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null)}function qp(t,e,n,i){t.bindTexture(t.TEXTURE_2D,e),n===t.RGBA?t.texImage2D(t.TEXTURE_2D,0,n,i[0],i[1],0,n,t.UNSIGNED_BYTE,null):n===t.DEPTH_COMPONENT32F&&t.texImage2D(t.TEXTURE_2D,0,n,i[0],i[1],0,t.DEPTH_COMPONENT,t.FLOAT,null),t.bindTexture(t.TEXTURE_2D,null)}function zp(t,e,n,i){const s=2*Math.PI/n,r=e/i,o=n*i*6,a=[],l=[],c=[],u=[],h=n+1,p=-e/2;for(let e=0;e<=i;++e)for(let o=0;o<=n;++o){let u={x:t*Math.sin(s*o),y:p+r*e,z:t*Math.cos(s*o)},h={x:0,y:0,z:1};a.push(u.x,u.y,u.z),l.push(h.x,h.y,h.z),c.push(o/n,e/i)}for(let t=0;t<i;++t)for(let e=0;e<n;++e)u.push(t*h+e,(t+1)*h+e+1,t*h+e+1),u.push((t+1)*h+e+1,t*h+e,(t+1)*h+e);return{vertices:a,normals:l,uvs:c,indices:u,count:o}}function jp(){f.targetTo(this.camera.matrix,this.camera.position,[0,0,0],this.camera.up),f.invert(this.drawUniforms.viewMatrix,this.camera.matrix),f.copy(this.drawUniforms.cameraMatrix,this.camera.matrix)}function Up(t){const e=t.canvas.clientWidth/t.canvas.clientHeight;f.perspective(this.drawUniforms.projectionMatrix,Math.PI/4,e,this.camera.near,this.camera.far)}function Wp(t,e,n,i,s,r,o=null,a){t.addBlade({view:"slider",label:i,min:s,max:r,step:o,value:e[n]}).on("change",(t=>{e[n]=t.value,a&&a()}))}Np=new URL(r("kyEFX").resolve("7qSf0"),import.meta.url).toString();const Gp=window.location.search;let Kp,Hp,$p=null!==new URLSearchParams(Gp).get("debug");window.addEventListener("load",(()=>{const t=document.body.querySelector("#c");let e;$p&&(e=new o.Pane({title:"Settings"}),e.registerPlugin(a)),Kp=new Vp(t,e,(t=>{t.run()}))})),window.addEventListener("resize",(()=>{Kp&&(Hp&&clearTimeout(Hp),Hp=setTimeout((()=>{Hp=null,Kp.resize()}),300))}));
//# sourceMappingURL=index.fc667931.js.map
